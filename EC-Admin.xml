<exportedData xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="commander.xsd" version="61" buildLabel="build_4.2_71224_2014.04.04_08:13:52" buildVersion="4.2.4.71224" passkey="a30cbf89cfdae202c5227ce40fe867512295566d">
  <exportPath>/projects/EC-Admin</exportPath>
  <project>
    <projectName>EC-Admin</projectName>
    <description>A set of tools to help with the administration of a Commander Server.</description>
    <resourceName />
    <workspaceName />
    <propertySheet>
      <property>
        <propertyName>ec_dashboardReports</propertyName>
        <propertySheet>
          <property>
            <propertyName>Performance Report</propertyName>
            <propertySheet>
              <property>
                <propertyName>image</propertyName>
                <expandable>1</expandable>
                <value>/commander/jobSteps/1293227/images/customa97dafa147341af08d1.png</value>
              </property>
              <property>
                <propertyName>link</propertyName>
                <expandable>1</expandable>
                <value>/commander/jobSteps/1293227/Performance Report.html</value>
              </property>
            </propertySheet>
          </property>
        </propertySheet>
      </property>
      <property>
        <propertyName>ec_reportData</propertyName>
        <propertySheet>
          <property>
            <propertyName>101057</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>795542</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>795542</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-04-02 02:00:21</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>102561</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>809962</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>809962</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-04-04 02:02:49</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>103546</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>819919</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>819919</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-04-15 02:01:40</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>105093</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>834705</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>834705</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-04-16 02:02:20</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>106896</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>855271</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>855271</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-04-18 02:01:27</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>108968</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>876280</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>876280</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-04-20 02:02:10</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>111500</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>901727</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>901727</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-04-22 02:01:52</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>113032</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>917120</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>917120</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-04-23 02:02:24</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>115104</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>940270</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>940270</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-04-29 02:00:31</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>118795</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>977713</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>977713</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-05-02 02:01:41</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>122261</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>1014313</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>1014313</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-05-17 02:01:09</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>123433</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>1026156</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>1026156</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-05-22 02:01:06</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>124975</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>1041289</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>1041289</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-05-24 02:01:18</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>128755</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>1077868</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>1077868</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-05-28 02:01:03</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>134914</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>1137980</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>1137980</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-06-11 02:01:17</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>136794</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>1153604</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>1153604</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-06-12 02:01:10</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>141506</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>1196299</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>1196299</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-06-29 02:02:33</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>142707</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>1207103</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>1207103</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-07-01 02:01:15</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>147088</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>1245333</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>1245333</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-07-07 02:01:23</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>148231</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>1256267</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>1256267</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-07-09 02:01:05</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>149504</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>1268492</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>1268492</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-07-10 02:01:05</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>152104</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>1293227</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>1293227</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-07-14 02:00:54</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>39294</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>236863</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>236863</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2013-11-27 13:34:00</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>40204</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>242421</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>242421</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2013-12-17 02:01:37</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>40817</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>247707</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>247707</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2013-12-20 02:00:41</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>41086</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>249438</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>249438</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2013-12-21 02:00:44</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>41280</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>251668</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>251668</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2013-12-22 02:00:40</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>41628</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>253766</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>253766</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2013-12-23 02:00:32</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>41985</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>255907</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>255907</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2013-12-24 02:00:54</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>42178</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>258456</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>258456</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2013-12-27 02:00:42</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>42506</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>262792</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>262792</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-01-04 02:00:28</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>42565</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>265083</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>265083</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-01-10 02:01:12</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>42720</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>266782</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>266782</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-01-11 02:00:36</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>42876</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>268485</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>268485</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-01-12 02:00:34</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>43020</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>270748</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>270748</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-01-14 02:00:31</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>43170</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>272401</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>272401</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-01-15 02:01:09</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>43339</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>274171</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>274171</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-01-16 02:00:41</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>43526</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>276715</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>276715</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-01-18 02:02:12</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>43665</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>278242</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>278242</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-01-19 02:00:43</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>43954</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>282108</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>282108</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-01-22 02:00:42</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>44095</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>283691</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>283691</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-01-23 02:00:37</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>44286</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>285561</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>285561</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-01-24 02:00:42</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>44365</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>286672</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>286672</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-01-25 02:00:39</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>44517</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>289171</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>289171</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-01-28 02:00:41</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>44718</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>290921</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>290921</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-01-29 02:00:43</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>44875</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>292575</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>292575</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-01-30 02:00:38</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>45189</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>296009</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>296009</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-02-01 02:00:55</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>45381</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>298620</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>298620</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-02-03 02:00:46</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>45459</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>299140</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>299140</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-02-03 14:02:57</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>45537</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>300269</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>300269</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-02-04 02:00:38</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>45707</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>302045</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>302045</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-02-05 02:00:45</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>46965</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>310280</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>310280</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-02-06 02:01:49</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>48931</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>323557</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>323557</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-02-08 02:02:41</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>51473</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>341685</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>341685</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-02-14 02:01:26</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>52480</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>348315</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>348315</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-02-15 02:06:38</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>57663</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>388731</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>388731</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-02-19 02:01:58</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>59205</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>402983</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>402983</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-02-20 02:03:17</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>65949</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>465528</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>465528</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-02-25 02:00:40</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>67496</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>479784</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>479784</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-02-26 02:02:12</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>73295</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>533981</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>533981</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-03-05 02:02:03</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>74452</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>544825</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>544825</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-03-06 02:01:49</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>75848</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>558025</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>558025</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-03-08 02:00:38</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>78995</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>586352</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>586352</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-03-10 03:01:49</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>80212</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>598496</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>598496</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-03-11 02:02:59</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>81674</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>612753</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>612753</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-03-12 02:01:48</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>83240</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>627040</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>627040</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-03-13 02:02:00</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>85471</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>648593</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>648593</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-03-16 02:00:34</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>86417</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>658207</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>658207</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-03-18 02:02:09</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>87941</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>672251</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>672251</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-03-19 02:00:29</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>89877</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>690506</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>690506</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-03-21 02:01:14</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>92564</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>716731</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>716731</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-03-25 02:01:08</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>95635</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>744863</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>744863</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-03-27 02:00:33</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>97593</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>763287</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>763287</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-03-29 02:01:12</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>99579</propertyName>
            <propertySheet>
              <property>
                <propertyName>Performance Report_L2</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>781905</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>Performance Report_L3</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>jobStepId</propertyName>
                    <expandable>1</expandable>
                    <value>781905</value>
                  </property>
                  <property>
                    <propertyName>reportDate</propertyName>
                    <expandable>1</expandable>
                    <value>2014-04-01 02:01:17</value>
                  </property>
                  <property>
                    <propertyName>reportType</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report</value>
                  </property>
                  <property>
                    <propertyName>reportUrl</propertyName>
                    <expandable>1</expandable>
                    <value>Performance Report.html</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
        </propertySheet>
      </property>
      <property>
        <propertyName>ec_savedSearches</propertyName>
        <propertySheet>
          <property>
            <propertyName>last500PerformanceMetricsJobs</propertyName>
            <description />
            <propertySheet>
              <property>
                <propertyName>displayFilter1</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>filterName</propertyName>
                    <expandable>1</expandable>
                    <value>procedureName</value>
                  </property>
                  <property>
                    <propertyName>operand1</propertyName>
                    <expandable>1</expandable>
                    <value>performanceMetrics</value>
                  </property>
                  <property>
                    <propertyName>operator</propertyName>
                    <expandable>1</expandable>
                    <value>equals</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>filter1</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>filterName</propertyName>
                    <expandable>1</expandable>
                    <value>procedureName</value>
                  </property>
                  <property>
                    <propertyName>operand1</propertyName>
                    <expandable>1</expandable>
                    <value>performanceMetrics</value>
                  </property>
                  <property>
                    <propertyName>operator</propertyName>
                    <expandable>1</expandable>
                    <value>equals</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>sort1</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>order</propertyName>
                    <expandable>1</expandable>
                    <value>descending</value>
                  </property>
                  <property>
                    <propertyName>sortName</propertyName>
                    <expandable>1</expandable>
                    <value>createTime</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>filterName</propertyName>
                <expandable>1</expandable>
                <value>jobSearch</value>
              </property>
              <property>
                <propertyName>filter_count</propertyName>
                <expandable>1</expandable>
                <value>1</value>
              </property>
              <property>
                <propertyName>maxIds</propertyName>
                <expandable>1</expandable>
                <value>500</value>
              </property>
              <property>
                <propertyName>maxResults</propertyName>
                <expandable>1</expandable>
                <value>20</value>
              </property>
              <property>
                <propertyName>objectType</propertyName>
                <expandable>1</expandable>
                <value>job</value>
              </property>
              <property>
                <propertyName>projectionCount</propertyName>
                <expandable>1</expandable>
                <value>0</value>
              </property>
              <property>
                <propertyName>relatedToCount</propertyName>
                <expandable>1</expandable>
                <value>0</value>
              </property>
              <property>
                <propertyName>resultsPage</propertyName>
                <expandable>1</expandable>
                <value>searchResults.php</value>
              </property>
              <property>
                <propertyName>sortCount</propertyName>
                <expandable>1</expandable>
                <value>1</value>
              </property>
              <property>
                <propertyName>textSearchCount</propertyName>
                <expandable>1</expandable>
                <value>0</value>
              </property>
            </propertySheet>
          </property>
        </propertySheet>
      </property>
      <property>
        <propertyName>performances</propertyName>
        <description>A property sheet for performance diagnostic</description>
        <propertySheet>
          <property>
            <propertyName>CORE</propertyName>
            <description>Tests for number of cores</description>
            <propertySheet>
              <property>
                <propertyName>BAD</propertyName>
                <description />
                <expandable>1</expandable>
                <value>&lt; 4</value>
              </property>
              <property>
                <propertyName>BEST</propertyName>
                <description />
                <expandable>1</expandable>
                <value>> 6</value>
              </property>
              <property>
                <propertyName>GOOD</propertyName>
                <description />
                <expandable>1</expandable>
                <value>&lt;=6</value>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>CPU</propertyName>
            <description>Tests for CPU speed</description>
            <propertySheet>
              <property>
                <propertyName>BAD</propertyName>
                <description />
                <expandable>1</expandable>
                <value>&lt; 1.5</value>
              </property>
              <property>
                <propertyName>BEST</propertyName>
                <description />
                <expandable>1</expandable>
                <value>> 2</value>
              </property>
              <property>
                <propertyName>GOOD</propertyName>
                <description />
                <expandable>1</expandable>
                <value>&lt;= 2.0</value>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>DBPERF</propertyName>
            <description>Test for Database Performance</description>
            <propertySheet>
              <property>
                <propertyName>BAD</propertyName>
                <description />
                <expandable>1</expandable>
                <value>> .10</value>
              </property>
              <property>
                <propertyName>BEST</propertyName>
                <description />
                <expandable>1</expandable>
                <value>&lt;.07</value>
              </property>
              <property>
                <propertyName>GOOD</propertyName>
                <description />
                <expandable>1</expandable>
                <value>>= .07</value>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>DISKREAD</propertyName>
            <description>Tests for Disk Reading Performance</description>
            <propertySheet>
              <property>
                <propertyName>BAD</propertyName>
                <description />
                <expandable>1</expandable>
                <value>&lt; 2</value>
              </property>
              <property>
                <propertyName>BEST</propertyName>
                <description />
                <expandable>1</expandable>
                <value>>5</value>
              </property>
              <property>
                <propertyName>GOOD</propertyName>
                <description />
                <expandable>1</expandable>
                <value>&lt;=5</value>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>DISKWRITE</propertyName>
            <description>Tests for Disk Writing Performance</description>
            <propertySheet>
              <property>
                <propertyName>BAD</propertyName>
                <description />
                <expandable>1</expandable>
                <value>&lt; 2</value>
              </property>
              <property>
                <propertyName>BEST</propertyName>
                <description />
                <expandable>1</expandable>
                <value>>5</value>
              </property>
              <property>
                <propertyName>GOOD</propertyName>
                <description />
                <expandable>1</expandable>
                <value>&lt;=5</value>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>PERF</propertyName>
            <description>Test for ping times to resources</description>
            <propertySheet>
              <property>
                <propertyName>BAD</propertyName>
                <description />
                <expandable>1</expandable>
                <value>> 10</value>
              </property>
              <property>
                <propertyName>BEST</propertyName>
                <description />
                <expandable>1</expandable>
                <value>&lt; 5</value>
              </property>
              <property>
                <propertyName>GOOD</propertyName>
                <description />
                <expandable>1</expandable>
                <value>>=5</value>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>PING</propertyName>
            <description>Test for ping times to resources</description>
            <propertySheet>
              <property>
                <propertyName>BAD</propertyName>
                <description />
                <expandable>1</expandable>
                <value>> 2</value>
              </property>
              <property>
                <propertyName>BEST</propertyName>
                <description />
                <expandable>1</expandable>
                <value>&lt; 1</value>
              </property>
              <property>
                <propertyName>GOOD</propertyName>
                <description />
                <expandable>1</expandable>
                <value>>=1</value>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>RAM</propertyName>
            <description>Test for RAM amount</description>
            <propertySheet>
              <property>
                <propertyName>BAD</propertyName>
                <description>Value below 4 GB is bad</description>
                <expandable>1</expandable>
                <value>&lt; 4</value>
              </property>
              <property>
                <propertyName>BEST</propertyName>
                <description>Anything over 8GB is perfect</description>
                <expandable>1</expandable>
                <value>> 8</value>
              </property>
              <property>
                <propertyName>GOOD</propertyName>
                <description>RAM between 4GB and 8GB is acceptable</description>
                <expandable>1</expandable>
                <value>&lt;= 8</value>
              </property>
            </propertySheet>
          </property>
          <property>
            <propertyName>scripts</propertyName>
            <description>perl Library</description>
            <propertySheet>
              <property>
                <propertyName>perf.pm</propertyName>
                <description>checkvalue(PERF, value): test the value against BAD, GOOD and BEST logic tests for PERF test (in /myProject/performances/PERF)

</description>
                <expandable>1</expandable>
                <value>$[/myProject/scripts/perlHeader]
$[/myProject/scripts/perlLib]

sub checkValue
{
  my $test=shift;            # the test to perform
  my $value=shift;         # the value to test
  my $summary=shift;   # the summary to display on the job page

  printf("Value to test: %s\n", $value) if ($DEBUG);
  printf("Checking Performance for %s: ", $test);
 
  InvokeCommander("SuppressLog", "setProperty", "summary", $summary);
  if (eval $value .  getP("/myProject/performances/$test/BAD")) {
    printf("BAD\n");
    InvokeCommander("SuppressLog", "setProperty", "outcome", "warning");
    return -1;
  } elsif (eval $value . getP("/myProject/performances/$test/GOOD")) {
    printf("GOOD\n");
    return 0;
  } elsif(eval $value . getP("/myProject/performances/$test/BEST")) {
    printf("BEST\n");
    return +1;
  } else {
    printf ("\nTest for %s does not resolve. Verify your values in the performances property sheet\n", $test);
    exit (2);
  }
}</value>
              </property>
            </propertySheet>
          </property>
        </propertySheet>
      </property>
      <property>
        <propertyName>scripts</propertyName>
        <description>A list of Perl helpers</description>
        <propertySheet>
          <property>
            <propertyName>jobTemplate</propertyName>
            <description />
            <expandable>1</expandable>
            <value>$[/myProcedure/procedureName]_$[/increment /server/counters/EC-Admin/jobCounter]</value>
          </property>
          <property>
            <propertyName>perlCommonLib</propertyName>
            <description>Perl Library (format agnostic) for:

 - getP: a simple getPropertycall. Return undef in case of error
 - humanSize: return a size in human readable string
 - compareVersion: a function to compare artifact version strings in the form of x.y.z....</description>
            <expandable>1</expandable>
            <value>#############################################################################
#
# Compare 2 version number strings like x.y.z... section by section
# return 1 if V1 > v2
# return 0 if v1 == v2
# return -1 if v1 &lt; v2
#
#############################################################################
sub compareVersion {

  my ($v1, $v2)=@_;
  
  my @v1Numbers = split('\.', $v1);
  my @v2Numbers = split('\.', $v2);

  for (my $index = 0; $index &lt; scalar(@v1Numbers); $index++) {
    
    # We ran out of V2 numbers => V1 is a bigger version
    return 1 if (scalar(@v2Numbers) == $index);

    # same value, go to next number
    next if ($v1Numbers[$index] == $v2Numbers[$index]);
        
    # V1 is a bigger version
    return 1 if ($v1Numbers[$index] > $v2Numbers[$index]);
           ;
    # V2 is a bigger version
    return -1;
  }

  # We ran out of V1 numbers
  return -1 if(scalar(@v1Numbers) != scalar(@v2Numbers));

  # Same number
  return 0;
}


#############################################################################
#
# Return property value or undef in case of error (non existing)
#
#############################################################################
sub getP
{
  my $prop=shift;

  my($success, $xPath, $errMsg, $errCode)= InvokeCommander("SuppressLog IgnoreError", "getProperty", $prop);
  return undef if ($success != 1);
  my $val= $xPath->findvalue("//value");
  return($val);
}

#############################################################################
#
# Return human readable size
#
#############################################################################
sub humanSize {
  my $size = shift();

  if ($size > 1099511627776) { # TB: 1024 GB
      return sprintf("%.2f TB", $size / 1099511627776);
  }
  if ($size > 1073741824) { # GB: 1024 MB
      return sprintf("%.2f GB", $size / 1073741824);
  }
  if ($size > 1048576) { # MB: 1024 KB
      return sprintf("%.2f MB", $size / 1048576);
  }
  elsif ($size > 1024) { # KiB: 1024 B
      return sprintf("%.2f KB", $size / 1024);
  }
                                  # bytes
  return "$size byte" . ($size &lt;= 1 ? "" : "s");
}</value>
          </property>
          <property>
            <propertyName>perlHeader</propertyName>
            <description>default Perl Header to use the API</description>
            <expandable>1</expandable>
            <value>#############################################################################
#
# Copyright 2013 Electric-Cloud Inc.
#
#############################################################################
use strict;
use English;
use ElectricCommander;
$| = 1;

my $DEBUG=0;

# Create a single instance of the Perl access to ElectricCommander
my $ec = new ElectricCommander();

# Check for the OS Type
my $osIsWindows = $^O =~ /MSWin/;
</value>
          </property>
          <property>
            <propertyName>perlHeaderJSON</propertyName>
            <description>default Perl Header to use the API with JSON format</description>
            <expandable>1</expandable>
            <value>#############################################################################
#
# Copyright 2013 Electric-Cloud Inc.
#
#############################################################################
use strict;
use English;
use ElectricCommander;
use Data::Dumper;
$| = 1;

my $DEBUG=0;

# Create a single instance of the Perl access to ElectricCommander
my $ec = new ElectricCommander({'format' => "json"});

# Check for the OS Type
my $osIsWindows = $^O =~ /MSWin/;


#### Line 20 ####</value>
          </property>
          <property>
            <propertyName>perlLib</propertyName>
            <description>Perl Libraries for:
 - InvokeCommander: Run an ElectricCommander function using the Perl API
 - getPS: return a Hash for porperties contained in a PropertySheet
#-------------------------------------------------------------------------
# Run an ElectricCommander function using the Perl API
#
# Params
# optionFlags - "AllowLog" or "SuppressLog" or "SuppressResult"
# combined with "IgnoreError"
# commanderFunction
# Variable Parameters
# The parameters required by the ElectricCommander function
# according to the Perl API. See the ElectricCommander
# Help system for more information.
# (the functions and paramenter are based on "ectool" - run it for documentation)
#
# Returns
# success - 1 if no error was detected
# xPath - an XML::XPath object with the result.
# errMsg - a message string extracted from Commander on error
# errCode - the code part &lt;code> of the XML
#-------------------------------------------------------------------------</description>
            <expandable>1</expandable>
            <value>$[/javascript 
var p;
if (typeof(plugins["EC-Admin"].project.Version) == "undefined") {
  p=projects["EC-Admin"].scripts.perlCommonLib;
} else {
  p=plugins["EC-Admin"].project.scripts.perlCommonLib;
}
p;
];

#############################################################################
#
# Invoke a API call
#
#############################################################################
sub InvokeCommander {

    my $optionFlags = shift;
    my $commanderFunction = shift;
    my $xPath;
    my $success = 1;

    my $bSuppressLog = $optionFlags =~ /SuppressLog/i;
    my $bSuppressResult = $bSuppressLog || $optionFlags =~ /SuppressResult/i;
    my $bIgnoreError = $optionFlags =~ /IgnoreError/i;

    # Run the command
    # print "Request to Commander: $commanderFunction\n" unless ($bSuppressLog);

    $ec->abortOnError(0) if $bIgnoreError;
    $xPath = $ec->$commanderFunction(@_);
    $ec->abortOnError(1) if $bIgnoreError;

    # Check for error return
    my $errMsg = $ec->checkAllErrors($xPath);
    my $errCode=$xPath->findvalue('//code',)->value();
    if ($errMsg ne "") {
        $success = 0;
    }
    if ($xPath) {
        print "Return data from Commander:\n" .
               $xPath->findnodes_as_string("/") . "\n"
            unless $bSuppressResult;
    }

    # Return the result
    return ($success, $xPath, $errMsg, $errCode);
}


#############################################################################
#
# Return a hash of the properties contained in a Property Sheet.
# Args:
#    1. Property Sheet path
#    2. Recursive boolean
#############################################################################
sub getPS
{
  my $psPath=shift;
  my $recursive=shift;
  
  my $hashRef=undef;
  
  my($success, $result, $errMsg, $errCode)=InvokeCommander("SuppressLog IgnoreError", "getProperties", {'path'=>$psPath});
  return $hashRef if (!$success);
  
 my $nodeset=$result->find('//property');
  foreach my $node ($nodeset->get_nodelist) {
	my $propName=$result->findvalue('propertyName',    $node);
    my $value   =$result->findvalue('value',           $node);
    my $psId    =$result->findvalue('propertySheetId', $node);
    
    # this is not a nested PS    
    if ($psId eq '') {
      $hashRef->{$propName}=$value;
    } else {
      # nested PropertySheet
      if ($recursive) {
        $hashRef->{$propName}=getPS("$psPath/$propName");
      } else {
        $hashRef->{$propName}=undef;
      }  
    }
  }
  return $hashRef;
}</value>
          </property>
          <property>
            <propertyName>perlLibJSON</propertyName>
            <description>Perl Libraries (JSON Format) for:
 - InvokeCommander: Run an ElectricCommander function using the Perl API
 - getPS: return a Hash for porperties contained in a PropertySheet

#-------------------------------------------------------------------------
# Run an ElectricCommander function using the Perl API
#
# Params
# optionFlags - "AllowLog" or "SuppressLog" or "SuppressResult"
# combined with "IgnoreError"
# commanderFunction
# Variable Parameters
# The parameters required by the ElectricCommander function
# according to the Perl API. See the ElectricCommander
# Help system for more information.
# (the functions and paramenter are based on "ectool" - run it for documentation)
#
# Returns
# success - 1 if no error was detected
# xPath - an XML::XPath object with the result.
# errMsg - a message string extracted from Commander on error
# errCode - the code part &lt;code> of the XML
#-------------------------------------------------------------------------</description>
            <expandable>1</expandable>
            <value>$[/javascript 
var p;
if (typeof(plugins["EC-Admin"].project.Version) == "undefined") {
  p=projects["EC-Admin"].scripts.perlCommonLib;
} else {
  p=plugins["EC-Admin"].project.scripts.perlCommonLib;
}
p;
];

#############################################################################
#
# Invoke a API call
#
#############################################################################
sub InvokeCommander {

    my $optionFlags = shift;
    my $commanderFunction = shift;
    my $result;
    my $success = 1;
	my $errMsg;
	my $errCode;

    my $bSuppressLog = $optionFlags =~ /SuppressLog/i;
    my $bSuppressResult = $bSuppressLog || $optionFlags =~ /SuppressResult/i;
    my $bIgnoreError = $optionFlags =~ /IgnoreError/i;

    # Run the command
    # print "Request to Commander: $commanderFunction\n" unless ($bSuppressLog);

    $ec->abortOnError(0) if $bIgnoreError;
    $result = $ec->$commanderFunction(@_);
    $ec->abortOnError(1) if $bIgnoreError;

    # Check for error return
    if (defined ($result->{responses}->[0]->{error})) {
    	$errCode=$result->{responses}->[0]->{error}->{code};
    	$errMsg=$result->{responses}->[0]->{error}->{message};
    }

    if ($errMsg ne "") {
        $success = 0;
    }
    if ($result) {
        print "Return data from Commander:\n" .
               Dumper($result) . "\n"
            unless $bSuppressResult;
    }

    # Return the result
    return ($success, $result, $errMsg, $errCode);
}


#############################################################################
#
# Return a hash of the properties contained in a Property Sheet.
# Args:
#    1. Property Sheet path
#    2. Recursive boolean
#############################################################################
sub getPS
{
  my $psPath=shift;
  my $recursive=shift;
  
  my $hashRef=undef;;
  
  my($success, $result, $errMsg, $errCode)=InvokeCommander("SuppressLog IgnoreError", "getProperties", {'path'=>$psPath});
  return $hashRef if (!$success);
  
  foreach my $node ($result->findnodes('//property')) {
	my $propName=$node->{'propertyName'};
    my $value=$node->{'value'};
    if (defined ($value)) {
      $hashRef->{$propName}=$node->{'value'};
    } else {
      # nested PropertySheet
      if ($recursive) {
        $hashRef->{$propName}=getPS("$psPath/$propName");
      } else {
        $hashRef->{$propName}=undef;
      }  
    }
  }
  return $hashRef;
}</value>
          </property>
        </propertySheet>
      </property>
      <property>
        <propertyName>ec_setup</propertyName>
        <expandable>1</expandable>
        <value># Data that drives the create step picker registration for this plugin.
my %acquireSemaphore = ( 
  label       => "EC-Admin - acquireSemaphore", 
  procedure   => "acquireSemaphore", 
  description => "Acquire a token in order to limit access to a set of procedures.", 
  category    => "Administration" 
);

my %artifactsCleanup = ( 
  label       => "EC-Admin - artifactsCleanup", 
  procedure   => "artifactsCleanup", 
  description => "Delete old artifacts and clean caches.", 
  category    => "Administration" 
);

my %artifactsCleanup_byQuantity = ( 
  label       => "EC-Admin - artifactsCleanup_byQuantity", 
  procedure   => "artifactsCleanup_byQuantity", 
  description => "Delete old artifacts and clean caches.", 
  category    => "Administration" 
);

my %createPluginFromProject = ( 
  label       => "EC-Admin - createPluginFromProject", 
  procedure   => "createPluginFromProject", 
  description => "Transform a project into a plugin", 
  category    => "Administration" 
);

my %deleteObjects = ( 
  label       => "EC-Admin - deleteObjects", 
  procedure   => "deleteObjects", 
  description => "A procedure to quickly delete jobs or workflows older than a specified number of days. It will NOT delete associated workspace job directories.", 
  category    => "Administration" 
);

my %deleteWorkspaceOrphans = ( 
  label       => "EC-Admin - deleteWorkspaceOrphans", 
  procedure   => "deleteWorkspaceOrphans", 
  description => "Procedure to crawl a workspace directory to find orphan jobs (directories without a matching job)", 
  category    => "Administration" 
);

my %jobCleanup_byResult = ( 
  label       => "EC-Admin - jobCleanup_byResult", 
  procedure   => "jobCleanup_byResult", 
  description => "Delete jobs and the associated workspace based on  result: keeping X goods/warning, and Y failed
Report the number of jobs, the disk space and database space that could/was be deleted.", 
  category    => "Administration" 
);

my %jobsCleanup = ( 
  label       => "EC-Admin - jobsCleanup", 
  procedure   => "jobsCleanup", 
  description => "Delete jobs older than a number of days, along with the associated workspace.", 
  category    => "Administration" 
);

my %performanceMetrics = ( 
  label       => "EC-Admin - performanceMetrics", 
  procedure   => "performanceMetrics", 
  description => "Performance diagnostics for EC server and agents.", 
  category    => "Administration" 
);

my %projectAsCode = ( 
  label       => "EC-Admin - projectAsCode", 
  procedure   => "projectAsCode", 
  description => "Transform a project into a plugin", 
  category    => "Administration" 
);

my %releaseSemaphore = ( 
  label       => "EC-Admin - releaseSemaphore", 
  procedure   => "releaseSemaphore", 
  description => "Procedure to release the token.", 
  category    => "Administration" 
);

my %saveAllObjects = ( 
  label       => "EC-Admin - saveAllObjects", 
  procedure   => "saveAllObjects", 
  description => "This procedure brings a finer granularity to a full server export. For example to retrieve an object after a wrong action or a bad code change. By default it exports projects and each procedure individually. In addition by enabling the matching checkboxes, you can also export resources, resource pools, workspaces, users and groups.", 
  category    => "Administration" 
);

my %saveProjects = ( 
  label       => "EC-Admin - saveProjects", 
  procedure   => "saveProjects", 
  description => "a framework to export projects.", 
  category    => "Administration" 
);

my %synchronizePlugins = ( 
  label       => "EC-Admin - synchronizePlugins", 
  procedure   => "synchronizePlugins", 
  description => "A procedure to synchronize plugins between the server and a resource. Plugins are uploaded first as artifacts and downloaded on the resource if it does not already exist.", 
  category    => "Administration" 
);

my %workflowCleanup = ( 
  label       => "EC-Admin - workflowCleanup", 
  procedure   => "workflowCleanup", 
  description => "Delete workflows older than a number of days.
Report the number of workflows.", 
  category    => "Administration" 
);

@::createStepPickerSteps = (\%acquireSemaphore, \%artifactsCleanup, \%artifactsCleanup_byQuantity, \%createPluginFromProject, \%deleteObjects, \%deleteWorkspaceOrphans, \%jobCleanup_byResult, \%jobsCleanup, \%performanceMetrics, \%projectAsCode, \%releaseSemaphore, \%saveAllObjects, \%saveProjects, \%synchronizePlugins, \%workflowCleanup);

</value>
      </property>
      <property>
        <propertyName>ec_visibility</propertyName>
        <expandable>1</expandable>
        <value>pickListOnly</value>
      </property>
      <property>
        <propertyName>help</propertyName>
        <description>Help page for the plugin version</description>
        <expandable>1</expandable>
        <value>&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

&lt;html xmlns="http://www.w3.org/1999/xhtml">
&lt;head>
	&lt;meta content="text/html; charset=us-ascii" http-equiv="content-type" />
	&lt;title>EC-Admin Plugin&lt;/title>
	&lt;style>
/* pluginhelp.css -
 *
 * This file defines styles used for displaying plugin documentation.
 *
 * Copyright (c) 2006-2014 Electric Cloud, Inc.
 * All rights reserved
 */

.help {
    font-family: Times New Roman, Times, serif;
    font-size: 16px;
    margin: 10px 10px 0px 30px;
}

.help h1 {
    font-family: Verdana, Helvetica, sans-serif;
    font-size: 25.89px;
    font-weight: bold;
    color: #4670B8;
    margin-left: -10px;
}

.help h2 {
    font-family: Verdana, Helvetica, sans-serif;
    font-size: 125%;
    font-weight: bold;
    color: #5981BD;
    margin-left: -10px;
}

.help h3 {
    font-family: Verdana, Helvetica, sans-serif;
    font-size: 115%;
    font-weight: bold;
    color: #5981BD;
}

.help h4 {
    font-family: Verdana, Helvetica, sans-serif;
    font-size: 100%;
    font-weight: bold;
    font-style: italic;
    color: #5981BD;
}

.help a {
    color: #333333;
    text-decoration: none;
    padding: 1px;
    background-image: url(../lib/images/dottedBorder1.gif);
    background-position: bottom;
    background-repeat: repeat-x;
}

.help a:hover {
    color: #CC6600;
    background-image: url(../lib/images/dottedBorder1Hover.gif);
}

.help ul li {
    list-style-position: outside;
    padding-bottom: 4px;
    font-size: 110%;
    margin-left: 5pt;
}

.help pre {
    font-size: 100%;
}

.help img {
    margin-top: 15px;
    margin-bottom: 8 px;
    margin-left: 30px;
    border-style: solid;
    border-width: 1px;
}

.grid {
    border-collapse: collapse;
    width: 900px;
    margin: 15px 0px 0px 30px;
}
    
.grid td {
    border-style: solid;
    border-width: 1px;
    padding: 3px 10px 3px 5px;
    font-size: 110%;
   
}

.grid th {
    border-style: solid;
    border-width: 1px;
    padding-right: 10px;
    padding-left: 5px;
    padding-top: 3px;
    padding-bottom: 3px;
    font-size: 110%;
    text-align: left;
    vertical-align: bottom;
}

.help .required {
    font-weight: bold;
    font-style: italic;
}

.help a:link {
    text-decoration:underline;
}

.help div > a {
    display: none;
}
	&lt;/style>

&lt;/head>

&lt;body>
    &lt;div class="help">
		&lt;h1>EC-Admin&lt;/h1>
&lt;p>Plugin Version $[/myProject/version]&lt;/p>
    	&lt;hr style="margin-left: -10px; margin-top: 10px; height: 1px; width: 100%; color: #5981BD;" noshade="noshade" />

        &lt;p>EC-Admin is a collection of administrative procedures to help you
manage your server. Its inception was sparked by requests from customers
during my Professional Services engagements. It has grown over the years to
what it is now.&lt;/p>

		&lt;p>It contains the following modules:&lt;/p>
		&lt;ul>
			&lt;li>&lt;a href="#jobs">Jobs and Workspaces management&lt;/a>&lt;/li>
			&lt;li>&lt;a href="#plugin">Plugins&lt;/a>&lt;/li>
			&lt;li>&lt;a href="#artifacts">Artifacts management&lt;/a>&lt;/li>
			&lt;li>&lt;a href="#backup">Object export and backup&lt;/a>&lt;/li>
			&lt;li>&lt;a href="#semaphore">Semaphore management&lt;/a>&lt;/li>
			&lt;li>&lt;a href="#perf">Performance metrics&lt;/a>&lt;/li>
		&lt;/ul>

		&lt;h2>&lt;a name="installation">&lt;/a>Installation&lt;/h2>
		
        &lt;p>This collection of procedures can be found on our &lt;a
href="https://github.com/electriccommunity/electriccommander/tree/master/EC-
Admin">community  repository on GitHub&lt;/a>. It is available either as a simple
XML project export or as  a plugin delivered in the form of a .jar file.&lt;/p>

		&lt;p>To install the plugin, use the "Install from File/URL" tab in the
			administration/Plugins or use the "installPlugin" API.&lt;/p>
		&lt;p>To install the .xml project export, use the "import "API call as 
			following:
		&lt;br/>ectool import /path_to/EC-Admin.xml --disableSchedules 1&lt;/p>
 
		&lt;p>To install on 4.0.x or or 4.1.x, import the EC_4.0.xml file. Be 
			aware that some features are not present as the original project 
			makes use of createJobStep() API which was introduced in 4.2.0:&lt;br/>
ectool import /path_to/EC-Admin_for_EC_4.0.xml --disableSchedules 1&lt;/p>

		&lt;p>If you get an error with the passKey, use the "--force 1" option&lt;/p>

		&lt;h1>&lt;a name="jobs">&lt;/a>Jobs and Workspaces management&lt;/h1>
		&lt;p>This set of procedures will help you manage your old jobs and the 
			associated workspaces.&lt;/p>
			&lt;h2>jobsCleanup:&lt;/h2> 
			&lt;p>A procedure to delete jobs older than a specified number of
days. It will also delete associated workspace job directories. You
can also provide a property name, if this property is attached to the
job, it won't be deleted no matter how old. A report only mode
prevents any real deletion.&lt;/p>

			&lt;h2>jobCleanup_byResult:&lt;/h2> 
            &lt;p>A procedure to delete jobs older than a specified number of days.
It will also delete associated workspace job directories. It will keep the
number of successful, failed and warning jobs you entered. You can also
provide a property name, if this property is attached to the job, it won't be
deleted no matter how old. A report only mode prevents any real deletion.&lt;/p>

			&lt;h2>deleteWorksapceOrphans:&lt;/h2> 

            &lt;p>A procedure to crawl a workspace directory to find orphan jobs
(directories without a matching job) on a specified resource.&lt;/p>

			&lt;h2>deleteObjects:&lt;/h2> 
            &lt;p>A procedure to quickly delete jobs or workflows older than a
specified number of days. It will &lt;b>not&lt;/b> delete associated workspace job
directories. This is for customers with huge job or workflow database.&lt;/p>


		&lt;h1>&lt;a name="plugin">&lt;/a>Plugins&lt;/h1>
		&lt;h2>Plugin Synchronization&lt;/h2>
		&lt;p>This procedure synchronizes plugins between the server and 
		a resource. Plugins are uploaded first as artifacts it has not been 
		done already and then downloaded on the resource if it does not 
		already exist in the plugins directory.&lt;/p>
		
		&lt;h2>Plugin creation&lt;/h2>
		&lt;h3>createPluginFromProject&lt;/h3>
		&lt;p>&lt;b>Note:&lt;/b> This procedure requires access to the jar or zip 
			executable in the PATH.&lt;/p>
		&lt;p>The procedure "createPluginFromProject" allows transforming a 
			project into a plugin. The parameters are the following:&lt;/p>
			&lt;dl>
				&lt;dt>&lt;b>Author:&lt;/b>&lt;/dt>
				&lt;dd>The author of the project to transform into a plugin&lt;/dd>
				&lt;dt>&lt;b>Email:&lt;/b>&lt;/dt>
				&lt;dd>The email of the author&lt;/dd>
				&lt;dt>&lt;b>Category&lt;/b>:&lt;/dt>
				&lt;dd>The category of the plugin. It helps filter the plugin in
				the Plugins page and in the pickerList.&lt;/dd>
				&lt;dt>&lt;b>Description&lt;/b>:&lt;/dt>
				&lt;dd>The description of the plugin do display in the main 
					plugin page. If left empty it will default to the 
					description of the project.&lt;/dd>
				&lt;dt>&lt;b>installPlugin&lt;/b>:&lt;/dt>
				&lt;dd>A Boolean to install or not the plugin after creation&lt;/dd>
				&lt;dt>&lt;b>promotePlugin&lt;/b>:&lt;/dt>
				&lt;dd>A Boolean to promote or not the plugin after installation&lt;/dd>
				&lt;dt>&lt;b>Plugin&lt;/b>:&lt;/dt>
				&lt;dd>The name of the plugin. If left empty, it will default to
				the project name.&lt;/dd>
				&lt;dt>&lt;b>Project&lt;/b>:&lt;/dt>
				&lt;dd>The name of the project to transform into a plugin&lt;/dd>
				&lt;dt>&lt;b>Version&lt;/b>:&lt;/dt>
				&lt;dd>Version of the plugin to create.&lt;/dd>
			&lt;/dl>
		&lt;p>At the project level, you can define the following properties to 
			alter the behavior of the plugin creation:&lt;/p>
			&lt;dl>
				&lt;dt>&lt;b>ec_visibility:&lt;/b>&lt;/dt>
				&lt;dd>Choose &lt;b>all&lt;/b> to have the plugin shows in the project 
					list (like EC-Admin), or &lt;b>pickListOnly&lt;/b> (default) to 
					have your procedures available only through the plugin 
					procedure picker (when you choose plugin as a step).&lt;/dd>
				&lt;dt>&lt;b>help:&lt;/b>&lt;/dt>
				&lt;dd>This property allows you to create a Help page associated 
					with your plugin. The page you are currently reading is 
					created this way so feel free to explore the help property
					 in the EC-Admin plugin/project for an example.&lt;/dd>
				&lt;dt>&lt;b>promoteAction&lt;/b>&lt;/dt>
				&lt;dd>This proeprty would contain some Perl code to take action
					when the plugin change state. Look at the ec_setup property
					in the plugins installed on your system to get a better idea
					of what you can accomplish.&lt;br/>
					For example to set a property hwne the plugin is pomoted 
					you could add the the following code to the promoteAction
					procedure:&lt;br/>
					&lt;pre>&lt;code>
if ( $promoteAction eq 'promote' ) {
    $batch->setProperty( "/projects/$pluginName/addedByPromote", "123" );
}
					&lt;/code>&lt;/pre>
				&lt;/dd>
			&lt;/dl>
		&lt;p>In addition each procedure can modify the behavior with the 
			following 2 properties:&lt;/p>
			&lt;dl>
				&lt;dt>&lt;b>exposeToPlugin:&lt;/b>&lt;/dt>
				&lt;dd>This property if set to 1 will add the procedure to 
					ec_setup to be shown in the procedure pickerList when 
					choosing a plugin step.&lt;/dd>
				&lt;dt>&lt;b>descriptionForPlugin:&lt;/b>&lt;/dt>
				&lt;dd>This property will be shown as the description in the 
					pickerList mentioned above. If it's empty or non-existent,
					 the description will be description of the procedure 
					 itself.&lt;/dd>
			&lt;/dl>

		&lt;h3>projectAsCode&lt;/h3>

		&lt;p>&lt;b>Note:&lt;/b> This procedure requires access to a resource with the 
			Commander SDK installed.&lt;/p>

		&lt;p>This procedure is an extension of createPluginFromProject. It also
		creates a plugin but instead of simply exporting the project, it
		"explodes" each step in its own file for finer granularity check in
		in your favorite SCM tool.&lt;br/>
		In addition, there is an option to extract the project from the plugin 
		upon promotion.&lt;br/>
		All the properties associated with createPluginFromProject still apply.&lt;/p>

		&lt;h1>&lt;a name="artifacts">&lt;/a>Artifact Management&lt;/h1>
		
		&lt;h2>artifactsCleanup&lt;/h2> 
		
		&lt;p>A procedure to delete artifact versions older than a specified number
of days. Same as for jobs above, a property allows preventing the deletion. Once the
artifacts have been deleted, artifact repositories and artifact caches are
cleaned as well (deleting stale artifacts).  A report only mode prevents any
real deletion.&lt;/p>

		&lt;h2>artifactsCleanup_byQuantity&lt;/h2>

		&lt;p>As "ArtifactsCleanup"", this procedure deletes artifact versions 
			older than a specified number
of days but keeps only X per Artifact. Again, a property allows preventing the 
deletion. Once the
artifacts have been deleted, artifact repositories and artifact caches are
cleaned as well (deleting stale artifacts).  A report only mode prevents any
real deletion.&lt;/p>

		&lt;h1>&lt;a name="backup">&lt;/a>Object export and backup&lt;/h1>

        &lt;p>This set of procedures is to help you export objects from
ElectricCommander for a potential inclusion into your SCM for
versioning.&lt;/p>
		
		&lt;h2>saveProjects&lt;/h2>

        &lt;p>This procedure simply exports your projects in a directory on the
server. It is recommended to enable the nightly schedule associated
with it to backup your projects on a regular basis.&lt;/p>

		&lt;h2>saveAllObjects&lt;/h2>

        &lt;p>This procedure brings a finer granularity to a full server export. For 
example to retrieve an object after a wrong action or a bad code change. By 
default it exports projects and each procedure individually. In addition by 
enabling the matching checkboxes, you can also export resources, 
resource pools, workspaces, users and groups.&lt;/p>

		&lt;h1>&lt;a name="semaphore">&lt;/a>Semaphore Management&lt;/h1>

		&lt;h2>acquireSemaphore and releaseSemaphore:&lt;/h2>
			
		&lt;p>Those 2 procedures are used to create a 
gate for a set of steps. The important part is to use a resource with a step 
limit of one to ensure the atomicity of increasing and decreasing the gate 
value.&lt;/p>

		&lt;h1>&lt;a name="perf">&lt;/a>Performance metrics&lt;/h1>
		&lt;p>This procedure returns some information about your 
			ElectricCommander server like number of processors, total RAM, 
			available RAM, 
ping times with agents, relative performance of agents, ... 
In addition it checks the amount of time spent running steps on the server 
local agents as this should be minimized as much as possible.&lt;/p>

		&lt;h1>Contact author&lt;/h1> 
  		&lt;p>Laurent Rochette (&lt;a href="mailto:lrochette@electric-cloud.com">lrochette@electric-cloud.com&lt;/a>) &lt;/p>

	&lt;h1>Legal Jumbo&lt;/h1>
 
	&lt;p>This module is free for use. Modify it however you see fit to better your 
experience using ElectricCommander. Share your enhancements and fixes.&lt;/p>

	&lt;p>This module is not officially supported by Electric Cloud. It has undergone no 
formal testing and you may run into issues that have not been uncovered in the 
limited manual testing done so far.&lt;/p>

	&lt;p>Electric Cloud should not be held liable for any repercussions of using this 
software.&lt;/p>
	&lt;/div>
&lt;/body>
&lt;/html></value>
      </property>
      <property>
        <propertyName>jobCounter</propertyName>
        <description>In preparation of changes in 5.0 with jobId.</description>
        <expandable>1</expandable>
        <value>20</value>
      </property>
      <property>
        <propertyName>pluginBuildNumber</propertyName>
        <description />
        <expandable>1</expandable>
        <value>66</value>
      </property>
      <property>
        <propertyName>version</propertyName>
        <description>Version of the EC-Admin project

History:
- version 1.10.1
    + Added creation of CHANGELOG in projectAsCode.

- version 1.10.0
    + Added a new procedure projectAsCode. See Help for details

- version 1.9.0
    + Added a hook to allow actions to be taken when the plugin changes state in createPluginFromProject

- version 1.8.0
    + Added feature to save plugin as an artifact version in createPluginFromProject
 
- version 1.7.1
    + Fixed location of the saved filter for RunReport_Performance_Schedule schedule

- version 1.7.0
    + Added a step to fix self reference to the project in createPluginFromProject

- version 1.6.2
     +   Fixed with resource default  workspace not being used in dynamic steps in performanceMetrics
     +   Fixed subprocedure call to myProject instead of a fixed call to EC-Admin in performanceMetrics
     +  Fixed ec_visbility in createPluginFromProject

- version 1.6.1
     +  Fixed problem with ec_setup and procedure names with dot (".") in createPluginFromProject

- version 1.6.0
     + increased perlHeaderJson length to exactly 20 lines
     + add a procedure subPM-deploymentSize to calculate Commander environment size

- version1.5.2
     + Rewrote localUsage to access jobStepsDirectly
     + localUsage is also now a standalone procedure (subPM-localUsage)

- version1.5.1
     + First user submitted patch by Kate McCormack: 
                   Adding setTimeout equal to 600 so the ec commands won't time out in saveAllObjects and saveProjects

-version 1.5.0
     + added synchronizePlugins procedure to copy plugins from the server to an agent
     + fixed Email address URL in createPluginFromProject

- version 1.4.5
     + Use zip when jar is not available to package plugin
- version 1.4.4
     + Fixed Windows path issue for createPluginFromProject
     + Fixed jar error not reported
- version 1.4.3
     + Ignored sub-steps for localUsage
     + Added comparison for /server/hostIP and /server/hostName
- version 1.4.2
     + Updated help page
- version 1.4.1
     + Fixed percentage formatting
- version 1.4.0
     + Add localUsage statistics in performanceMetrics
     + Remove project ec_tags and other meaningless properties

- version 1.3.9
     + Added a time limit for performanceMetric

- version 1.3.8
     + Fixed ec_visbility  bugs in createPluginFromProject
     + Fixed descriptionForPlugin  bug in createPluginFromProject
     + Fixed several procedure descriptions for the plugin
     + Added help about project level properties for createPluginFromProject
     +  Fixed problem with ec_setup and procedure names with dot (".") in createPluginFromProject

- version 1.3.7
    + removed jobId references in preparation of EC 5.0
    + added artifactsCleanup_byQuantity t clean AV but keep at least X.

- version 1.3.6
    +  saveProject:
        o Add chmod after directory creation for cases when server service and server agent service users are different.
    + Added saveAllObjects procedure to export a bunch of objects individually for finer granularity in the backup
    + Completed the plugin help
    + Added license usage information in performanceMetrics
    + Added a sort to deleteObjects to prevent job range overlapping.

- version 1.3.5
    + Added automatic performance charting
    + Bug fixes
    + Also available as a plugin.
    +  jobsCleanup and jobCleanup_byResult:
         o Add a parameter to skip the computation of the disk space used; to speed up the job
    + Semaphore
         o Added a local job counter to decrement the global gate value. Useful when aborting a job.
           Simply a step that "always run" that will decrement your global gate by /myJob/localSemaphoreCounter
    + createPluginFromProject 
         o Added to automatically create a plugin from a project

- version 1.3.4
    + Better resource management for artifactsCleanup and cleanupRepository
    + perforrmanceMetrics:
          o  Fix bug on Free available RAM with European numbers
          o  Add error management on fsutil call (Windows)
          o  Add a cleanup step for temporary file used in Disk Performance
    + Refactor jobCleanup_byResult to include Workflow and schedule jobs
       Add time parameter
    + Add compareVersion in the PerlLib to compare number strings like x.y.z....

- version 1.3.3
    + Added getPS() function in perlLib (JSON and XML format)
    + Added ec_parameterForm to artifactsCleanup to give it the same look and feel than jobCleanup
    + Took advantage of createJobStep to simplify  artifactsCleanup

- version 1.3.2
    + Added "available disk space" information in performanceMetrics procedure
    + Fixed bug with getP()
    + Added Perl header and library for JSON format
    + Added new parameters for saveProjects (relocatable, ACLs and notifiers)

- version 1.3.1:
    + Added "available memory" information in performanceMetrics procedure

- version 1.3:
    + New procedure to delete jobs by results
    + New parameter to cleanupJobs to skip jobs matching a pattern

- version 1.2:  
    + New  performance diagnostic procedure
    + provide a getP Perl function for easy getProperty
    + New procedure to delete workspace orphan job directories

- version 1.1: 
      semaphore management
      saveProjects

- version 1.0: 
      initial version including job and artifact management</description>
        <expandable>1</expandable>
        <value>1.10.1</value>
      </property>
    <property><propertyName>ec_setup</propertyName><value># Data that drives the create step picker registration for this plugin.
my %acquireSemaphore = ( 
  label       => "EC-Admin - acquireSemaphore", 
  procedure   => "acquireSemaphore", 
  description => "Acquire a token in order to limit access to a set of procedures.", 
  category    => "Administration" 
);

my %artifactsCleanup = ( 
  label       => "EC-Admin - artifactsCleanup", 
  procedure   => "artifactsCleanup", 
  description => "Delete old artifacts and clean caches.", 
  category    => "Administration" 
);

my %artifactsCleanup_byQuantity = ( 
  label       => "EC-Admin - artifactsCleanup_byQuantity", 
  procedure   => "artifactsCleanup_byQuantity", 
  description => "Delete old artifacts and clean caches.", 
  category    => "Administration" 
);

my %createPluginFromProject = ( 
  label       => "EC-Admin - createPluginFromProject", 
  procedure   => "createPluginFromProject", 
  description => "Transform a project into a plugin", 
  category    => "Administration" 
);

my %deleteObjects = ( 
  label       => "EC-Admin - deleteObjects", 
  procedure   => "deleteObjects", 
  description => "A procedure to quickly delete jobs or workflows older than a specified number of days. It will NOT delete associated workspace job directories.", 
  category    => "Administration" 
);

my %deleteWorkspaceOrphans = ( 
  label       => "EC-Admin - deleteWorkspaceOrphans", 
  procedure   => "deleteWorkspaceOrphans", 
  description => "Procedure to crawl a workspace directory to find orphan jobs (directories without a matching job)", 
  category    => "Administration" 
);

my %jobCleanup_byResult = ( 
  label       => "EC-Admin - jobCleanup_byResult", 
  procedure   => "jobCleanup_byResult", 
  description => "Delete jobs and the associated workspace based on  result: keeping X goods/warning, and Y failed
Report the number of jobs, the disk space and database space that could/was be deleted.", 
  category    => "Administration" 
);

my %jobsCleanup = ( 
  label       => "EC-Admin - jobsCleanup", 
  procedure   => "jobsCleanup", 
  description => "Delete jobs older than a number of days, along with the associated workspace.", 
  category    => "Administration" 
);

my %performanceMetrics = ( 
  label       => "EC-Admin - performanceMetrics", 
  procedure   => "performanceMetrics", 
  description => "Performance diagnostics for EC server and agents.", 
  category    => "Administration" 
);

my %projectAsCode = ( 
  label       => "EC-Admin - projectAsCode", 
  procedure   => "projectAsCode", 
  description => "Transform a project into a plugin", 
  category    => "Administration" 
);

my %releaseSemaphore = ( 
  label       => "EC-Admin - releaseSemaphore", 
  procedure   => "releaseSemaphore", 
  description => "Procedure to release the token.", 
  category    => "Administration" 
);

my %saveAllObjects = ( 
  label       => "EC-Admin - saveAllObjects", 
  procedure   => "saveAllObjects", 
  description => "This procedure brings a finer granularity to a full server export. For example to retrieve an object after a wrong action or a bad code change. By default it exports projects and each procedure individually. In addition by enabling the matching checkboxes, you can also export resources, resource pools, workspaces, users and groups.", 
  category    => "Administration" 
);

my %saveProjects = ( 
  label       => "EC-Admin - saveProjects", 
  procedure   => "saveProjects", 
  description => "a framework to export projects.", 
  category    => "Administration" 
);

my %synchronizePlugins = ( 
  label       => "EC-Admin - synchronizePlugins", 
  procedure   => "synchronizePlugins", 
  description => "A procedure to synchronize plugins between the server and a resource. Plugins are uploaded first as artifacts and downloaded on the resource if it does not already exist.", 
  category    => "Administration" 
);

my %workflowCleanup = ( 
  label       => "EC-Admin - workflowCleanup", 
  procedure   => "workflowCleanup", 
  description => "Delete workflows older than a number of days.
Report the number of workflows.", 
  category    => "Administration" 
);

@::createStepPickerSteps = (\%acquireSemaphore, \%artifactsCleanup, \%artifactsCleanup_byQuantity, \%createPluginFromProject, \%deleteObjects, \%deleteWorkspaceOrphans, \%jobCleanup_byResult, \%jobsCleanup, \%performanceMetrics, \%projectAsCode, \%releaseSemaphore, \%saveAllObjects, \%saveProjects, \%synchronizePlugins, \%workflowCleanup);

</value></property><property><propertyName>project_version</propertyName><value>1.10.1.66</value></property></propertySheet>
    <credential>
      <credentialName>adminLogin</credentialName>
      <description />
      <password>/DHePBz5RUcyoG7IRp4eyQ==</password>
      <userName>admin</userName>
      <propertySheet>
      </propertySheet>
    </credential>
    <credential>
      <credentialName>productionServerCreds</credentialName>
      <description>Credentials to log onto the production server to import a project or a set of procedures/workflows</description>
      <password>/DHePBz5RUcyoG7IRp4eyQ==</password>
      <userName>admin</userName>
      <propertySheet>
      </propertySheet>
    </credential>
    <procedure>
      <procedureName>acquireSemaphore</procedureName>
      <description>Procedure to acquire a token in order to limit access to a set of procedures

Changelog:
--------------
 10-04-2013   lrochette   Add job counter to help abort a job.</description>
      <jobNameTemplate>$[/myProject/scripts/jobTemplate]</jobNameTemplate>
      <resourceName />
      <timeLimit />
      <timeLimitUnits>minutes</timeLimitUnits>
      <workspaceName />
      <propertySheet>
        <property>
          <propertyName>ec_customEditorData</propertyName>
          <propertySheet>
            <property>
              <propertyName>parameters</propertyName>
              <propertySheet>
                <property>
                  <propertyName>maxSemaphoreValue</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>semaphoreProperty</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>serializationResource</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
              </propertySheet>
            </property>
          </propertySheet>
        </property>
        <property>
          <propertyName>descriptionForPlugin</propertyName>
          <description>Description used in the pickerList when transformed into a plugin</description>
          <expandable>1</expandable>
          <value>Acquire a token in order to limit access to a set of procedures.</value>
        </property>
        <property>
          <propertyName>exposeToPlugin</propertyName>
          <description>So the procedure is shown in the pickerList</description>
          <expandable>1</expandable>
          <value>1</value>
        </property>
        <property>
          <propertyName>pluginExpose</propertyName>
          <description />
          <expandable>1</expandable>
          <value>1</value>
        </property>
      </propertySheet>
      <formalParameter>
        <formalParameterName>maxSemaphoreValue</formalParameterName>
        <defaultValue />
        <description>The maximum sempahore value to gate some procedures.</description>
        <expansionDeferred>0</expansionDeferred>
        <required>1</required>
        <type>entry</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>semaphoreProperty</formalParameterName>
        <defaultValue />
        <description>The path to the property used as a semaphore</description>
        <expansionDeferred>0</expansionDeferred>
        <required>1</required>
        <type>entry</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>serializationResource</formalParameterName>
        <defaultValue />
        <description>This should point to a resouce with a step limit of 1</description>
        <expansionDeferred>0</expansionDeferred>
        <required>1</required>
        <type>entry</type>
      </formalParameter>
      <step>
        <stepName>acquireSemaphore</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>use strict;
use ElectricCommander;
$| = 1;

my $ec = new ElectricCommander;
my $xPath = $ec->getProperty("$[semaphoreProperty]");
my $semaphore = $xPath->findvalue('//value')->string_value;
print "First eval: semaphore = $semaphore\n";

while ($semaphore >= $[maxSemaphoreValue]){
  $ec->setProperty("summary", "Waiting for Semaphore");
  sleep(5);
  $xPath = $ec->getProperty("$[semaphoreProperty]");
  $semaphore = $xPath->findvalue('//value')->string_value;
  print "in loop: semaphore = $semaphore\n";
}

# When we get here, a token is available. Acquire it.
my $xPath = $ec->incrementProperty("$[semaphoreProperty]");

# Increment local counter as well
my $xPath = $ec->incrementProperty("/myJob/localSemaphoreCounter");

$ec->setProperty("summary", "Semaphore acquired");

</command>
        <condition />
        <description />
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName>$[serializationResource]</resourceName>
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
    </procedure>
    <procedure>
      <procedureName>artifactsCleanup</procedureName>
      <description>Delete Artifacts and clean caches.
A resource matching the Repository server is required or some steps will be skipped.

Changelog:
--------------
 08-07-2013  lrochette     Better Resource management: test for existence, alive and enabled before invoking cleanupRepository.

 07-29-2013  lrochette     Added ec_parameterForm to give it the same look and feel than jobCleanup
                                         Took advantage of createJobStep to simplify the procedure</description>
      <jobNameTemplate>$[/myProject/scripts/jobTemplate]</jobNameTemplate>
      <resourceName />
      <timeLimit />
      <timeLimitUnits>minutes</timeLimitUnits>
      <workspaceName />
      <propertySheet>
        <property>
          <propertyName>ec_customEditorData</propertyName>
          <propertySheet>
            <property>
              <propertyName>parameters</propertyName>
              <propertySheet>
                <property>
                  <propertyName>adminLogin</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>artifactProperty</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>executeDeletion</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>true</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>0</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>false</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>olderThan</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
              </propertySheet>
            </property>
          </propertySheet>
        </property>
        <property>
          <propertyName>descriptionForPlugin</propertyName>
          <description>Description used in the pickerList when transformed into a plugin</description>
          <expandable>1</expandable>
          <value>Delete old artifacts and clean caches.</value>
        </property>
        <property>
          <propertyName>ec_parameterForm</propertyName>
          <description />
          <expandable>1</expandable>
          <value>&lt;editor> 
    &lt;formElement> 
        &lt;label>Delete artifact versions older than&lt;/label> 
        &lt;property>olderThan&lt;/property> 
        &lt;documentation>Indicate the numbers of days after which artifact versions  should be deleted&lt;/documentation> 
        &lt;type>select&lt;/type> 
        &lt;option> 
            &lt;name>1 month&lt;/name> 
            &lt;value>30&lt;/value> 
        &lt;/option> 
        &lt;option> 
            &lt;name>2 months&lt;/name> 
            &lt;value>60&lt;/value> 
        &lt;/option> 
        &lt;option> 
            &lt;name>3 months&lt;/name> 
            &lt;value>91&lt;/value> 
        &lt;/option> 
        &lt;option> 
            &lt;name>6 months&lt;/name> 
            &lt;value>182&lt;/value> 
        &lt;/option> 
        &lt;option> 
            &lt;name>1 year&lt;/name> 
            &lt;value>365&lt;/value> 
        &lt;/option> 
        &lt;value>91&lt;/value> 
        &lt;required>1&lt;/required>
    &lt;/formElement> 
   &lt;formElement> 
        &lt;label>Artifact property&lt;/label> 
        &lt;property>artifactProperty&lt;/property> 
        &lt;documentation>Name of a property attached to your artifact versions. If this property is set, your artifact version won't be deleted.
        &lt;/documentation> 
        &lt;type>entry&lt;/type> 
        &lt;value>doNotDelete&lt;/value> 
        &lt;required>1&lt;/required>
    &lt;/formElement> 
    &lt;formElement> 
        &lt;label>Delete&lt;/label> 
        &lt;property>executeDeletion&lt;/property> 
        &lt;documentation>If this option is not set, only report is done. No real data are deleted&lt;/documentation> 
        &lt;type>select&lt;/type> 
        &lt;option> 
            &lt;name>Report&lt;/name> 
            &lt;value>false&lt;/value> 
        &lt;/option> 
        &lt;option> 
            &lt;name>Delete&lt;/name> 
            &lt;value>true&lt;/value> 
        &lt;/option> 
        &lt;value>false&lt;/value> 
    &lt;/formElement> 

&lt;/editor></value>
        </property>
        <property>
          <propertyName>exposeToPlugin</propertyName>
          <description>So the procedure is shown in the pickerList</description>
          <expandable>1</expandable>
          <value>1</value>
        </property>
      </propertySheet>
      <formalParameter>
        <formalParameterName>artifactProperty</formalParameterName>
        <defaultValue>doNotDelete</defaultValue>
        <description>Name of a property attached to your artifactVersions. If this property is set, your artifactVersions won't be deleted no matter how old it is.
</description>
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>entry</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>executeDeletion</formalParameterName>
        <defaultValue>false</defaultValue>
        <description>If this option is not set, only report is done. No real data are deleted</description>
        <expansionDeferred>0</expansionDeferred>
        <required>1</required>
        <type>checkbox</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>olderThan</formalParameterName>
        <defaultValue>90</defaultValue>
        <description>Indicate the numbers of days after which artifactVersions should be deleted</description>
        <expansionDeferred>0</expansionDeferred>
        <required>1</required>
        <type>entry</type>
      </formalParameter>
      <step>
        <stepName>deleteArtifactVersions</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>#############################################################################
#
#  deleteArtifactVersions -- Script to delete artifacts and caches
#  Copyright 2013 Electric-Cloud Inc.
#
#############################################################################

use DateTime;
$[/myProject/scripts/perlHeader]
$[/myProject/scripts/perlLib]

#############################################################################
#
#  Assign Commander parameters to variables
#
#############################################################################
my $artifactProperty = "$[artifactProperty]";
my $timeLimit = $[olderThan];
my $executeDeletion= "$[executeDeletion]";

#############################################################################
#
#  Global Variables
#
#############################################################################

#############################################################################
#
#  Main
#
#############################################################################

printf("%s artifacts older than $timeLimit days (%s).\n", 
    $executeDeletion eq "true"?"Deleting":"Reporting", 
    calculateDate($timeLimit));

my ($success, $xPath) = InvokeCommander("SuppressLog", "findObjects", 
										"artifact", {sort => [ {propertyName => "groupId",
                                                    order => "ascending"} ]});
# Loop over artifacts
my $nodeset = $xPath->find('//artifact');
foreach my $node ($nodeset->get_nodelist) {
	my $artifactName=$xPath->findvalue('artifactName', $node);
	printf("%s\n", $artifactName);

	# create filterList
	my @filterList;
	push (@filterList, {"propertyName" => 'artifactName',
                    "operator" => "equals",
                    "operand1" => $artifactName});
	push (@filterList, {"propertyName" => "createTime",
 	                    "operator" => "lessThan",
 	                  	"operand1" => calculateDate($timeLimit)});
	push (@filterList, {"propertyName" => $artifactProperty,
                    "operator" => "isNull"});
	my ($success, $xPath) = InvokeCommander("SuppressLog", "findObjects", 
											"artifactVersion",
					 						{'filter' => \@filterList});
	my $versionset = $xPath->findnodes('//artifactVersion');
	foreach my $version ($versionset->get_nodelist) {
		#print $version->findnodes_as_string("/") . "\n";
		my $versionNumber=$version->findvalue('./artifactVersionName', $node);
		if ($executeDeletion eq "true") {
			 my ($success, $xPath) = InvokeCommander("SuppressLog", "deleteArtifactVersion", 
                      $versionNumber);
			printf("\tDeleting %s\n", $versionNumber);
		} else {
			printf("\t%s\n", $versionNumber);
		}

	}	
	printf("\n");
}
#############################################################################
#
#  Calculate the size of the workspace directory
#
#############################################################################
sub getDirSize {
  my $dir  = shift;
  my $size = 0;

  opendir(D,"$dir") || return 0;
  foreach my $dirContent (grep(!/^\.\.?/,readdir(D))) {
     my $st=stat("$dir/$dirContent");
     if (S_ISREG($st->mode)) {
       $size += $st->size;
     } elsif (S_ISDIR($st->mode)) {
       $size += getDirSize("$dir/$dirContent");
     }
  }
  closedir(D);
  return $size;
}

#############################################################################
#
#  Calculate the Date based on now and the number of days required by
#  the user before deleting jobs
#
#############################################################################
sub calculateDate {
    my $nbDays=shift;
    return DateTime->now()->subtract(days => $nbDays)->iso8601() . ".000Z";
}


#############################################################################
#
#  Return human readable size
#
#############################################################################
sub humanSize {
  my $size = shift();

  if ($size > 1099511627776) {    #   TB: 1024 GB
      return sprintf("%.2f TB", $size / 1099511627776);
  }
  if ($size > 1073741824) {       #   GB: 1024 MB
      return sprintf("%.2f GB", $size / 1073741824);
  }
  if ($size > 1048576) {          #   MB: 1024 KB
      return sprintf("%.2f MB", $size / 1048576);
  }
  elsif ($size > 1024) {          #   KiB: 1024 B
      return sprintf("%.2f KB", $size / 1024);
  }
                                  #   bytes
  return "$size byte" . ($size &lt;= 1 ? "" : "s");
}

</command>
        <condition />
        <description>Script to delete old Artifact Versions</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>dynamicCleanRepoProcedure</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>#############################################################################
#
#  Copyright 2013 Electric-Cloud Inc.
#
#############################################################################

use DateTime;
$[/myProject/scripts/perlHeader]
$[/myProject/scripts/perlLib]

#############################################################################
#
#  Assign Commander parameters to variables
#
#############################################################################
my $executeDeletion="$[executeDeletion]";

my ($success, $xPath) = InvokeCommander("SuppressLog", "getRepositories");
my $nodeset = $xPath->find('//repository');

foreach my $node ($nodeset->get_nodelist) {
  my $repoName=$node->findvalue('repositoryName');
  my $repoServerName = $node->findvalue('url');
  my $repoDisabled = $node->findvalue('repositoryDisabled');
  
  printf("AR: %s\n", $repoName);
  #
  # Skip disable repositories
  if ($repoDisabled) {
    printf ("  Repository disabled: Skipping!\n");
    next;
  }
  $repoServerName =~ s#https?://([\-\w]+)(:\d+)?#$1#;

  # checking that the resource exist and is enabled
  # 
  ($success, $xPath) = InvokeCommander("SuppressLog IgnoreError", "getResource", $repoServerName);
  if (! $success) {
    printf("  Associated resource '%s' does not exist. Skipping!\n", $repoServerName);
    next;
  }
  my $resDisabled=$xPath->findvalue('//resource/resourceDisabled');
  if ($resDisabled eq "1") {
    printf("  Associated resource '%s' disabled. Skipping!\n", $repoServerName);
    next;
  }
    
  my $agentAlive=$xPath->findvalue('//resource/agentState/alive');
  if ($agentAlive eq "0") {
    printf("  Associated resource '%s' is not alive. Skipping!\n", $repoServerName);
    next;
  }
  
  my $stepName = "clean Step For ".$repoName;
  $ec->createJobStep({'jobStepName' => $stepName, 
                      'subprocedure' => 'cleanupRepository', 
                      'actualParameter' => [{'actualParameterName' => 'executeDeletion', 'value'=>$executeDeletion},
                                         {'actualParameterName' => 'resource', 'value'=>$repoServerName},
                                        ]
                  });
}                      



</command>
        <condition />
        <description />
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>dynamicCacheCleaningProcedure</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>#############################################################################
#
#  Copyright 2013 Electric-Cloud Inc.
#
#############################################################################

use DateTime;

$[/myProject/scripts/perlHeader]
$[/myProject/scripts/perlLib]

#############################################################################
#
#  Assign Commander parameters to variables
#
#############################################################################
my $executeDeletion="$[executeDeletion]";
my $days=$[olderThan];

#Let's loop on Resources
my ($success, $xPath) = InvokeCommander("SuppressLog", "getResources");
my $nodeset = $xPath->find('//resource');

foreach my $node ($nodeset->get_nodelist) {
  my $resName=$node->findvalue('resourceName');
  my $hostName=$node->findvalue('hostName');
  my $resDisabled=$node->findvalue('resourceDisabled');
  my $agentAlive=$node->findvalue('agentState/alive');
  printf("%s\n\t Disabled: %s\n\t alive: %s\n", $resName, $resDisabled, $agentAlive);

  #
  # Create a sub-step only if agent is alive and not disabled
  # to avoid to have to wait (and fail) for unavailable resources
  if ( ($resDisabled eq "0") &amp;&amp; ($agentAlive eq "1")) {
    my $resName=$node->findvalue('resourceName');
    my $stepName = "clean Artifact Cache Step For ".$resName;
    $ec->createJobStep({'jobStepName'=>$stepName, 
                        'subprocedure' => 'cleanupCacheDirectory', 
                        'actualParameter' => [{'actualParameterName'=>'executeDeletion', 'value'=>$executeDeletion},
                                         {'actualParameterName'=>'olderThan', 'value'=>$days},
                                         {'actualParameterName'=>'resource', 'value'=>$resName}]
                  });
  }
}                      

</command>
        <condition />
        <description />
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
    </procedure>
    <procedure>
      <procedureName>artifactsCleanup_byQuantity</procedureName>
      <description>Delete Artifact Versions, keeping only X by Artifact ; thenclean caches.
A resource matching the Repository server is required or some steps will be skipped.

Changelog:
--------------
</description>
      <jobNameTemplate>$[/myProject/scripts/jobTemplate]</jobNameTemplate>
      <resourceName />
      <timeLimit />
      <timeLimitUnits>minutes</timeLimitUnits>
      <workspaceName />
      <propertySheet>
        <property>
          <propertyName>ec_customEditorData</propertyName>
          <propertySheet>
            <property>
              <propertyName>parameters</propertyName>
              <propertySheet>
                <property>
                  <propertyName>adminLogin</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>artifactProperty</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>deleteDependencies</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>true</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>1</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>false</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>executeDeletion</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>true</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>0</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>false</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>nbToPreserve</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>options</propertyName>
                      <propertySheet>
                        <property>
                          <propertyName>list</propertyName>
                          <expandable>1</expandable>
                          <value>0|1|5|10|25|100</value>
                        </property>
                        <property>
                          <propertyName>type</propertyName>
                          <expandable>1</expandable>
                          <value>simpleList</value>
                        </property>
                      </propertySheet>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>olderThan</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
              </propertySheet>
            </property>
          </propertySheet>
        </property>
        <property>
          <propertyName>descriptionForPlugin</propertyName>
          <description>Description used in the pickerList when transformed into a plugin</description>
          <expandable>1</expandable>
          <value>Delete old artifacts and clean caches.</value>
        </property>
        <property>
          <propertyName>ec_parameterForm</propertyName>
          <description />
          <expandable>1</expandable>
          <value>&lt;editor> 
    &lt;formElement> 
        &lt;label>Delete artifact versions older than&lt;/label> 
        &lt;property>olderThan&lt;/property> 
        &lt;documentation>Indicate the numbers of days after which artifact versions  should be deleted&lt;/documentation> 
        &lt;type>select&lt;/type> 
        &lt;option> 
            &lt;name>1 month&lt;/name> 
            &lt;value>30&lt;/value> 
        &lt;/option> 
        &lt;option> 
            &lt;name>2 months&lt;/name> 
            &lt;value>60&lt;/value> 
        &lt;/option> 
        &lt;option> 
            &lt;name>3 months&lt;/name> 
            &lt;value>91&lt;/value> 
        &lt;/option> 
        &lt;option> 
            &lt;name>6 months&lt;/name> 
            &lt;value>182&lt;/value> 
        &lt;/option> 
        &lt;option> 
            &lt;name>1 year&lt;/name> 
            &lt;value>365&lt;/value> 
        &lt;/option> 
        &lt;value>91&lt;/value> 
        &lt;required>1&lt;/required>
    &lt;/formElement> 

   &lt;formElement> 
        &lt;label>Artifact property&lt;/label> 
        &lt;property>artifactProperty&lt;/property> 
        &lt;documentation>Name of a property attached to your artifact versions. If this property is set, your artifact version won't be deleted.
        &lt;/documentation> 
        &lt;type>entry&lt;/type> 
        &lt;value>doNotDelete&lt;/value> 
        &lt;required>1&lt;/required>
    &lt;/formElement> 

   &lt;formElement> 
        &lt;label>Number to preserve&lt;/label>    
        &lt;property>nbToPreserve&lt;/property>    
        &lt;documentation>The number of artifact versions to preserve per artifact&lt;/documentation> 
        &lt;type>entry&lt;/type>    
        &lt;value>5&lt;/value> 
        &lt;required>1&lt;/required>
    &lt;/formElement> 


    &lt;formElement> 
        &lt;label>Delete&lt;/label> 
        &lt;property>executeDeletion&lt;/property> 
        &lt;documentation>If this option is not set, only report is done. No real data are deleted&lt;/documentation> 
        &lt;type>select&lt;/type> 
        &lt;option> 
            &lt;name>Report&lt;/name> 
            &lt;value>false&lt;/value> 
        &lt;/option> 
        &lt;option> 
            &lt;name>Delete&lt;/name> 
            &lt;value>true&lt;/value> 
        &lt;/option> 
        &lt;value>false&lt;/value> 
    &lt;/formElement> 

&lt;/editor></value>
        </property>
        <property>
          <propertyName>exposeToPlugin</propertyName>
          <description>So the procedure is shown in the pickerList</description>
          <expandable>1</expandable>
          <value>1</value>
        </property>
      </propertySheet>
      <formalParameter>
        <formalParameterName>artifactProperty</formalParameterName>
        <defaultValue>doNotDelete</defaultValue>
        <description>Name of a property attached to your artifactVersions. If this property is set, your artifactVersions won't be deleted no matter how old it is.
</description>
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>entry</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>executeDeletion</formalParameterName>
        <defaultValue>false</defaultValue>
        <description>If this option is not set, only report is done. No real data are deleted</description>
        <expansionDeferred>0</expansionDeferred>
        <required>1</required>
        <type>checkbox</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>nbToPreserve</formalParameterName>
        <defaultValue>5</defaultValue>
        <description>indicate the number of version to keep for each artifact</description>
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>select</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>olderThan</formalParameterName>
        <defaultValue>90</defaultValue>
        <description>Indicate the numbers of days after which artifactVersions should be deleted</description>
        <expansionDeferred>0</expansionDeferred>
        <required>1</required>
        <type>entry</type>
      </formalParameter>
      <step>
        <stepName>deleteAV</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>#############################################################################
#
#  deleteArtifactVersions -- Script to delete artifacts and caches
#  Copyright 2013-2014 Electric-Cloud Inc.
#
#############################################################################

use DateTime;
$[/myProject/scripts/perlHeaderJSON]


####################################################a#########################
#
#  Assign Commander parameters to variables
#
#############################################################################
my $artifactProperty = "$[artifactProperty]";
my $executeDeletion  = "$[executeDeletion]";
my $nbToPreserve     =  $[nbToPreserve];
my $timeLimit       =  $[olderThan];

#############################################################################
#
#  Global Variables
#
#############################################################################

#############################################################################
#
#  Main
#
#############################################################################

printf("%s artifact versions older than $timeLimit days (%s).\n", 
    $executeDeletion eq "true"?"Deleting":"Reporting", 
    calculateDate($timeLimit));
printf("  Preserving %d artifact versions\n", $nbToPreserve);

#
# Loop over each Artifacts
#
my ($ok, $res) = InvokeCommander("SuppressLog", "getArtifacts");
foreach my $art ($res->findnodes('//artifact')) {
  	my $artifactName=$art->{artifactName};
	printf("Processing artifact '%s'\n", $artifactName);

	# create filterList
	my @filterList;
	push (@filterList, {"propertyName" => 'artifactName',
                    "operator" => "equals",
                    "operand1" => $artifactName});
	push (@filterList, {"propertyName" => "createTime",
 	                    "operator" => "lessThan",
 	                  	"operand1" => calculateDate($timeLimit)});
	push (@filterList, {"propertyName" => $artifactProperty,
                    "operator" => "isNull"});
	my ($ok2, $res2) = InvokeCommander("SuppressLog", "findObjects", "artifactVersion",
					 						{'filter' => \@filterList,
                       sort => [ {propertyName => "createTime",
                                  order => "descending"} ]});
  	my $count=1;
  	foreach my $av ($res2->findnodes('//artifactVersion')) {
    	my $avName=$av->{artifactVersionName};
    	printf("\t%s\n", $avName);
    	if ($count &lt;= $nbToPreserve) {
      		printf("\t\tpreserving : %d out of %d\n", $count, $nbToPreserve);
      		$count++;
      		next;
    	} 
		if ($executeDeletion eq "true") {
			my ($success, $xPath) = InvokeCommander("SuppressLog", "deleteArtifactVersion", $avName);
			printf("\t\tDeleting\n");
		}

	}	
	printf("\n");
}


#############################################################################
#
#  Calculate the Date based on now and the number of days required by
#  the user before deleting jobs
#
#############################################################################
sub calculateDate {
    my $nbDays=shift;
    return DateTime->now()->subtract(days => $nbDays)->iso8601() . ".000Z";
}


$[/myProject/scripts/perlLibJSON]
</command>
        <condition />
        <description>Script to delete old Artifact Versions per Artifact</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>dynamicCleanRepoProcedure</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>#############################################################################
#
#  Copyright 2013 Electric-Cloud Inc.
#
#############################################################################

use DateTime;
$[/myProject/scripts/perlHeader]
$[/myProject/scripts/perlLib]

#############################################################################
#
#  Assign Commander parameters to variables
#
#############################################################################
my $executeDeletion="$[executeDeletion]";

my ($success, $xPath) = InvokeCommander("SuppressLog", "getRepositories");
my $nodeset = $xPath->find('//repository');

foreach my $node ($nodeset->get_nodelist) {
  my $repoName=$node->findvalue('repositoryName');
  my $repoServerName = $node->findvalue('url');
  my $repoDisabled = $node->findvalue('repositoryDisabled');
  
  printf("AR: %s\n", $repoName);
  #
  # Skip disable repositories
  if ($repoDisabled) {
    printf ("  Repository disabled: Skipping!\n");
    next;
  }
  $repoServerName =~ s#https?://([\-\w]+)(:\d+)?#$1#;

  # checking that the resource exist and is enabled
  # 
  ($success, $xPath) = InvokeCommander("SuppressLog IgnoreError", "getResource", $repoServerName);
  if (! $success) {
    printf("  Associated resource '%s' does not exist. Skipping!\n", $repoServerName);
    next;
  }
  my $resDisabled=$xPath->findvalue('//resource/resourceDisabled');
  if ($resDisabled eq "1") {
    printf("  Associated resource '%s' disabled. Skipping!\n", $repoServerName);
    next;
  }
    
  my $agentAlive=$xPath->findvalue('//resource/agentState/alive');
  if ($agentAlive eq "0") {
    printf("  Associated resource '%s' is not alive. Skipping!\n", $repoServerName);
    next;
  }
  
  my $stepName = "clean Step For ".$repoName;
  $ec->createJobStep({'jobStepName' => $stepName, 
                      'subprocedure' => 'cleanupRepository', 
                      'actualParameter' => [{'actualParameterName' => 'executeDeletion', 'value'=>$executeDeletion},
                                         {'actualParameterName' => 'resource', 'value'=>$repoServerName},
                                        ]
                  });
}                      



</command>
        <condition>$[executeDeletion]</condition>
        <description />
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>dynamicCacheCleaningProcedure</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>#############################################################################
#
#  Copyright 2013 Electric-Cloud Inc.
#
#############################################################################

use DateTime;

$[/myProject/scripts/perlHeader]
$[/myProject/scripts/perlLib]

#############################################################################
#
#  Assign Commander parameters to variables
#
#############################################################################
my $executeDeletion="$[executeDeletion]";
my $days=$[olderThan];

#Let's loop on Resources
my ($success, $xPath) = InvokeCommander("SuppressLog", "getResources");
my $nodeset = $xPath->find('//resource');

foreach my $node ($nodeset->get_nodelist) {
  my $resName=$node->findvalue('resourceName');
  my $hostName=$node->findvalue('hostName');
  my $resDisabled=$node->findvalue('resourceDisabled');
  my $agentAlive=$node->findvalue('agentState/alive');
  printf("%s\n\t Disabled: %s\n\t alive: %s\n", $resName, $resDisabled, $agentAlive);

  #
  # Create a sub-step only if agent is alive and not disabled
  # to avoid to have to wait (and fail) for unavailable resources
  if ( ($resDisabled eq "0") &amp;&amp; ($agentAlive eq "1")) {
    my $resName=$node->findvalue('resourceName');
    my $stepName = "clean Artifact Cache Step For ".$resName;
    $ec->createJobStep({'jobStepName'=>$stepName, 
                        'subprocedure' => 'cleanupCacheDirectory', 
                        'actualParameter' => [{'actualParameterName'=>'executeDeletion', 'value'=>$executeDeletion},
                                         {'actualParameterName'=>'olderThan', 'value'=>$days},
                                         {'actualParameterName'=>'resource', 'value'=>$resName}]
                  });
  }
}                      

</command>
        <condition>$[executeDeletion]</condition>
        <description />
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
    </procedure>
    <procedure>
      <procedureName>cleanupCacheDirectory</procedureName>
      <description>Clear out all stale artifacts from a given artifact cache.
Can be called manually on 1 resource or automatically on all</description>
      <jobNameTemplate />
      <resourceName>$[resource]</resourceName>
      <timeLimit />
      <timeLimitUnits>minutes</timeLimitUnits>
      <workspaceName />
      <propertySheet>
        <property>
          <propertyName>ec_customEditorData</propertyName>
          <propertySheet>
            <property>
              <propertyName>parameters</propertyName>
              <propertySheet>
                <property>
                  <propertyName>executeDeletion</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>true</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>0</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>false</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>olderThan</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>resource</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
              </propertySheet>
            </property>
          </propertySheet>
        </property>
      </propertySheet>
      <formalParameter>
        <formalParameterName>executeDeletion</formalParameterName>
        <defaultValue>false</defaultValue>
        <description>If this option is not set, only report is done. No real data are deleted</description>
        <expansionDeferred>0</expansionDeferred>
        <required>1</required>
        <type>checkbox</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>olderThan</formalParameterName>
        <defaultValue>90</defaultValue>
        <description />
        <expansionDeferred>0</expansionDeferred>
        <required>1</required>
        <type>entry</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>resource</formalParameterName>
        <defaultValue />
        <description>The resource on which to run this job. The agent running on this resource must have access to the specified artifact cache directory. Note that if no artifact cache directory is specified, the job will cleanup the default artifact cache used by the resource.</description>
        <expansionDeferred>0</expansionDeferred>
        <required>1</required>
        <type>entry</type>
      </formalParameter>
      <step>
        <stepName>clearInvalidArtifactVersions</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>$[/myProject/scripts/perlHeader]

#############################################################################
#
#  Assign Commander parameters to variables
#
#############################################################################
my $executeDeletion= "$[executeDeletion]";

# We're going to try and find a valid cache directory. Mark the directory as invalid for now
# and update it only once we find and validate the directory.
$ec->setProperty("/myJob/cacheDirectoryIsValid", {value => 0});

# Check the environment variable COMMANDER_ARTIFACT_CACHE.
my $cacheEnv = "COMMANDER_ARTIFACT_CACHE";
my $dir;
if (defined($ENV{$cacheEnv})) {
    $dir = $ENV{$cacheEnv};
    print "Cache directory found in environment: \"$dir\".\n";
} else {
    # We came up empty; give up since we don't know what directory to cleanup.
    warn "ERROR: No cache directory was found in the environment.\n";
    $ec->setProperty("outcome", "warning");
    $ec->setProperty("summary", "No cache directory");
    exit(0);
}

if (! -d $dir) {
    # The directory can't be read; no need to try to clean it up.
    warn "ERROR: Cannot access directory \"$dir\".\n";
    $ec->setProperty("outcome", "warning");
    $ec->setProperty("summary", "Cache directory does not exit");
    exit(0);
}

$ec->setProperty("/myJob/actualCacheDirectory", {value => $dir});
$ec->setProperty("/myJob/cacheDirectoryIsValid", {value => 1});
if ($executeDeletion eq "true") {
    print "Cleaning up artifact cache.\n";
    $ec->cleanupArtifactCache($dir, {'force' => 1});
} else {
    print "Would call cleanupArtifactCache on \"$dir\".\n";
}
</command>
        <condition />
        <description />
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>traverseCacheDirectory</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>$[/myProject/scripts/perlHeader]

use ElectricCommander::Batch;
use Data::Dumper;

sub getContents($) {
    my ($dir) = @_;
    opendir(DIR, $dir) or die "ERROR: Couldn't open directory \"$dir\".\n";
    my @contents = readdir(DIR);
    closedir(DIR);
    return @contents;
}

# Keep track of whether we found any candidates for time or space based deletion.
$ec->setProperty("/myJob/candidatesForDeletion", {value => 0});

# Get the value of the actualCacheDirectory property.
my $cache = $ec->getProperty("actualCacheDirectory")->findvalue("//value");

# Create a new parallel batch of getArtifactVersion requests. Use parallel mode
# because we need to allow non-existent artifact versions, and single mode will
# have a cascaded failure at the first error it encounters.
my $gavBatch = $ec->newBatch('parallel');

# Create a map of GAV => requestId so we can get the appropriate response and
# store the needed data.
my %gavMap = ();

foreach my $g (getContents($cache)) {
    # First level = (g)roup
    if ($g eq "." || $g eq ".." || ! -d "$cache/$g") {
        next;
    } else {
        foreach my $a (getContents("$cache/$g")) {
            # Second level = (a)rtifact
            if ($a eq "." || $a eq ".." || ! -d "$cache/$g/$a") {
                next;
            } else {
                foreach my $v (getContents("$cache/$g/$a")) {
                    # Third level = (v)ersion
                    if ($v eq "." || $v eq ".." || ! -d "$cache/$g/$a/$v") {
                        next;
                    } else {
                        # Check to see if "g:a:v" is an artifact version.
                        my $gav = "$g:$a:$v";
                        print "Potential artifact version: $gav\n";
                        my $reqId = $gavBatch->getArtifactVersion($gav,
                            {
                                includeRetrieverJobSteps => 1,
                                maxRetrievers => 1
                            }
                        );
                        $gavMap{$gav} = $reqId;
                    }
                }
            }
        }
    }
}

if (keys %gavMap == 0) {
    print "No potential GAV directories were found in \"$cache\".\n";
    exit 0;
}

# Allow "no such aritfact version" errors.
$ec->abortOnError(0);
$gavBatch->submit();
$ec->abortOnError(1);

# Create a new parallel batch of getProperty requests.
my $stepBatch = $ec->newBatch('single');

foreach my $gav (keys %gavMap) {
    my $reqId = $gavMap{$gav};
    my $jobStepId = $gavBatch->findvalue($reqId, "artifactVersion/retriever/jobStepId")->string_value;
    if ($jobStepId ne "") {
        print "Artifact version \"$gav\" was last retrieved by job step $jobStepId.\n";
        my $reqId = $stepBatch->getProperty("/jobSteps/$jobStepId/start");
        $gavMap{$gav} = $reqId;
    } else {
        # Remove this artifact version from our map if no job step id was found,
        # which would happen if the artifact was never retrieved in a job context.
        delete $gavMap{$gav};
    }
}

if (keys %gavMap == 0) {
    print "No potential GAV directories were retrieved by job steps.\n";
    exit 0;
}

$stepBatch->submit();

# Get the start times for the last job step to access each artifact version and store
# the artifact version => last access time in a property sheet on the job for future
# steps to consume.
foreach my $gav (keys %gavMap) {
    my $reqId = $gavMap{$gav};
    my $start = $stepBatch->findvalue($reqId, "property/value")->string_value;
    $ec->setProperty("/myJob/validArtifactVersions/$gav", {value => $start});
}

$ec->setProperty("/myJob/candidatesForDeletion", {value => 1});
</command>
        <condition>$[/javascript myJob.cacheDirectoryIsValid == '1']</condition>
        <description />
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>timeBaseDeletion</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>$[/myProject/scripts/perlHeader]

use ElectricCommander::Batch;
use File::Path;
use Time::Local;

#############################################################################
#
#  Assign Commander parameters to variables
#
#############################################################################
my $days=$[olderThan];
my $executeDeletion="$[executeDeletion]";

# Get the value of the actualCacheDirectory property.
my $cache = $ec->getProperty("actualCacheDirectory")->findvalue("//value");

# Create a new parallel batch of deleteProperty requests for all artifact versions
# that we are blowing away, so the /myJob/validArtifactVersions property sheet is
# up to date for future steps that consume it.
my $deleteBatch = $ec->newBatch('parallel');

# Figure out the time limit for deletion based on the number of days specified.

my ($sec, $min, $hour, $mday, $mon, $year) = gmtime(time() - (3600*24*$days));
my $timeLimit = sprintf("%4d%02d%02d%02d%02d%02d", 1900+$year,
                      $mon+1, $mday, $hour, $min, $sec);
print "Time limit for deletion: $timeLimit\n";

# Get the properties stored in /myJob/validArtifactVersions so we can go through
# each one to figure out if we should delete it.
my $validVersions = $ec->getProperties({path => "/myJob/validArtifactVersions"});

foreach my $validVersion($validVersions->findnodes("//property")) {
    my $accessTime = $validVersion->findvalue("value")->string_value;
    $accessTime =~ s/[^.\d]//g;
    if ($accessTime &lt; $timeLimit) {
        my $gav = $validVersion->findvalue("propertyName")->string_value;
        $gav =~ m/(.*):(.*):(.*)/;
        my $dir = "$cache/$1/$2/$3";
        if ($executeDeletion eq "true") {
            print "Deleting \"$dir\" (last accessed $accessTime).\n";
            rmtree($dir);
        } else {
           print "Would delete \"$dir\" (last accessed $accessTime).\n";
        }
    }
}

</command>
        <condition>$[/javascript myJob.candidatesForDeletion == '1']</condition>
        <description />
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
    </procedure>
    <procedure>
      <procedureName>cleanupRepository</procedureName>
      <description>Clear out all stale artifacts from a repository's backing store.
This procedure can be run on an individual repository or can be called on all repositories by "Artifact Cleanup"</description>
      <jobNameTemplate>$[/myProject/projectName]-$[/myProcedure/procedureName]_$[jobId]-$[/timestamp]</jobNameTemplate>
      <resourceName>$[resource]</resourceName>
      <timeLimit />
      <timeLimitUnits>minutes</timeLimitUnits>
      <workspaceName />
      <propertySheet>
        <property>
          <propertyName>ec_customEditorData</propertyName>
          <propertySheet>
            <property>
              <propertyName>parameters</propertyName>
              <propertySheet>
                <property>
                  <propertyName>adminLogin</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>executeDeletion</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>true</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>0</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>false</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>resource</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
              </propertySheet>
            </property>
          </propertySheet>
        </property>
      </propertySheet>
      <formalParameter>
        <formalParameterName>executeDeletion</formalParameterName>
        <defaultValue>false</defaultValue>
        <description>If this option is not set, only report is done. No real data are deleted</description>
        <expansionDeferred>0</expansionDeferred>
        <required>1</required>
        <type>checkbox</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>resource</formalParameterName>
        <defaultValue>local</defaultValue>
        <description>The resource on which to run this job. This resource must be running on the same machine as a repository server. The job will detect the repository's backing store location based on the assumption that the resource is installed along with the repository.</description>
        <expansionDeferred>0</expansionDeferred>
        <required>1</required>
        <type>entry</type>
      </formalParameter>
      <step>
        <stepName>clearInvalidArtifactVersions</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>$[/myProject/scripts/perlHeader]

use warnings;
use File::Spec;

my $executeDeletion="$[executeDeletion]";
my $response;

my $dataEnv = "COMMANDER_DATA";
my $dataDir;

if (defined($ENV{$dataEnv})) {
    $dataDir = $ENV{$dataEnv};
    print "Data directory found in environment: \"$dataDir\".\n";
} else {
    # No data directory in the environment; probably a pre-4.0 agent.
    die "ERROR: No data directory was found in the environment.\n";
}

if (! -d $dataDir) {
    # The data directory is invalid.
    die "ERROR: Cannot access data directory \"$dataDir\".\n";
}

my $propsFile = "$dataDir/conf/repository/server.properties";
if (! -f $propsFile) {
    # There's no repository server.properties.
    die "ERROR: Cannot find repository configuration file \"$propsFile\".\n";
}

open PROPS, $propsFile or die "Could not open repository configuration file \"$propsFile\": $!";
binmode PROPS;
my $propsContents = join("", &lt;PROPS>);
close PROPS;
$propsContents =~ m/REPOSITORY_BACKING_STORE=([^\n]*)/;
my $backingStore = $1;

if (!defined($backingStore) || $backingStore eq "") {
    # Invalid backing store.
    die "ERROR: Cannot find backing store in repository configuration file \"$propsFile\".\n";
}

# If the backing store isn't an absolute path, it is relative to the data directory.
if (!File::Spec->file_name_is_absolute($backingStore)) {
    $backingStore = "$dataDir/$backingStore";
}

if (! -d $backingStore) {
    # The backing store directory is invalid.
    die "ERROR: Cannot access backing store directory \"$backingStore\".\n";
}

if ($executeDeletion eq "true") {
    # Get Admin user/password from project-level credential
    # getFullCredential will not reveal the contents of the "password" field
    my $xPath = $ec->getFullCredential("adminLogin");
    my $user = $xPath->findvalue("//userName");
    my $passwd = $xPath->findvalue("//password");

    print "Cleaning up repository backing store \"$backingStore\".\n";
    $ec->login($user, $passwd);
    $ec->cleanupRepository($backingStore);
} else {
    print "Would call cleanupRepository on \"$backingStore\".\n";
}
</command>
        <condition />
        <description>Check the environment variable COMMANDER_DATA, then check for a repository server.properties relative to this directory. Error out if the properties file can't be found, otherwise parse it for the backing store location. Once we have the backing store, call cleanupRepository on that directory.

</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName>$[resource]</resourceName>
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
        <attachedCredentials>
          <credentialName>adminLogin</credentialName>
        </attachedCredentials>
      </step>
    </procedure>
    <procedure>
      <procedureName>createPluginFromProject</procedureName>
      <description>Create a plugin from a simple project

Changelog:
--------------

2014-06-18  lrochette   Added a hook to allow actions to be taken when the plugin changes state
2014-05-08  lrochette   Added feature to save plugin as an artifact version
2014-04-30  lrochette   Added step to fix self reference to project
2014-04-29  lrochette   Fixed ec_visbility issue
2014-04-03  lrochette   Fixed problem with ec_setup and procedure names with dot (".")
2014-03-12  lrochette   fixed Email address URL issue
2014-03-11  lrochette   Fixed jar error not reported
                                      Fixed Windows path issue for
                                      Use zip when jar is not available to package plugin
2014-01-31  lrochette   Fixed descriptionForPlugin bug
2014-01-26  lrochette   Fixed ec_visbility  (pickListOnly)
2014-02-04  lrochette   Fixed problem with ec_setup and procedure names with dot (".")
2014-04-02  lrochette   Fixed problem with ec_setup and procedure names with dot (".")
2014-04-29  lrochette   Fixed ec_visbility
2014-04-30  lrochette   Added a step to fix self reference to the project</description>
      <jobNameTemplate>$[/myProject/scripts/jobTemplate]</jobNameTemplate>
      <resourceName />
      <timeLimit />
      <timeLimitUnits>minutes</timeLimitUnits>
      <workspaceName />
      <propertySheet>
        <property>
          <propertyName>ec_customEditorData</propertyName>
          <propertySheet>
            <property>
              <propertyName>parameters</propertyName>
              <propertySheet>
                <property>
                  <propertyName>Author</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>Category</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>Description</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>Email</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>Plugin</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>Project</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>Version</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>createArtifact</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>true</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>0</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>false</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>directory</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>fixSelfReferences</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>true</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>0</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>false</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>installPlugin</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>true</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>1</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>false</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>pluginName</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>promotePlugin</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>true</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>1</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>false</value>
                    </property>
                  </propertySheet>
                </property>
              </propertySheet>
            </property>
          </propertySheet>
        </property>
        <property>
          <propertyName>descriptionForPlugin</propertyName>
          <description>Description used in the pickerList when transformed into a plugin</description>
          <expandable>1</expandable>
          <value>Transform a project into a plugin</value>
        </property>
        <property>
          <propertyName>ec_parameterForm</propertyName>
          <description />
          <expandable>1</expandable>
          <value>&lt;editor>
    &lt;formElement> 
        &lt;label>Project Name&lt;/label> 
        &lt;property>Project&lt;/property> 
        &lt;documentation>Choose a project to transform into a plugin.&lt;/documentation> 
        &lt;type>project&lt;/type>
        &lt;required>1&lt;/required>
    &lt;/formElement> 

    &lt;formElement> 
        &lt;label>Plugin name&lt;/label> 
        &lt;property>Plugin&lt;/property> 
        &lt;documentation>The name of the plugin to create. If left empty, it will default to the project name.&lt;/documentation> 
        &lt;type>entry&lt;/type>
    &lt;/formElement> 

    &lt;formElement> 
        &lt;label>Category&lt;/label> 
        &lt;property>Category&lt;/property> 
        &lt;documentation>Category of the plugin. It helps filter the search for the plugin and its procedures in the picker list.&lt;/documentation> 
        &lt;type>entry&lt;/type>
    &lt;/formElement> 

    &lt;formElement> 
        &lt;label>Version&lt;/label> 
        &lt;property>Version&lt;/property> 
        &lt;documentation>The version of the plugin to create.&lt;/documentation> 
        &lt;type>entry&lt;/type>
        &lt;value>1.0.0&lt;/value>
        &lt;required>1&lt;/required>
    &lt;/formElement> 

    &lt;formElement> 
        &lt;label>Description&lt;/label> 
        &lt;property>Description&lt;/property> 
        &lt;documentation>Description of the plugin. If left empty, it will default to the description of the project.&lt;/documentation> 
        &lt;type>entry&lt;/type>
    &lt;/formElement> 

    &lt;formElement> 
        &lt;label>Author&lt;/label> 
        &lt;property>Author&lt;/property> 
        &lt;documentation>Author of the plugin.&lt;/documentation> 
        &lt;type>entry&lt;/type>
    &lt;/formElement> 

    &lt;formElement> 
        &lt;label>Author's email&lt;/label> 
        &lt;property>Email&lt;/property> 
        &lt;documentation>Email of the plugin author.&lt;/documentation> 
        &lt;type>entry&lt;/type>
    &lt;/formElement> 

    &lt;formElement> 
        &lt;label>Fix self references&lt;/label>    
        &lt;property>fixSelfReferences&lt;/property> 
        &lt;documentation>Replace self reference to your project by an empty string.&lt;/documentation> 
        &lt;type>checkbox&lt;/type>    
        &lt;checkedValue>true&lt;/checkedValue> 
        &lt;uncheckedValue>false&lt;/uncheckedValue> 
        &lt;initiallyChecked>0&lt;/initiallyChecked> 
        &lt;value>false&lt;/value>    
    &lt;/formElement>

    &lt;formElement> 
        &lt;label>Create Artifact&lt;/label>    
        &lt;property>createArtifact&lt;/property> 
        &lt;documentation>Save the new created Plugin as an artifact version.&lt;/documentation> 
        &lt;type>checkbox&lt;/type>    
        &lt;checkedValue>true&lt;/checkedValue> 
        &lt;uncheckedValue>false&lt;/uncheckedValue> 
        &lt;initiallyChecked>0&lt;/initiallyChecked> 
        &lt;value>false&lt;/value>    
    &lt;/formElement>

    &lt;formElement> 
        &lt;label>Install Plugin&lt;/label>    
        &lt;property>installPlugin&lt;/property> 
        &lt;documentation>Check to install the plugin automatically after successful creation.&lt;/documentation> 
        &lt;type>checkbox&lt;/type>    
        &lt;checkedValue>true&lt;/checkedValue> 
        &lt;uncheckedValue>false&lt;/uncheckedValue> 
        &lt;initiallyChecked>1&lt;/initiallyChecked> 
        &lt;value>true&lt;/value>    
    &lt;/formElement>

    &lt;formElement> 
        &lt;label>Promote Plugin&lt;/label>    
        &lt;property>promotePlugin&lt;/property> 
        &lt;documentation>Check to promote the plugin automatically after successful installation.&lt;/documentation> 
        &lt;type>checkbox&lt;/type>    
        &lt;checkedValue>true&lt;/checkedValue> 
        &lt;uncheckedValue>false&lt;/uncheckedValue> 
        &lt;initiallyChecked>1&lt;/initiallyChecked> 
        &lt;value>true&lt;/value>    
    &lt;/formElement>

&lt;/editor></value>
        </property>
        <property>
          <propertyName>exposeToPlugin</propertyName>
          <description />
          <expandable>1</expandable>
          <value>1</value>
        </property>
      </propertySheet>
      <formalParameter>
        <formalParameterName>Author</formalParameterName>
        <defaultValue />
        <description>One must take credit where credit is owed</description>
        <expansionDeferred>0</expansionDeferred>
        <required>1</required>
        <type>entry</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>Category</formalParameterName>
        <defaultValue />
        <description>The category used for the plugin list</description>
        <expansionDeferred>0</expansionDeferred>
        <required>1</required>
        <type>entry</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>createArtifact</formalParameterName>
        <defaultValue>false</defaultValue>
        <description>Check to save the plugin in the Artifact Repository</description>
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>checkbox</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>Description</formalParameterName>
        <defaultValue />
        <description>The description of your plugin</description>
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>textarea</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>Email</formalParameterName>
        <defaultValue />
        <description>The email address of the author for support purpose</description>
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>entry</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>fixSelfReferences</formalParameterName>
        <defaultValue>false</defaultValue>
        <description />
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>checkbox</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>installPlugin</formalParameterName>
        <defaultValue>true</defaultValue>
        <description>install the plugin or not at the end of the process</description>
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>checkbox</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>Plugin</formalParameterName>
        <defaultValue />
        <description>The name of the plugin you want to create. If it's empty it will use the source project name.</description>
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>entry</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>Project</formalParameterName>
        <defaultValue />
        <description>Pick the source project for which you want to create a plugin</description>
        <expansionDeferred>0</expansionDeferred>
        <required>1</required>
        <type>project</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>promotePlugin</formalParameterName>
        <defaultValue>false</defaultValue>
        <description />
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>checkbox</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>Version</formalParameterName>
        <defaultValue>1.0.0</defaultValue>
        <description>Version of the plugin</description>
        <expansionDeferred>0</expansionDeferred>
        <required>1</required>
        <type>entry</type>
      </formalParameter>
      <step>
        <stepName>Initialization</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>$[/myProject/scripts/perlHeaderJSON]

###################################################################
#
# Parameters
#
###################################################################
my $pluginName="$[Plugin]";
my $project="$[Project]";
my $version="$[Version]";

if ($pluginName eq "") {
  $pluginName=$project;
}
my $pluginBuildNumber=$[/increment /projects/$[Project]/pluginBuildNumber];
my $completeVersion="$version.$pluginBuildNumber";

$ec->setProperty("summary", "Processing plugin $project-$completeVersion");
$ec->setProperty("/myJob/Version", $completeVersion);
</command>
        <condition />
        <description>Set up some job properties</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>createFileStructure</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>#
# Create a uniq directory
mkdir ("plugin.$[/myJob/jobId]");
chdir("plugin.$[/myJob/jobId]");

# Create the META-INF and pages directories
mkdir("META-INF");
mkdir ("pages");
mkdir ("cgi-bin");
mkdir ("htdocs");

# Open persmission the project export can be written
# in the case the server and agent run with 2 different users
chmod (0777, "META-INF");
</command>
        <condition />
        <description>Create the file structure required for a plugin

/
	/ META-INF
		/ plugin.xml
		/ project.xml
	/ pages
		/ help.xml
</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>fixSelfReferences</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>#############################################################################
#
# Copyright 2014 Electric-Cloud Inc.
#
#############################################################################

$[/myProject/scripts/perlHeaderJSON]

#############################################################################
#
# Parameters
#
#############################################################################
my $prj="$[Project]";

my $DEBUG=1;

#
# Schedules Loop
# 
my $res=$ec->getSchedules($prj);

foreach my $node ($res->findnodes("//schedule")) {
    my $sched=$node->{'scheduleName'};
	printf("Processing Schedule: %s\n", $sched);

	if ($node->{'project'} eq "$prj") {
    	printf("        *** Changing schedule project back to empty\n");
    	$ec->setProperty('subproject', "", {projectName=>$prj,  scheduleName=>$sched});
  	}
}
printf("\n\n\n");

#
# Workflow/State Definition Loop
# 
$res=$ec->getWorkflowDefinitions($prj);

foreach my $node ($res->findnodes("//workflowDefinition")) {
	my $wkf=$node->{'workflowDefinitionName'};
	printf("Processing Workflow: %s\n", $wkf);

	my $json=$ec->getStateDefinitions($prj, $wkf);
    
	foreach my $state ($json->findnodes("//stateDefinition")) {
    	my $stateName=$state->{'stateDefinitionName'};
  		printf("    Process State %s\n", $stateName);
        if ($state->{'subproject'} eq "$prj") {
    		printf("        *** Changing state subproject back to empty\n");
    		$ec->setProperty('subproject', "", {projectName=>$prj, workflowDefinitionName=>$wkf, stateDefinitionName=>$stateName});
  		}
	}
}
printf("\n\n\n");

#
# Procedure/Step Loop
# 
$res=$ec->getProcedures($prj);

foreach my $node ($res->findnodes("//procedure")) {
	my $proc=$node->{'procedureName'};
	printf("Processing Procedure: %s\n", $proc);

	my $json=$ec->getSteps($prj, $proc);
    
	foreach my $step ($json->findnodes("//step")) {
    	my $stepName=$step->{'stepName'};
  		printf("    Process Step %s\n", $stepName);
        if ($step->{'subproject'} eq "$prj") {
    		printf("        *** Changing step subproject back to empty\n");
    		$ec->setProperty('subproject', "", {projectName=>$prj, procedureName=>$proc, stepName=>$stepName});
  		}
	}
}
</command>
        <condition>$[fixSelfReferences]</condition>
        <description>Replace self references in states, schedules and steps to the current project by an empty String</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>createPlugin.xml</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>$[/myProject/scripts/perlHeaderJSON]

my $pluginName="$[Plugin]";
my $project="$[Project]";
my $version="$[/myJob/Version]";
my $description="$[Description]";
my $author="$[Author]";
my $email='$[Email]';
my $category="$[Category]";

if ($author eq "") {
   $author="Electric Cloud";
}
if ($email eq "") {
   $email="plugins\@electric-cloud.com";
}
if ($pluginName eq "") {
  $pluginName="$[Project]";
}
if ($description eq "") {
  $description=getP("/projects/$project/description");
}

my $file="plugin.$[/myJob/jobId]/META-INF/plugin.xml";
unless (open FILE, '>'.$file) {
        printf("File: %s\n", $file);
	die "\nUnable to create META-INF/plugin.xml\n";
}

printf(FILE '&lt;?xml version="1.0" encoding="UTF-8"?>');
printf(FILE "\n&lt;plugin>\n");
printf(FILE "  &lt;key>%s&lt;/key>\n", $pluginName);
printf(FILE "  &lt;version>%s&lt;/version>\n", $version);
printf(FILE "  &lt;label>%s&lt;/label>\n", $pluginName);
printf(FILE "  &lt;description>%s&lt;/description>\n", $description);

#
# Create the help entry only if it exists
my $help=getP("/projects/$project/help");
if ($help ne "") {
  printf(FILE "  &lt;help>help.xml&lt;/help>\n");
}
printf(FILE "  &lt;author>%s&lt;/author>\n", $author);
printf(FILE "  &lt;authorUrl>mailto:%s&lt;/authorUrl>\n", $email);
printf(FILE "  &lt;category>%s&lt;/category>\n&lt;/plugin>\n", $category);
close FILE;


$[/myProject/scripts/perlLibJSON]
</command>
        <condition />
        <description>create the META-INF/plugin.xml</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>setProjectProperty-ec_visbility</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>$[/myProject/scripts/perlHeaderJSON]

my $pName="$[Plugin]";
my $pCategory="$[Category]";
my $project="$[Project]";


if (! getP("/projects/$project/ec_visibility")) {
  $ec->setProperty("/projects/$[Project]/ec_visibility", "pickListOnly");
} else {
   $ec->setProperty("/myCall/ecVisibility",  getP("/projects/$project/ec_visibility") );
}

$[/myProject/scripts/perlLibJSON]
</command>
        <condition />
        <description>set the right properties to be able to see the project in the picketList

$ec->setProperty("/projects/$[Project]/ec_visibility", "pickListOnly");

</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>setProjectProperties-ec_setup</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>$[/myProject/scripts/perlHeader]

my $pName="$[Plugin]";
my $pCategory="$[Category]";
my $project="$[Project]";

if ($pName eq "") {
  $pName=$project;
}

my $ECsetup="";

#
# Pickup code for Promote/demote
#
if (getP("/projects/$project/promoteAction")) {
  $ECsetup .= "# promote/demote action\n";
  $ECsetup .= getP("/projects/$project/promoteAction");
  $ECsetup .= "\n\n";
}

$ECsetup .= "# Data that drives the create step picker registration for this plugin.\n";

# Loop on each procedure
my $proc;              # Loop variable
my $xpath;
my $pickerList="";

my @procList=$ec->getProcedures($project)->findnodes("//procedure");
foreach $xpath(@procList) {
   my $procName=$xpath->findvalue("//procedureName");
   
   #
   # Skip this procedure if property "exposeToPlugin" is not set to 1
   #
   next if (getP("/projects/$project/procedures/$procName/exposeToPlugin") != 1);
   
   #
   #
   # If property "descrirptionForPlugin" exists, use it
   # if not, use the procedure description itself
   #
   my $description=getP("/projects/$project/procedures/$procName/descriptionForPlugin");
   if (!$description) {
     $description=$xpath->findvalue("//description");
   }
   my $procCleanName=$procName;
   $procCleanName =~ s/[\s\-\.]/\_/g; # replace spaces, . and - by _

# Create a block of perl Code for each procedure ala
#my %startBuild = (
#    label => "$Jenkins- Start a build",
#    procedure => "startBuild",
#    description => "Start a build.",
#    category => "Other"
#);

#escape double quote in the description
  $description =~ s/"/\\"/g;
  
   $ECsetup .= "my %" . "$procCleanName = ( 
  label       => \"$pName - $procName\", 
  procedure   => \"$procName\", 
  description => \"$description\", 
  category    => \"$pCategory\" 
);

" ;

  $pickerList .= "\\%". $procCleanName . ", "; 
} # end foreach loop


# Create the picker List ala
#@::createStepPickerSteps = (\%startBuild, \%getStatus, \%getLog, \%getDuration);

#remote the trailing ", " from the picker List
chop($pickerList); chop($pickerList);
$ECsetup .= "\@::createStepPickerSteps = (" . $pickerList . ");\n";

print "Code generated\n";
print $ECsetup;
$ec->setProperty("//projects/$[Project]/ec_setup", $ECsetup);

$[/myProject/scripts/perlLib]

</command>
        <condition />
        <description>set the right properties to be able to see the project in the picketList.
Procedure is added only if property pluginExpose is set</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>createProject.xml</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>$[/myProject/scripts/perlHeader]

my $project="$[Project]";
my $wkSpace="";

if ($osIsWindows) {
  $wkSpace=getP("/myWorkspace/agentUncPath");
} else {
  $wkSpace="$[/myWorkspace/agentUnixPath]";
}  
my $file="$wkSpace/$[/myJob/directoryName]/plugin.$[/myJob/jobId]/META-INF/project.xml";

$ec->export($file, {path=> "/projects/" . $project, relocatable => "true"});

$[/myProject/scripts/perlLib]
</command>
        <condition />
        <description>Create the META-INF/project.xml</description>
        <errorHandling>abortJob</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName>local</resourceName>
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>restore-ec_visibility</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>$[/myProject/scripts/perlHeaderJSON]

my $pName="$[Plugin]";
my $pCategory="$[Category]";
my $project="$[Project]";

$ec->deleteProperty("/projects/$[Project]/ec_visibility");
if ( $[/javascript (typeof(myCall.ecVisibility) != "undefined") ?"1":"0" ] ) {
   printf("Restoring ec_visibility\n");
   $ec->setProperty("/projects/$[Project]/ec_visibility", getP("/myCall/ecVisibility") );
}
$[/myProject/scripts/perlLibJSON]
</command>
        <condition />
        <description />
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>createHelp.xml</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>$[/myProject/scripts/perlHeaderJSON]
$[/myProject/scripts/perlLibJSON]

my $file="pages/help.xml";
my $help=getP("/projects/$[Project]/help");
my $HELP;

if ($help ne "") {
  chdir("plugin.$[/myJob/jobId]");
  open($HELP, "> $file") || die("Cannot open help.xml");

  print $HELP "$help";
  close($HELP);
}
</command>
        <condition />
        <description>if the property "help" exist for the project, use it to create the pages/help.xml</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>packagePlugin</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>$[/myProject/scripts/perlHeader]
use File::Which qw(which);
use File::Copy qw(move);

my $pluginName="$[Plugin]";
my $Version="$[/myJob/Version]";
if ($pluginName eq "") {
  $pluginName="$[Project]";
}

chdir("plugin.$[/myJob/jobId]");

if (my $jar_path=which('jar')) {
  my @args=("jar cvf0 ../$pluginName-$Version.jar *");
  system(@args) == 0 or die("system @args failed: $?");
} else {
  printf("jar not found in the path\n");
  #
  # Let's try with zip
  if (my $zip_path=which('zip')) {
  	printf("Let's try with zip instead\n");
    my @args=("zip -r  ../$pluginName-$Version.zip *");
    system(@args) == 0 or die("system @args failed: $?");
    # let's rename the file
    move("../$pluginName-$[Version].zip", "../$pluginName-$Version.jar");
  } else {
    printf("zip not found in the path\n");
    printf("I need something to package the plugin\n");
    $ec->setProperty("summary", "No jar or zip executable in the PATH");
    exit(1);
  }
}

$ec->setProperty("/myJob/report-urls/$pluginName-$Version.jar", "file:/$[/myWorkspace/agentUnixPath]/$[/myJob/directoryName]/$pluginName-$Version.jar");

</command>
        <condition />
        <description>Create the jar file for the plugin</description>
        <errorHandling>abortJob</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>savePluginAsArtifactVersion</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>#############################################################################
#
#  uploadPlugins -- upload all plugins in the Artifact Repository
#  Copyright 2014 Electric-Cloud Inc.
#
#############################################################################

$[/myProject/scripts/perlHeader]

#
# Parameters
#
my $plugin="$[Plugin]";
my $Version="$[/myJob/Version]";
if ($plugin eq "") {
  $plugin="$[Project]";
}

#
# Is this plugin already imported in an Artifact Version
#
my ($ok)=InvokeCommander("SuppressLog IgnoreError", 'getArtifactVersion', "plugins:$plugin:$Version");
if ($ok) {
	printf("\tArtifact Version already exists\n");
    exit 1;    # Artifact already exist
}

#
# Does the Artifact already exist?
#
($ok)=InvokeCommander("SuppressLog IgnoreError", 'getArtifact', "plugins:$plugin");
if (! $ok) {
	InvokeCommander("SuppressLog", 'createArtifact',
		{
        	groupId=>"plugins", artifactKey=>$plugin
		}
);
}
InvokeCommander("SuppressLog", 'publishArtifactVersion',
		{
        	groupId=>"plugins", artifactKey=>$plugin,  version=>$Version,
        	fromDirectory=>".",
            includePatterns=>"*.jar"
		}
);

$[/myProject/scripts/perlLib]
</command>
        <condition>$[createArtifact]</condition>
        <description>Let's save the plugin in the Artifact Repository</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>installPlugin</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>$[/myProject/scripts/perlHeader]

my $plugin="$[Plugin]";
my $version="$[/myJob/Version]";

if ($plugin eq "") {
  $plugin="$[Project]";
}

printf("Installing plugin '$plugin-$version'\n");
$ec->installPlugin("./$plugin-$version.jar");
$ec->setProperty("summary", "$plugin-$version installed");
</command>
        <condition>$[/javascript "$[installPlugin]" == "true" ]
</condition>
        <description />
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>promotePlugin</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>$[/myProject/scripts/perlHeader]

my $plugin="$[Plugin]";
my $version="$[/myJob/Version]";

if ($plugin eq "") {
  $plugin="$[Project]";
}

printf("Promoting plugin '$plugin-$version'\n");
$ec->promotePlugin("$plugin-$version");
$ec->setProperty("summary", "$plugin-$version promoted");
</command>
        <condition>$[/javascript "$[promotePlugin]" == "true" ]</condition>
        <description />
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
    </procedure>
    <procedure>
      <procedureName>deleteObjects</procedureName>
      <description>A procedure to quickly delete jobs or workflows older than a
specified number of days. It will NOT delete associated workspace job
directories. This is for customers with huge job or workflow database

Changelog:
-------------
12-23-2013  Tanay  Added a sort to prevent job ID range overlap as reporeted in ZD #109574
</description>
      <jobNameTemplate>$[/myProject/scripts/jobTemplate]</jobNameTemplate>
      <resourceName />
      <timeLimit />
      <timeLimitUnits>seconds</timeLimitUnits>
      <workspaceName />
      <propertySheet>
        <property>
          <propertyName>ec_customEditorData</propertyName>
          <propertySheet>
            <property>
              <propertyName>parameters</propertyName>
              <propertySheet>
                <property>
                  <propertyName>objectType</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>options</propertyName>
                      <propertySheet>
                        <property>
                          <propertyName>list</propertyName>
                          <expandable>1</expandable>
                          <value>job|workflow</value>
                        </property>
                        <property>
                          <propertyName>type</propertyName>
                          <expandable>1</expandable>
                          <value>simpleList</value>
                        </property>
                      </propertySheet>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
              </propertySheet>
            </property>
          </propertySheet>
        </property>
        <property>
          <propertyName>descriptionForPlugin</propertyName>
          <description />
          <expandable>1</expandable>
          <value>A procedure to quickly delete jobs or workflows older than a specified number of days. It will NOT delete associated workspace job directories.</value>
        </property>
        <property>
          <propertyName>ec_parameterForm</propertyName>
          <description />
          <expandable>1</expandable>
          <value>&lt;editor> 
   &lt;formElement> 
        &lt;label>Object Type&lt;/label> 
        &lt;property>objectType&lt;/property> 
        &lt;documentation>The type of objects to delete&lt;/documentation> 
        &lt;type>select&lt;/type> 
        &lt;option> 
            &lt;name>Jobs&lt;/name> 
            &lt;value>job&lt;/value> 
        &lt;/option> 
        &lt;option> 
            &lt;name>Workflows&lt;/name> 
            &lt;value>workflow&lt;/value> 
        &lt;/option> 
        &lt;value>job&lt;/value> 
        &lt;required>1&lt;/required>
    &lt;/formElement> 

    &lt;formElement> 
        &lt;label>Delete objects older than&lt;/label> 
        &lt;property>daysLimit&lt;/property> 
        &lt;documentation>Indicate the numbers of days after which jobs should be deleted&lt;/documentation> 
        &lt;type>select&lt;/type> 
        &lt;option> 
            &lt;name>1 month&lt;/name> 
            &lt;value>30&lt;/value> 
        &lt;/option> 
        &lt;option> 
            &lt;name>2 months&lt;/name> 
            &lt;value>60&lt;/value> 
        &lt;/option> 
        &lt;option> 
            &lt;name>3 months&lt;/name> 
            &lt;value>91&lt;/value> 
        &lt;/option> 
        &lt;option> 
            &lt;name>6 months&lt;/name> 
            &lt;value>182&lt;/value> 
        &lt;/option> 
        &lt;option> 
            &lt;name>1 year&lt;/name> 
            &lt;value>365&lt;/value> 
        &lt;/option> 
        &lt;value>91&lt;/value> 
        &lt;required>1&lt;/required>
    &lt;/formElement> 

    &lt;formElement> 
        &lt;label>Maximum number of objects to delete&lt;/label> 
        &lt;property>maxObjects&lt;/property> 
        &lt;documentation>Indicate the maximum numbers of objects to delete&lt;/documentation> 
        &lt;type>select&lt;/type> 
        &lt;option> 
            &lt;name>200 objects&lt;/name> 
            &lt;value>200&lt;/value> 
        &lt;/option> 
        &lt;option> 
            &lt;name>500 objects&lt;/name> 
            &lt;value>500&lt;/value> 
        &lt;/option> 
        &lt;option> 
            &lt;name>1000 objects&lt;/name> 
            &lt;value>1000&lt;/value> 
        &lt;/option> 
        &lt;option> 
            &lt;name>2000 objects&lt;/name> 
            &lt;value>2000&lt;/value> 
        &lt;/option> 
        &lt;option> 
            &lt;name>5000 objects&lt;/name> 
            &lt;value>5000&lt;/value> 
        &lt;/option> 
        &lt;value>1000&lt;/value> 
        &lt;required>1&lt;/required>
    &lt;/formElement> 

    &lt;formElement> 
        &lt;label>Chunk size&lt;/label> 
        &lt;property>chunkSize&lt;/property> 
        &lt;documentation>Chunk size&lt;/documentation> 
        &lt;type>entry&lt;/type > 
        &lt;value>200&lt;/value> 
        &lt;required>1&lt;/required>
    &lt;/formElement>
&lt;/editor></value>
        </property>
        <property>
          <propertyName>exposeToPlugin</propertyName>
          <description>So the procedure is shown in the pickerList</description>
          <expandable>1</expandable>
          <value>1</value>
        </property>
      </propertySheet>
      <formalParameter>
        <formalParameterName>chunkSize</formalParameterName>
        <defaultValue>20</defaultValue>
        <description>Iterate over chunks this size until maxObjects.</description>
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>entry</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>daysLimit</formalParameterName>
        <defaultValue>30</defaultValue>
        <description>Delete jobs at least this many days old.</description>
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>entry</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>maxObjects</formalParameterName>
        <defaultValue>2000</defaultValue>
        <description>Delete up to this many objects.</description>
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>entry</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>objectType</formalParameterName>
        <defaultValue>job</defaultValue>
        <description>The type of object (job|workflow|etc).</description>
        <expansionDeferred>0</expansionDeferred>
        <required>1</required>
        <type>select</type>
      </formalParameter>
      <step>
        <stepName>Delete</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>use strict;
use warnings;
use ElectricCommander;
use DateTime;
use POSIX;

$| = 1;

my $olderThan = DateTime->now()->subtract(days => "$[daysLimit]")->iso8601() . ".000Z";
my $interval = floor($[chunkSize] / 20);
# Maximum 60 seconds interval between checks no matter how large the chunk size is.
if ($interval > 60) {
    $interval = 60;
}

if ($[maxObjects] &lt; $[chunkSize]) {
    print STDERR "Error: maxObjects must be at least as large as chunkSize";
    exit 1;
}

print "Chunk size: $[chunkSize]\nDays limit: $[daysLimit]\n"
    . "Max objects: $[maxObjects]\nObject type: $[objectType]\n"
    . "Poll interval: $interval" . "s\n\n";

my $ec = new ElectricCommander;

my $numReturned;
my $numDeleted = 0;
my $numChunks = 0;
my $overallStart = time();
my %deletedObjects = ();
do {
    $numChunks ++;
    my $maxIds = $[chunkSize] > ($[maxObjects] - $numDeleted) ? $[maxObjects] - $numDeleted : $[chunkSize];
    my $result = $ec->deleteObjects("$[objectType]", {
        maxIds     => $maxIds,
        filter     => [{
            propertyName => "finish",
            operator     => "lessThan",
            operand1     => $olderThan
        }],
        sort => [{
            propertyName => "finish",
            order => "ascending"
        }]
    });

    $numReturned = $result->findnodes("/responses/response/objectId")->size();
    $numDeleted += $numReturned;

    foreach my $objectIdNode ($result->findnodes("/responses/response/objectId")) {
        my $objectId = $objectIdNode->string_value;
        if (exists($deletedObjects{$objectId})) {
            my $error = "Error: $objectId is being deleted again";
            $ec->setProperty("summary", $error);
            print STDERR $error;
            exit 1;
        }
        $deletedObjects{$objectId} = 1;
    }

    if ($numReturned > 0) {
        print "Waiting for $numReturned $[objectType]s to be deleted...\n";
        my $lastId = $result->find("/responses/response/objectId[$numReturned]")->string_value;
        $ec->abortOnError(0);
        my $lastObject;
        do {
            sleep $interval;
            $lastObject = $ec->getObjects({objectId=>[$lastId]});
        } while ($lastObject->findvalue("/responses/response/object/objectId"));
        $ec->abortOnError(1);
        my $overallTime = time() - $overallStart;
        my $percent = ceil(($numDeleted / $[maxObjects]) * 100);
        my $summary = "Deleted $numDeleted $[objectType]s ($percent%) | "
            . sprintf("Total average deletion time: %.2fs", $overallTime / $numDeleted);
        $ec->setProperty("summary", $summary);
        print "$summary\n";
    }
} while ($numReturned > 0 &amp;&amp; $[maxObjects] - $numDeleted > 0);

if ($numDeleted == 0) {
    $ec->setProperty("summary", "No $[objectType]s to delete");
}
</command>
        <condition />
        <description />
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor>postp</postProcessor>
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
          <property>
            <propertyName>ec_customEditorData</propertyName>
            <propertySheet>
              <property>
                <propertyName>formType</propertyName>
                <expandable>1</expandable>
                <value>command</value>
              </property>
            </propertySheet>
          </property>
        </propertySheet>
      </step>
    </procedure>
    <procedure>
      <procedureName>deleteWorkspaceOrphans</procedureName>
      <description>Procedure to crawl a workspace directory to find orphan jobs (directories without a matching job)</description>
      <jobNameTemplate>$[/myProject/scripts/jobTemplate]</jobNameTemplate>
      <resourceName />
      <timeLimit />
      <timeLimitUnits>minutes</timeLimitUnits>
      <workspaceName />
      <propertySheet>
        <property>
          <propertyName>ec_customEditorData</propertyName>
          <propertySheet>
            <property>
              <propertyName>parameters</propertyName>
              <propertySheet>
                <property>
                  <propertyName>executeDeletion</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>options</propertyName>
                      <propertySheet>
                        <property>
                          <propertyName>option1</propertyName>
                          <propertySheet>
                            <property>
                              <propertyName>text</propertyName>
                              <expandable>1</expandable>
                              <value>Report</value>
                            </property>
                            <property>
                              <propertyName>value</propertyName>
                              <expandable>1</expandable>
                              <value>false</value>
                            </property>
                          </propertySheet>
                        </property>
                        <property>
                          <propertyName>option2</propertyName>
                          <propertySheet>
                            <property>
                              <propertyName>text</propertyName>
                              <expandable>1</expandable>
                              <value>Delete</value>
                            </property>
                            <property>
                              <propertyName>value</propertyName>
                              <expandable>1</expandable>
                              <value>true</value>
                            </property>
                          </propertySheet>
                        </property>
                        <property>
                          <propertyName>optionCount</propertyName>
                          <expandable>1</expandable>
                          <value>2</value>
                        </property>
                        <property>
                          <propertyName>type</propertyName>
                          <expandable>1</expandable>
                          <value>list</value>
                        </property>
                      </propertySheet>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>olderThab</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>options</propertyName>
                      <propertySheet>
                        <property>
                          <propertyName>option1</propertyName>
                          <propertySheet>
                            <property>
                              <propertyName>text</propertyName>
                              <expandable>1</expandable>
                              <value>1 month</value>
                            </property>
                            <property>
                              <propertyName>value</propertyName>
                              <expandable>1</expandable>
                              <value>30</value>
                            </property>
                          </propertySheet>
                        </property>
                        <property>
                          <propertyName>option2</propertyName>
                          <propertySheet>
                            <property>
                              <propertyName>text</propertyName>
                              <expandable>1</expandable>
                              <value>3 months</value>
                            </property>
                            <property>
                              <propertyName>value</propertyName>
                              <expandable>1</expandable>
                              <value>91</value>
                            </property>
                          </propertySheet>
                        </property>
                        <property>
                          <propertyName>option3</propertyName>
                          <propertySheet>
                            <property>
                              <propertyName>text</propertyName>
                              <expandable>1</expandable>
                              <value>6 months</value>
                            </property>
                            <property>
                              <propertyName>value</propertyName>
                              <expandable>1</expandable>
                              <value>182</value>
                            </property>
                          </propertySheet>
                        </property>
                        <property>
                          <propertyName>option4</propertyName>
                          <propertySheet>
                            <property>
                              <propertyName>text</propertyName>
                              <expandable>1</expandable>
                              <value>1 year</value>
                            </property>
                            <property>
                              <propertyName>value</propertyName>
                              <expandable>1</expandable>
                              <value>365</value>
                            </property>
                          </propertySheet>
                        </property>
                        <property>
                          <propertyName>optionCount</propertyName>
                          <expandable>1</expandable>
                          <value>4</value>
                        </property>
                        <property>
                          <propertyName>type</propertyName>
                          <expandable>1</expandable>
                          <value>list</value>
                        </property>
                      </propertySheet>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>olderThan</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>options</propertyName>
                      <propertySheet>
                        <property>
                          <propertyName>option1</propertyName>
                          <propertySheet>
                            <property>
                              <propertyName>text</propertyName>
                              <expandable>1</expandable>
                              <value>1 month</value>
                            </property>
                            <property>
                              <propertyName>value</propertyName>
                              <expandable>1</expandable>
                              <value>30</value>
                            </property>
                          </propertySheet>
                        </property>
                        <property>
                          <propertyName>option2</propertyName>
                          <propertySheet>
                            <property>
                              <propertyName>text</propertyName>
                              <expandable>1</expandable>
                              <value>3 months</value>
                            </property>
                            <property>
                              <propertyName>value</propertyName>
                              <expandable>1</expandable>
                              <value>91</value>
                            </property>
                          </propertySheet>
                        </property>
                        <property>
                          <propertyName>option3</propertyName>
                          <propertySheet>
                            <property>
                              <propertyName>text</propertyName>
                              <expandable>1</expandable>
                              <value>6 months</value>
                            </property>
                            <property>
                              <propertyName>value</propertyName>
                              <expandable>1</expandable>
                              <value>182</value>
                            </property>
                          </propertySheet>
                        </property>
                        <property>
                          <propertyName>option4</propertyName>
                          <propertySheet>
                            <property>
                              <propertyName>text</propertyName>
                              <expandable>1</expandable>
                              <value>1 year</value>
                            </property>
                            <property>
                              <propertyName>value</propertyName>
                              <expandable>1</expandable>
                              <value>365</value>
                            </property>
                          </propertySheet>
                        </property>
                        <property>
                          <propertyName>optionCount</propertyName>
                          <expandable>1</expandable>
                          <value>4</value>
                        </property>
                        <property>
                          <propertyName>type</propertyName>
                          <expandable>1</expandable>
                          <value>list</value>
                        </property>
                      </propertySheet>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>resource</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>verboseMode</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>true</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>1</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>false</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>workspace</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
              </propertySheet>
            </property>
          </propertySheet>
        </property>
        <property>
          <propertyName>exposeToPlugin</propertyName>
          <description>So the procedure is shown in the pickerList</description>
          <expandable>1</expandable>
          <value>1</value>
        </property>
      </propertySheet>
      <formalParameter>
        <formalParameterName>executeDeletion</formalParameterName>
        <defaultValue>false</defaultValue>
        <description>If this parameter is not true, no real data will be deleted.</description>
        <expansionDeferred>0</expansionDeferred>
        <required>1</required>
        <type>select</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>olderThan</formalParameterName>
        <defaultValue>91</defaultValue>
        <description>Indicate the number of days after which orphans job directories should be deleted</description>
        <expansionDeferred>0</expansionDeferred>
        <required>1</required>
        <type>select</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>resource</formalParameterName>
        <defaultValue>local</defaultValue>
        <description>Choose a resource that have full access to the workspace</description>
        <expansionDeferred>0</expansionDeferred>
        <required>1</required>
        <type>entry</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>verboseMode</formalParameterName>
        <defaultValue>true</defaultValue>
        <description>Display information about directories that are skipped</description>
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>checkbox</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>workspace</formalParameterName>
        <defaultValue>default</defaultValue>
        <description>Name of the workspace t crawl for orphans</description>
        <expansionDeferred>0</expansionDeferred>
        <required>1</required>
        <type>entry</type>
      </formalParameter>
      <step>
        <stepName>crawlWorkspace</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>#############################################################################
#
#  crawlWorkspace-- Script to find orphan job directories in a workspace
#  Copyright 2013 Electric-Cloud Inc.
#
#############################################################################

use File::Path;
use File::stat;
use Fcntl ':mode';
use DateTime;
use Time::localtime;

$[/myProject/scripts/perlHeader]


#############################################################################
#
#  Assign Commander parameters to variables
#
#############################################################################
my $workspace       = "$[/myParent/workspace]";
my $executeDeletion = "$[/myParent/executeDeletion]";
my $nbDays          =  $[/myParent/olderThan];
my $verboseMode     = "$[/myParent/verboseMode]";
#############################################################################
#
#  Global Variables
#
#############################################################################
my $osIsWindows = $^O =~ /MSWin/;
my $totalWksSize=0;          # Size of workspace files
my $totalNbJobs=0;           # Number of orphans job directories
my $wksDir;
my $timeLimit = time() - $nbDays*24*3600;

#############################################################################
#
#  Main
#
#############################################################################

printf ("%s'%s' workspace for orphan job directories older than %d days (%s)!\n",
        $executeDeletion eq "true"?"Deleting":"Crawling", $workspace, $nbDays,
         ctime($timeLimit));

# Check the workspace
my ($success, $xPath, $errorMsg) = InvokeCommander("SuppressLog", "getWorkspace", $workspace);
if (! $success) {
  printf("Cannot access workspace %s!\n%s\n", $workspace, $errorMsg);
  exit 1;
}

if ($osIsWindows) {
  $wksDir=$xPath->findvalue('//agentUncPath');
  $wksDir=~ s#/#\\#g;
} else {
  $wksDir=$xPath->findvalue('//agentUnixPath');
}
printf ("Workspace directory: %s\n\n", $wksDir);
opendir(D, $wksDir) || die "Cannot access workspace directory $wksDir!\n";
foreach my $dir (grep(!/^\.\.?/, readdir(D))) {
  my $fullPath=$wksDir . "/" . $dir;
  my $fStat=stat($fullPath);
  if (! (S_ISDIR($fStat->mode))) {              # skip non directories
    printf ("%s: not a directory. Skipping!\n", $dir) if ($verboseMode eq "true");
    next;
  }
  if ($dir !~ /[-_\(]\d{3,}/ ) {
    printf("%s: does not match a job name pattern. Skipping!\n", $dir);
    next;
  }
  my $fileTime = $fStat->mtime;         #Modification time

  if ( $fileTime > $timeLimit) {    # Check only older directories
    printf("%s: too recent (%s). Skipping!\n", $dir, ctime($fileTime)) if ($verboseMode eq "true");
    next;
  }
  ($success, $xPath, $errorMsg)=InvokeCommander("SuppressLog", "findObjects", "job", 
                                     {filter => [{"propertyName" => "directoryName", "operator" => "like",
                                                  "operand1" => $dir}]
                                     });
  if (scalar($xPath->find('//object')->get_nodelist) == 0) {
    printf("%s: Orphan\n", $dir);
    my $wksSize = getDirSize("$fullPath");
    printf ("  Size: %s\n", humanSize($wksSize));
    $totalWksSize += $wksSize;
    $totalNbJobs++;
    if ($executeDeletion eq "true") {
       printf("  Deleting\n");
       rmtree ([$fullPath]);                
    }       
  }                           
} # foreach $dir

printf("SUMMARY\n");
printf("Total number of jobs:  %d\n", $totalNbJobs);
printf("Total File size:       %s\n", humanSize($totalWksSize));

exit 0;


#############################################################################
#
#  Calculate the size of a directory
#
#############################################################################
sub getDirSize {
  my $dir  = shift;
  my $size = 0;

  opendir(D,"$dir") || return 0;
  foreach my $dirContent (grep(!/^\.\.?/,readdir(D))) {
     my $st=stat("$dir/$dirContent");
     if (S_ISREG($st->mode)) {
       $size += $st->size;
     } elsif (S_ISDIR($st->mode)) {
       $size += getDirSize("$dir/$dirContent");
     }
}
  closedir(D);
  return $size;
}



$[/myProject/scripts/perlLib]
</command>
        <condition />
        <description />
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName>$[resource]</resourceName>
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
    </procedure>
    <procedure>
      <procedureName>jobCleanup_byResult</procedureName>
      <description>Delete jobs and the associated workspace based on  result: keeping X goods/warning, and Y failed
Report the number of jobs, the disk space and database space that could/was be deleted.</description>
      <jobNameTemplate>$[/myProject/scripts/jobTemplate]</jobNameTemplate>
      <resourceName>local</resourceName>
      <timeLimit />
      <timeLimitUnits>minutes</timeLimitUnits>
      <workspaceName />
      <propertySheet>
        <property>
          <propertyName>ec_customEditorData</propertyName>
          <propertySheet>
            <property>
              <propertyName>parameters</propertyName>
              <propertySheet>
                <property>
                  <propertyName>computeDiskUsage</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>true</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>1</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>false</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>delete Aborted Jobs</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>true</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>1</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>false</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>delete Error Jobs</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>true</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>1</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>false</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>delete Successful Jobs</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>true</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>0</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>false</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>deleteAbortedJobs</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>true</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>1</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>false</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>executeDeletion</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>options</propertyName>
                      <propertySheet>
                        <property>
                          <propertyName>option1</propertyName>
                          <propertySheet>
                            <property>
                              <propertyName>text</propertyName>
                              <expandable>1</expandable>
                              <value>Report</value>
                            </property>
                            <property>
                              <propertyName>value</propertyName>
                              <expandable>1</expandable>
                              <value>false</value>
                            </property>
                          </propertySheet>
                        </property>
                        <property>
                          <propertyName>option2</propertyName>
                          <propertySheet>
                            <property>
                              <propertyName>text</propertyName>
                              <expandable>1</expandable>
                              <value>Delete</value>
                            </property>
                            <property>
                              <propertyName>value</propertyName>
                              <expandable>1</expandable>
                              <value>true</value>
                            </property>
                          </propertySheet>
                        </property>
                        <property>
                          <propertyName>optionCount</propertyName>
                          <expandable>1</expandable>
                          <value>2</value>
                        </property>
                        <property>
                          <propertyName>type</propertyName>
                          <expandable>1</expandable>
                          <value>list</value>
                        </property>
                      </propertySheet>
                    </property>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>true</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>0</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>false</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>jobLevel</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>options</propertyName>
                      <propertySheet>
                        <property>
                          <propertyName>option1</propertyName>
                          <propertySheet>
                            <property>
                              <propertyName>text</propertyName>
                              <expandable>1</expandable>
                              <value>Aborted</value>
                            </property>
                            <property>
                              <propertyName>value</propertyName>
                              <expandable>1</expandable>
                              <value>Aborted</value>
                            </property>
                          </propertySheet>
                        </property>
                        <property>
                          <propertyName>option2</propertyName>
                          <propertySheet>
                            <property>
                              <propertyName>text</propertyName>
                              <expandable>1</expandable>
                              <value>Error &amp; Aborted</value>
                            </property>
                            <property>
                              <propertyName>value</propertyName>
                              <expandable>1</expandable>
                              <value>Error</value>
                            </property>
                          </propertySheet>
                        </property>
                        <property>
                          <propertyName>option3</propertyName>
                          <propertySheet>
                            <property>
                              <propertyName>text</propertyName>
                              <expandable>1</expandable>
                              <value>All</value>
                            </property>
                            <property>
                              <propertyName>value</propertyName>
                              <expandable>1</expandable>
                              <value>All</value>
                            </property>
                          </propertySheet>
                        </property>
                        <property>
                          <propertyName>optionCount</propertyName>
                          <expandable>1</expandable>
                          <value>3</value>
                        </property>
                        <property>
                          <propertyName>type</propertyName>
                          <expandable>1</expandable>
                          <value>list</value>
                        </property>
                      </propertySheet>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>jobProperty</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>nbFailedJobs</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>nbGoodJobs</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>nbWarning</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>nbWarningJobs</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>olderThan</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>options</propertyName>
                      <propertySheet>
                        <property>
                          <propertyName>option1</propertyName>
                          <propertySheet>
                            <property>
                              <propertyName>text</propertyName>
                              <expandable>1</expandable>
                              <value>1 month</value>
                            </property>
                            <property>
                              <propertyName>value</propertyName>
                              <expandable>1</expandable>
                              <value>30</value>
                            </property>
                          </propertySheet>
                        </property>
                        <property>
                          <propertyName>option2</propertyName>
                          <propertySheet>
                            <property>
                              <propertyName>text</propertyName>
                              <expandable>1</expandable>
                              <value>2 months</value>
                            </property>
                            <property>
                              <propertyName>value</propertyName>
                              <expandable>1</expandable>
                              <value>60</value>
                            </property>
                          </propertySheet>
                        </property>
                        <property>
                          <propertyName>option3</propertyName>
                          <propertySheet>
                            <property>
                              <propertyName>text</propertyName>
                              <expandable>1</expandable>
                              <value>3 months</value>
                            </property>
                            <property>
                              <propertyName>value</propertyName>
                              <expandable>1</expandable>
                              <value>91</value>
                            </property>
                          </propertySheet>
                        </property>
                        <property>
                          <propertyName>option4</propertyName>
                          <propertySheet>
                            <property>
                              <propertyName>text</propertyName>
                              <expandable>1</expandable>
                              <value>6 months</value>
                            </property>
                            <property>
                              <propertyName>value</propertyName>
                              <expandable>1</expandable>
                              <value>182</value>
                            </property>
                          </propertySheet>
                        </property>
                        <property>
                          <propertyName>option5</propertyName>
                          <propertySheet>
                            <property>
                              <propertyName>text</propertyName>
                              <expandable>1</expandable>
                              <value>1 year</value>
                            </property>
                            <property>
                              <propertyName>value</propertyName>
                              <expandable>1</expandable>
                              <value>365</value>
                            </property>
                          </propertySheet>
                        </property>
                        <property>
                          <propertyName>option6</propertyName>
                          <propertySheet>
                            <property>
                              <propertyName>text</propertyName>
                              <expandable>1</expandable>
                              <value>Now</value>
                            </property>
                            <property>
                              <propertyName>value</propertyName>
                              <expandable>1</expandable>
                              <value>0</value>
                            </property>
                          </propertySheet>
                        </property>
                        <property>
                          <propertyName>optionCount</propertyName>
                          <expandable>1</expandable>
                          <value>6</value>
                        </property>
                        <property>
                          <propertyName>type</propertyName>
                          <expandable>1</expandable>
                          <value>list</value>
                        </property>
                      </propertySheet>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>skipPlugins</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>true</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>1</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>false</value>
                    </property>
                  </propertySheet>
                </property>
              </propertySheet>
            </property>
          </propertySheet>
        </property>
        <property>
          <propertyName>ec_parameterForm</propertyName>
          <description>Redefine UI</description>
          <expandable>1</expandable>
          <value>&lt;editor> 
    &lt;formElement> 
        &lt;label>Delete jobs older than&lt;/label> 
        &lt;property>olderThan&lt;/property> 
        &lt;documentation>Indicate the numbers of days after which jobs should be deleted&lt;/documentation> 
        &lt;type>select&lt;/type> 
        &lt;option> 
            &lt;name>Now&lt;/name> 
            &lt;value>0&lt;/value> 
        &lt;/option> 
        &lt;option> 
            &lt;name>1 month&lt;/name> 
            &lt;value>30&lt;/value> 
        &lt;/option> 
        &lt;option> 
            &lt;name>2 months&lt;/name> 
            &lt;value>60&lt;/value> 
        &lt;/option> 
        &lt;option> 
            &lt;name>3 months&lt;/name> 
            &lt;value>91&lt;/value> 
        &lt;/option> 
        &lt;option> 
            &lt;name>6 months&lt;/name> 
            &lt;value>182&lt;/value> 
        &lt;/option> 
        &lt;option> 
            &lt;name>1 year&lt;/name> 
            &lt;value>365&lt;/value> 
        &lt;/option> 
        &lt;value>0&lt;/value> 
        &lt;required>0&lt;/required>
    &lt;/formElement> 
    &lt;formElement> 
        &lt;label>Success Jobs&lt;/label>	
        &lt;property>nbGoodJobs&lt;/property>	
        &lt;documentation>The number of successful jobs to preserve per procedure&lt;/documentation> 
        &lt;type>entry&lt;/type>	
        &lt;value>5&lt;/value> 
        &lt;required>1&lt;/required>
    &lt;/formElement> 
    &lt;formElement> 
        &lt;label>Warning Jobs&lt;/label> 
        &lt;property>nbWarningJobs&lt;/property> 
        &lt;documentation>The number of Warning jobs to preserve per procedure&lt;/documentation> 
        &lt;type>entry&lt;/type>  
        &lt;value>1&lt;/value> 
        &lt;required>1&lt;/required>
    &lt;/formElement> 
    &lt;formElement> 
        &lt;label>Failed Jobs&lt;/label> 
        &lt;property>nbFailedJobs&lt;/property> 
        &lt;documentation>The number of failed jobs to preserve per procedure&lt;/documentation> 
        &lt;type>entry&lt;/type>  
        &lt;value>5&lt;/value> 
        &lt;required>1&lt;/required>
    &lt;/formElement> 
    &lt;formElement> 
        &lt;label>Job property&lt;/label> 
        &lt;property>jobProperty&lt;/property> 
        &lt;documentation>Name of a property attached to your jobs. If this property is set, your job won't be deleted.
        &lt;/documentation> 
        &lt;type>entry&lt;/type>  
        &lt;value>doNotDelete&lt;/value> 
        &lt;required>1&lt;/required>
    &lt;/formElement> 

    &lt;formElement> 
        &lt;label>Delete&lt;/label>	
        &lt;property>executeDeletion&lt;/property> 
        &lt;documentation>If this option is not set, only report is done. No real data are deleted&lt;/documentation> 
        &lt;type>select&lt;/type>	
        &lt;option> 
            &lt;name>Report&lt;/name> 
            &lt;value>false&lt;/value> 
        &lt;/option> 
        &lt;option> 
            &lt;name>Delete&lt;/name> 
            &lt;value>true&lt;/value> 
        &lt;/option> 
        &lt;value>false&lt;/value>	
    &lt;/formElement> 

    &lt;formElement> 
        &lt;label>Compute Disk Usage&lt;/label>    
        &lt;property>computeDiskUsage&lt;/property> 
        &lt;documentation>Check off to skip the computation of file space used for the job. This will speed up the job.&lt;/documentation> 
        &lt;type>checkbox&lt;/type>    
        &lt;checkedValue>true&lt;/checkedValue> 
        &lt;uncheckedValue>false&lt;/uncheckedValue> 
        &lt;initiallyChecked>1&lt;/initiallyChecked> 
        &lt;value>true&lt;/value>    
    &lt;/formElement> 

    &lt;formElement> 
        &lt;label>Skip plugins&lt;/label>	
        &lt;property>skipPlugins&lt;/property> 
        &lt;documentation>A boolean to indicate to skip plugin projects or not&lt;/documentation> 
        &lt;type>checkbox&lt;/type>	
        &lt;checkedValue>true&lt;/checkedValue> 
        &lt;uncheckedValue>false&lt;/uncheckedValue> 
        &lt;initiallyChecked>1&lt;/initiallyChecked> 
        &lt;value>true&lt;/value>	
    &lt;/formElement>
&lt;/editor> </value>
        </property>
        <property>
          <propertyName>exposeToPlugin</propertyName>
          <description>So the procedure is shown in the pickerList</description>
          <expandable>1</expandable>
          <value>1</value>
        </property>
      </propertySheet>
      <formalParameter>
        <formalParameterName>computeDiskUsage</formalParameterName>
        <defaultValue>true</defaultValue>
        <description>Crawl the workspace job directory to compute the disk space used. Unchecking it will speed runtime.</description>
        <expansionDeferred>0</expansionDeferred>
        <required>1</required>
        <type>checkbox</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>executeDeletion</formalParameterName>
        <defaultValue>false</defaultValue>
        <description>If this option is not set, only report is done. No real data are deleted</description>
        <expansionDeferred>0</expansionDeferred>
        <required>1</required>
        <type>select</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>jobProperty</formalParameterName>
        <defaultValue>doNotDelete</defaultValue>
        <description>Name of a property attached to your jobs. If this property is set, your job won't be deleted.
</description>
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>entry</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>nbFailedJobs</formalParameterName>
        <defaultValue>3</defaultValue>
        <description>number of failed jobs to preserve</description>
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>entry</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>nbGoodJobs</formalParameterName>
        <defaultValue>5</defaultValue>
        <description>Number of good jobs to keep. Warning is considered good.</description>
        <expansionDeferred>0</expansionDeferred>
        <required>1</required>
        <type>entry</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>nbWarningJobs</formalParameterName>
        <defaultValue>0</defaultValue>
        <description>Number of Warning jobs to keep</description>
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>entry</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>olderThan</formalParameterName>
        <defaultValue>0</defaultValue>
        <description>Indicate the numbers of days after which jobs should be deleted</description>
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>select</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>skipPlugins</formalParameterName>
        <defaultValue>true</defaultValue>
        <description>A boolean to indicate to skip plugin projects or not</description>
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>checkbox</type>
      </formalParameter>
      <step>
        <stepName>deleteJobs.byProject</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>#############################################################################
#
#  deleteJobs_byResult -- Script to delete jobs and workspaces keeping
#                         some good and failed ones.
#  Copyright 2013 Electric-Cloud Inc.
#
#############################################################################

#
# Perl Commander Header
$[/myProject/scripts/perlHeader]
use File::Path;
use File::stat;
use Fcntl ':mode';
use DateTime;

#
# Perl Commander library
$[/myProject/scripts/perlLib]

#############################################################################
#
#  Assign Commander parameters to variables
#
#############################################################################
my $jobProperty     = "$[jobProperty]";
my $executeDeletion = "$[executeDeletion]";
my $nbGood          =  $[nbGoodJobs];
my $nbFail          =  $[nbFailedJobs];
my $nbWarn          =  $[nbWarningJobs];
my $skipPluginBool  = "$[skipPlugins]";
my $timeLimit       =  $[olderThan];
my $computeDiskUsage= "$[computeDiskUsage]";

#############################################################################
#
#  Global Variables
#
#############################################################################
my $version="1.0";
my $totalWksSize=0;          # Size of workspace files
my $totalNbJobs=0;           # Number of jobs to delete potentially
my $totalNbSteps=0;          # Number of steps to evaluate DB size
my $DBStepSize=10240;        # Step is about 10K in DB

my $procGood=0;				 # Number of good jobs in the procedure kept
my $procFailed=0;		     # Number of failed jobs in the procedure kept
my $procWarning=0;		     # Number of warning jobs in the procedure kept

$DEBUG=0;

#############################################################################
#
#  Main
#
#############################################################################
printf("%s jobs older than $timeLimit days (%s)  based on results.\n", 
    $executeDeletion eq "true"?"Deleting":"Reporting",
    calculateDate($timeLimit));
printf("  Preserving %d GOOD    jobs\n", $nbGood);
printf("  Preserving %d WARNING jobs\n", $nbWarn);
printf("  Preserving %d FAIL    jobs\n\n", $nbFail);


#
# Loop over each project 
#
my ($success, $pjPath) = InvokeCommander("SuppressLog", "getProjects");
my $projSet = $pjPath->find('//project');
foreach my $pjNode ($projSet->get_nodelist) {
  my $projName  =$pjPath->findvalue('projectName', $pjNode);
  my $pluginName=$pjPath->findvalue('pluginName',  $pjNode);
  
  # skip plugins if Boolean is set
  next if (($pluginName ne "") &amp;&amp; ($skipPluginBool eq "true"));

  printf("Project: %s\n", $projName);
  my $previousProcName="";

  # create filterList
  my @filterList;

  # only finished jobs
  push (@filterList, {"propertyName" => "status",
                      "operator" => "equals",
                      "operand1" => "completed"});
  # older than
  push (@filterList, {"propertyName" => "finish",
                    "operator" => "lessThan",
                    "operand1" => calculateDate($timeLimit)});
  # jobs of a specific project
  push (@filterList, {"propertyName" => "projectName",
                      "operator" => "equals",
                      "operand1" => $projName});
  # do not have specific job property
  push (@filterList, {"propertyName" => $jobProperty,
                        "operator" => "isNull"});

  # Getting the list sorted by procedure
  # then by date (or jobId)
  my ($success, $xPath) = InvokeCommander("SuppressLog", "findObjects", "job",
                                            {maxIds => 5000,
                                             filter => \@filterList ,
                                             sort => [ {propertyName => "procedureName",
                                                        order => "ascending"} ,
                                                       {propertyName => "jobId",
                                                        order => "descending"} ]});

  # Loop over all returned jobs
  my $nodeset = $xPath->find('//job');
  foreach my $node ($nodeset->get_nodelist) {
    my $wksSize;

    my $jobId     = $xPath->findvalue('jobId',   $node);
    my $jobName   = $xPath->findvalue('jobName', $node);
    my $jobOutcome= $xPath->findvalue('outcome', $node);
    my $jobProcedure=$xPath->findvalue('procedureName', $node);
    if ($jobProcedure ne $previousProcName) {
      $previousProcName=$jobProcedure;
      $procGood=0;
      $procFailed=0;
      $procWarning=0;
      my $displayName=$jobProcedure;
      # transforn procedure name to standard PROJ:PROC string
      if ($displayName =~ m#/projects/([^/]+)/procedures/([^/]+)#) {
        $displayName="$1:$2";
      }
      print "  Procedure: $displayName\n";    
    }
    print "    Job: $jobName\n";
      
    # Skiping over X GOOD and Y BAD
    if (($procGood &lt; $nbGood) &amp;&amp; ($jobOutcome eq "success")) {
      printf ("      Preserving job (GOOD)\n");
      $procGood++;
      next;
    }
    if (($procWarning &lt; $nbWarn) &amp;&amp; ($jobOutcome eq "warning")) {
      printf ("      Preserving job (WARNING)\n");
      $procWarning++;
      next;
    }
    if (($procFailed &lt; $nbFail) &amp;&amp; ($jobOutcome eq "error")) {
      printf ("      Preserving job (ERROR)\n");
      $procFailed++;
      next;
    }

    $totalNbJobs++;

    #
    # Find number of steps for the jobs
    my ($success, $xPath) = InvokeCommander("SuppressLog", "findJobSteps", 
                    {'jobId' => $jobId});
    my $nbSteps=scalar($xPath->findnodes('//object')->get_nodelist);
    $totalNbSteps += $nbSteps;
    printf("      Job steps:\t%d\n", $nbSteps) if ($DEBUG);

    #  Find the workspaces (there may be more than one if some steps
    #  were configured to use a different workspace)
    my ($success, $xPath) = InvokeCommander("SuppressLog", "getJobInfo",
                                               $jobId);
    my $wsNodeset = $xPath->find('//job/workspace');
    foreach my $wsNode ($wsNodeset->get_nodelist) {
      my $workspace;
      if ($osIsWindows) {
        $workspace = $xPath->findvalue('./winUNC', $wsNode);
        $workspace =~ s'/'\\'g;
      } else {
        $workspace = $xPath->findvalue('./unix', $wsNode);
      }

      print "      Workspace:\t$workspace\n" if (($workspace ne "") &amp;&amp;  ($DEBUG));

      if ($computeDiskUsage eq "true") {
        $wksSize = getDirSize($workspace);
        printf ("        Size:\t%s\n", humanSize($wksSize)) if ($DEBUG);
        $totalWksSize += $wksSize;
      }
      if ($executeDeletion eq "true") {
        rmtree ([$workspace])  ;
        print "        Deleting Workspace\n" if ($DEBUG);
      }
    }

    # Delete the job

    if ($executeDeletion eq "true") {
      InvokeCommander("SuppressLog", "deleteJob", $jobId) ;
      print "      Deleting Job\n\n";
    } 
  } #job loop
} #project loop

printf("\nSUMMARY:\n");
printf("Total number of jobs:  %d\n", $totalNbJobs);
printf("Total File size:       %s\n", humanSize($totalWksSize))  if ($computeDiskUsage eq "true");
printf("Total number of steps: %d\n", $totalNbSteps);
printf("Total Database size:   %s\n", humanSize($totalNbSteps * $DBStepSize));

$ec->setProperty("/myJob/numberOfJobs", $totalNbJobs);
$ec->setProperty("/myJob/diskSpace", $totalWksSize) if ($computeDiskUsage eq "true");
$ec->setProperty("/myJob/numbernumberOfSteps", $totalNbSteps);

$ec->setProperty("summary", $totalNbJobs . " jobs deleted" ) if ($executeDeletion eq "true");

exit(0);


#############################################################################
#
#  Calculate the size of the workspace directory
#
#############################################################################
sub getDirSize {
  my $dir  = shift;
  my $size = 0;

  opendir(D,"$dir") || return 0;
  foreach my $dirContent (grep(!/^\.\.?/,readdir(D))) {
     my $st=stat("$dir/$dirContent");
     if (S_ISREG($st->mode)) {
       $size += $st->size;
     } elsif (S_ISDIR($st->mode)) {
       $size += getDirSize("$dir/$dirContent");
     }
  }
  closedir(D);
  return $size;
}


#############################################################################
#
#  Calculate the Date based on now and the number of days required by
#  the user before deleting jobs
#
#############################################################################
sub calculateDate {
    my $nbDays=shift;
    return DateTime->now()->subtract(days => $nbDays)->iso8601() . ".000Z";
}

</command>
        <condition />
        <description>Script to delete all jobs and workspaces associated to a project
It includes CI and workflows jobs.</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
    </procedure>
    <procedure>
      <procedureName>jobsCleanup</procedureName>
      <description>Delete jobs older than a number of days, along with the associated workspace.
Report the number of jobs, the disk space and database space that could/was be deleted.

Changelog:
--------------
09-20-2013  lrochette    Rewritten using JSON to increase performance
                                       Paramater is also now used to skip number of steps computation
 09-12-2013  lrochette   Add a parameter to skip the computation of the disk space used; to speed up the job</description>
      <jobNameTemplate>$[/myProject/scripts/jobTemplate]</jobNameTemplate>
      <resourceName>local</resourceName>
      <timeLimit />
      <timeLimitUnits>minutes</timeLimitUnits>
      <workspaceName />
      <propertySheet>
        <property>
          <propertyName>ec_customEditorData</propertyName>
          <propertySheet>
            <property>
              <propertyName>parameters</propertyName>
              <propertySheet>
                <property>
                  <propertyName>computeDiskUsage</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>true</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>1</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>false</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>computeUsage</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>true</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>1</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>false</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>delete Aborted Jobs</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>true</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>1</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>false</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>delete Error Jobs</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>true</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>1</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>false</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>delete Successful Jobs</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>true</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>0</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>false</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>deleteAbortedJobs</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>true</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>1</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>false</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>executeDeletion</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>options</propertyName>
                      <propertySheet>
                        <property>
                          <propertyName>option1</propertyName>
                          <propertySheet>
                            <property>
                              <propertyName>text</propertyName>
                              <expandable>1</expandable>
                              <value>Report</value>
                            </property>
                            <property>
                              <propertyName>value</propertyName>
                              <expandable>1</expandable>
                              <value>false</value>
                            </property>
                          </propertySheet>
                        </property>
                        <property>
                          <propertyName>option2</propertyName>
                          <propertySheet>
                            <property>
                              <propertyName>text</propertyName>
                              <expandable>1</expandable>
                              <value>Delete</value>
                            </property>
                            <property>
                              <propertyName>value</propertyName>
                              <expandable>1</expandable>
                              <value>true</value>
                            </property>
                          </propertySheet>
                        </property>
                        <property>
                          <propertyName>optionCount</propertyName>
                          <expandable>1</expandable>
                          <value>2</value>
                        </property>
                        <property>
                          <propertyName>type</propertyName>
                          <expandable>1</expandable>
                          <value>list</value>
                        </property>
                      </propertySheet>
                    </property>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>true</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>0</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>false</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>jobLevel</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>options</propertyName>
                      <propertySheet>
                        <property>
                          <propertyName>option1</propertyName>
                          <propertySheet>
                            <property>
                              <propertyName>text</propertyName>
                              <expandable>1</expandable>
                              <value>Aborted</value>
                            </property>
                            <property>
                              <propertyName>value</propertyName>
                              <expandable>1</expandable>
                              <value>Aborted</value>
                            </property>
                          </propertySheet>
                        </property>
                        <property>
                          <propertyName>option2</propertyName>
                          <propertySheet>
                            <property>
                              <propertyName>text</propertyName>
                              <expandable>1</expandable>
                              <value>Error &amp; Aborted</value>
                            </property>
                            <property>
                              <propertyName>value</propertyName>
                              <expandable>1</expandable>
                              <value>Error</value>
                            </property>
                          </propertySheet>
                        </property>
                        <property>
                          <propertyName>option3</propertyName>
                          <propertySheet>
                            <property>
                              <propertyName>text</propertyName>
                              <expandable>1</expandable>
                              <value>All</value>
                            </property>
                            <property>
                              <propertyName>value</propertyName>
                              <expandable>1</expandable>
                              <value>All</value>
                            </property>
                          </propertySheet>
                        </property>
                        <property>
                          <propertyName>optionCount</propertyName>
                          <expandable>1</expandable>
                          <value>3</value>
                        </property>
                        <property>
                          <propertyName>type</propertyName>
                          <expandable>1</expandable>
                          <value>list</value>
                        </property>
                      </propertySheet>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>jobPatternMatching</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>jobProperty</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>olderThan</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>options</propertyName>
                      <propertySheet>
                        <property>
                          <propertyName>option1</propertyName>
                          <propertySheet>
                            <property>
                              <propertyName>text</propertyName>
                              <expandable>1</expandable>
                              <value>1 month</value>
                            </property>
                            <property>
                              <propertyName>value</propertyName>
                              <expandable>1</expandable>
                              <value>30</value>
                            </property>
                          </propertySheet>
                        </property>
                        <property>
                          <propertyName>option2</propertyName>
                          <propertySheet>
                            <property>
                              <propertyName>text</propertyName>
                              <expandable>1</expandable>
                              <value>2 months</value>
                            </property>
                            <property>
                              <propertyName>value</propertyName>
                              <expandable>1</expandable>
                              <value>60</value>
                            </property>
                          </propertySheet>
                        </property>
                        <property>
                          <propertyName>option3</propertyName>
                          <propertySheet>
                            <property>
                              <propertyName>text</propertyName>
                              <expandable>1</expandable>
                              <value>3 months</value>
                            </property>
                            <property>
                              <propertyName>value</propertyName>
                              <expandable>1</expandable>
                              <value>91</value>
                            </property>
                          </propertySheet>
                        </property>
                        <property>
                          <propertyName>option4</propertyName>
                          <propertySheet>
                            <property>
                              <propertyName>text</propertyName>
                              <expandable>1</expandable>
                              <value>6 months</value>
                            </property>
                            <property>
                              <propertyName>value</propertyName>
                              <expandable>1</expandable>
                              <value>182</value>
                            </property>
                          </propertySheet>
                        </property>
                        <property>
                          <propertyName>option5</propertyName>
                          <propertySheet>
                            <property>
                              <propertyName>text</propertyName>
                              <expandable>1</expandable>
                              <value>1 year</value>
                            </property>
                            <property>
                              <propertyName>value</propertyName>
                              <expandable>1</expandable>
                              <value>365</value>
                            </property>
                          </propertySheet>
                        </property>
                        <property>
                          <propertyName>optionCount</propertyName>
                          <expandable>1</expandable>
                          <value>5</value>
                        </property>
                        <property>
                          <propertyName>type</propertyName>
                          <expandable>1</expandable>
                          <value>list</value>
                        </property>
                      </propertySheet>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
              </propertySheet>
            </property>
          </propertySheet>
        </property>
        <property>
          <propertyName>descriptionForPlugin</propertyName>
          <description />
          <expandable>1</expandable>
          <value>Delete jobs older than a number of days, along with the associated workspace.</value>
        </property>
        <property>
          <propertyName>ec_parameterForm</propertyName>
          <description>Redefine UI</description>
          <expandable>1</expandable>
          <value>&lt;editor> 
    &lt;formElement> 
        &lt;label>Delete jobs older than&lt;/label>    
        &lt;property>olderThan&lt;/property>    
        &lt;documentation>Indicate the numbers of days after which jobs should be deleted&lt;/documentation> 
        &lt;type>select&lt;/type> 
        &lt;option> 
            &lt;name>1 month&lt;/name> 
            &lt;value>30&lt;/value> 
        &lt;/option> 
        &lt;option> 
            &lt;name>2 months&lt;/name> 
            &lt;value>60&lt;/value> 
        &lt;/option> 
        &lt;option> 
            &lt;name>3 months&lt;/name> 
            &lt;value>91&lt;/value> 
        &lt;/option> 
        &lt;option> 
            &lt;name>6 months&lt;/name> 
            &lt;value>182&lt;/value> 
        &lt;/option> 
        &lt;option> 
            &lt;name>1 year&lt;/name> 
            &lt;value>365&lt;/value> 
        &lt;/option> 
        &lt;value>91&lt;/value>  
        &lt;required>1&lt;/required>
    &lt;/formElement> 

    &lt;formElement> 
        &lt;label>Type of jobs to delete&lt;/label>    
        &lt;property>jobLevel&lt;/property>    
        &lt;documentation>define what jobs you want to delete: Aborted, Error, All&lt;/documentation> 
        &lt;type>select&lt;/type> 
        &lt;option> 
            &lt;name>Aborted&lt;/name> 
            &lt;value>Aborted&lt;/value> 
        &lt;/option> 
        &lt;option> 
            &lt;name>Error and Aborted&lt;/name> 
            &lt;value>Error&lt;/value> 
        &lt;/option> 
        &lt;option> 
            &lt;name>All&lt;/name> 
            &lt;value>All&lt;/value> 
        &lt;/option> 
        &lt;value>Aborted&lt;/value>  
        &lt;required>1&lt;/required>
    &lt;/formElement> 

    &lt;formElement> 
        &lt;label>Job property&lt;/label> 
        &lt;property>jobProperty&lt;/property> 
        &lt;documentation>Name of a property attached to your jobs. If this property is set, your job won't be deleted.
        &lt;/documentation> 
        &lt;type>entry&lt;/type> 
        &lt;value>doNotDelete&lt;/value> 
        &lt;required>1&lt;/required>
    &lt;/formElement> 

    &lt;formElement> 
        &lt;label>Pattern matching&lt;/label> 
        &lt;property>jobPatternMatching&lt;/property> 
        &lt;documentation>a SQL pattern matching to automatically preserve some jobs. The pattern must solve for a LIKE statement.&lt;/documentation> 
        &lt;type>entry&lt;/type>
    &lt;/formElement> 

    &lt;formElement> 
        &lt;label>Delete&lt;/label>    
        &lt;property>executeDeletion&lt;/property> 
        &lt;documentation>If this option is not set, only report is done. No real data are deleted&lt;/documentation> 
        &lt;type>select&lt;/type>    
        &lt;option> 
            &lt;name>Report&lt;/name> 
            &lt;value>false&lt;/value> 
        &lt;/option> 
        &lt;option> 
            &lt;name>Delete&lt;/name> 
            &lt;value>true&lt;/value> 
        &lt;/option> 
        &lt;value>false&lt;/value>    
    &lt;/formElement> 

    &lt;formElement> 
        &lt;label>Compute Usage&lt;/label>	
        &lt;property>computeUsage&lt;/property> 
        &lt;documentation>Check off to skip the computation of the number of steps and the file space used for the job. This will speed up the execution.&lt;/documentation> 
        &lt;type>checkbox&lt;/type>	
        &lt;checkedValue>true&lt;/checkedValue> 
        &lt;uncheckedValue>false&lt;/uncheckedValue> 
        &lt;initiallyChecked>1&lt;/initiallyChecked> 
        &lt;value>true&lt;/value>	
    &lt;/formElement> 

&lt;/editor></value>
        </property>
        <property>
          <propertyName>exposeToPlugin</propertyName>
          <description>So the procedure is shown in the pickerList</description>
          <expandable>1</expandable>
          <value>1</value>
        </property>
      </propertySheet>
      <formalParameter>
        <formalParameterName>computeUsage</formalParameterName>
        <defaultValue>true</defaultValue>
        <description>Crawl the workspace job directory and the number of steps to compute the space use. Unchecking it will speed runtime.</description>
        <expansionDeferred>0</expansionDeferred>
        <required>1</required>
        <type>checkbox</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>executeDeletion</formalParameterName>
        <defaultValue>false</defaultValue>
        <description>If this option is not set, only report is done. No real data are deleted</description>
        <expansionDeferred>0</expansionDeferred>
        <required>1</required>
        <type>select</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>jobLevel</formalParameterName>
        <defaultValue>Aborted</defaultValue>
        <description>define what jobs you want to delete: Aborted, Error, All</description>
        <expansionDeferred>0</expansionDeferred>
        <required>1</required>
        <type>select</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>jobPatternMatching</formalParameterName>
        <defaultValue />
        <description>a SQL pattern matching to automatically preserve some jobs. The pattern must solve for a LIKE statement.</description>
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>entry</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>jobProperty</formalParameterName>
        <defaultValue>doNotDelete</defaultValue>
        <description>Name of a property attached to your jobs. If this property is set, your job won't be deleted no matter how old it is.
</description>
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>entry</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>olderThan</formalParameterName>
        <defaultValue>91</defaultValue>
        <description>Indicate the numbers of days after which jobs should be deleted</description>
        <expansionDeferred>0</expansionDeferred>
        <required>1</required>
        <type>select</type>
      </formalParameter>
      <step>
        <stepName>deleteJobs</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>#############################################################################
#
#  deleteJobs -- Script to delete jobs and workspaces
#  Copyright 2013 Electric-Cloud Inc.
#
#############################################################################

#
# Perl Commander Header
$[/myProject/scripts/perlHeaderJSON]
use File::Path;
use File::stat;
use Fcntl ':mode';
use DateTime;

#
# Perl Commander library
$[/myProject/scripts/perlLibJSON]

#############################################################################
#
#  Assign Commander parameters to variables
#
#############################################################################
my $jobProperty     = "$[jobProperty]";
my $timeLimit       =  $[olderThan];
my $executeDeletion = "$[executeDeletion]";
my $jobLevel        = "$[jobLevel]";
my $jobPattern      = "$[jobPatternMatching]"; 
my $computeUsage    = "$[computeUsage]";

#############################################################################
#
#  Global Variables
#
#############################################################################
my $version="1.0";
my $totalWksSize=0;          # Size of workspace files
my $totalNbJobs=0;           # Number of jobs to delete potentially
my $totalNbSteps=0;          # Number of steps to evaluate DB size
my $DBStepSize=10240;        # Step is about 10K in DB

my $MAXJOBS=5000;            # Limiting the number of Objects returned
my $nbObjs;                  # Number of Objects returned

#############################################################################
#
#  Main
#
#############################################################################

printf("%s jobs older than $timeLimit days (%s).\n", 
    $executeDeletion eq "true"?"Deleting":"Reporting", 
    calculateDate($timeLimit));
printf("  Skipping over \"%s\" jobs.\n\n", $jobPattern) if ($jobPattern ne "");

# create filterList
my @filterList;
# only finished jobs
push (@filterList, {"propertyName" => "status",
                    "operator" => "equals",
                    "operand1" => "completed"});
# older than
push (@filterList, {"propertyName" => "finish",
                    "operator" => "lessThan",
                    "operand1" => calculateDate($timeLimit)});
# do not have specific job property
push (@filterList, {"propertyName" => $jobProperty,
                    "operator" => "isNull"});
# job pattern does not match
if ($jobPattern ne "") {
  push (@filterList, {"propertyName" => "jobName",
                      "operator" => "notLike",
                      "operand1" => $jobPattern});
}              
# check for jobLevel
if ($jobLevel eq "Aborted") {
  push (@filterList, {"propertyName" => "abortStatus",
                      "operator" => "equals",
                      "operand1" => "FORCE_ABORT"});
} elsif ($jobLevel eq "Error") {
  push (@filterList, {"propertyName" => "outcome",
                       "operator" => "equals",
                       "operand1" => "error"});
}

do {
  my ($success, $xPath) = InvokeCommander("SuppressLog", "findObjects", "job",
                                        {maxIds => $MAXJOBS, 
                                         numObjects => $MAXJOBS,
                                         filter => \@filterList ,
                                         sort => [ {propertyName => "finish",
                                                    order => "ascending"} ]});

  # Loop over all returned jobs
  my @nodeset=$xPath->findnodes('//job');
  $nbObjs=scalar(@nodeset);
  printf("Search Status:\t$success. %s objects returned\n", $nbObjs);
  
  foreach my $node (@nodeset) {
        $totalNbJobs++;
        my $wksSize;

        my $jobId   = $node->{'jobId'};
        my $jobName = $node->{'jobName'};

        print "Job: $jobName\n";

        #
        # Find abort status and outcome
        if ($node->{'abortStatus'} eq "FORCE_ABORT") {
          printf("  Outcome:\tAborted\n");
        } else {
        printf("  Outcome:\t%s\n", $node->{'outcome'});
        }
        #
        # Find number of steps for the jobs
        if ($computeUsage eq "true") {
          my ($success, $xPath) = InvokeCommander("SuppressLog", "findJobSteps", 
                      {'jobId' => $jobId});
          my $nbSteps=scalar($xPath->findnodes('//object'));
          $totalNbSteps += $nbSteps;
          printf("  Job steps:\t%d\n", $nbSteps);
        }
        #  Find the workspaces (there may be more than one if some steps
        #  were configured to use a different workspace)
        my ($success, $xPath) = InvokeCommander("SuppressLog", "getJobInfo",
                                                 $jobId);
        foreach my $wsNode ($xPath->findnodes('//job/workspace')) {
            my $workspace;
            if ($osIsWindows) {
                $workspace = $wsNode->{'winUNC'};
                $workspace =~ s'/'\\'g;
            } else {
                $workspace = $wsNode->{'unix'};
            }

            print "  Workspace:\t$workspace\n" if ($workspace ne "");

            if ($computeUsage eq "true") {
              $wksSize = getDirSize($workspace);
              printf ("    Size:\t%s\n", humanSize($wksSize));
              $totalWksSize += $wksSize;
            }
            if ($executeDeletion eq "true") {
               rmtree ([$workspace])  ;
               print "    Deleting Workspace\n";
            }
        }

        # Delete the job

        if ($executeDeletion eq "true") {
            InvokeCommander("SuppressLog", "deleteJob", $jobId) ;
            print "  Deleting Job\n\n";
        } 
  }  # End for loop
} while (($executeDeletion eq "true") &amp;&amp; ($nbObjs == $MAXJOBS));

printf("\nSUMMARY:\n");
printf("Total number of jobs:  %d\n", $totalNbJobs);
$ec->setProperty("/myJob/numberOfJobs", $totalNbJobs);

if ($totalNbJobs == $MAXJOBS) {
  printf("There are potentially more jobs to access. Click Run again!\n");
  $ec->setProperty("summary", $totalNbJobs . " jobs deleted. RUN AGAIN!" ) if ($executeDeletion eq "true");
} else {
  $ec->setProperty("summary", $totalNbJobs . " jobs deleted" ) if ($executeDeletion eq "true");
}
if ($computeUsage eq "true") {
  printf("Total File size:       %s\n", humanSize($totalWksSize));
  $ec->setProperty("/myJob/diskSpace", $totalWksSize);
  printf("Total number of steps: %d\n", $totalNbSteps);
  printf("Total Database size:   %s\n", humanSize($totalNbSteps * $DBStepSize));
  $ec->setProperty("/myJob/numbernumberOfSteps", $totalNbSteps);
}


exit(0);


#############################################################################
#
#  Calculate the Date based on now and the number of days required by
#  the user before deleting jobs
#
#############################################################################
sub calculateDate {
    my $nbDays=shift;
    return DateTime->now()->subtract(days => $nbDays)->iso8601() . ".000Z";
}


#############################################################################
#
#  Calculate the size of the workspace directory
#
#############################################################################
sub getDirSize {
  my $dir  = shift;
  my $size = 0;

  opendir(D,"$dir") || return 0;
  foreach my $dirContent (grep(!/^\.\.?/,readdir(D))) {
     my $st=stat("$dir/$dirContent");
     if (S_ISREG($st->mode)) {
       $size += $st->size;
     } elsif (S_ISDIR($st->mode)) {
       $size += getDirSize("$dir/$dirContent");
     }
  }
  closedir(D);
  return $size;
}

</command>
        <condition />
        <description>Script to delete jobs and workspaces</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
    </procedure>
    <procedure>
      <procedureName>performanceMetrics</procedureName>
      <description>Performance diagnostics for EC server and agents

Changelog:
--------------
 08-09-2013  lrochette    Fixed bug on Free available RAM with European numbers
 08-30-2013  lrochette    Added fsutil error management 
 08-30-2013  lrochette    Added a cleanup step for the disk performance temporary file
 12-21-2013  lrochette    Added license usage information
 04-16-2014  lrochette    Fixed subprocedure call to myProject instead of a fixed call
 04-18-2014  lrochette    Fixed with resource default  workspace not being used in dynamic steps</description>
      <jobNameTemplate>$[/myProject/scripts/jobTemplate]</jobNameTemplate>
      <resourceName />
      <timeLimit />
      <timeLimitUnits>minutes</timeLimitUnits>
      <workspaceName />
      <propertySheet>
        <property>
          <propertyName>ec_customEditorData</propertyName>
          <propertySheet>
            <property>
              <propertyName>parameters</propertyName>
              <propertySheet>
                <property>
                  <propertyName>debugMode</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>1</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>0</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>0</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>nbJobSteps</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>numberOfGB</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>options</propertyName>
                      <propertySheet>
                        <property>
                          <propertyName>option1</propertyName>
                          <propertySheet>
                            <property>
                              <propertyName>text</propertyName>
                              <expandable>1</expandable>
                              <value>1 GB</value>
                            </property>
                            <property>
                              <propertyName>value</propertyName>
                              <expandable>1</expandable>
                              <value>1</value>
                            </property>
                          </propertySheet>
                        </property>
                        <property>
                          <propertyName>option2</propertyName>
                          <propertySheet>
                            <property>
                              <propertyName>text</propertyName>
                              <expandable>1</expandable>
                              <value>5 GB</value>
                            </property>
                            <property>
                              <propertyName>value</propertyName>
                              <expandable>1</expandable>
                              <value>5</value>
                            </property>
                          </propertySheet>
                        </property>
                        <property>
                          <propertyName>option3</propertyName>
                          <propertySheet>
                            <property>
                              <propertyName>text</propertyName>
                              <expandable>1</expandable>
                              <value>10 GB</value>
                            </property>
                            <property>
                              <propertyName>value</propertyName>
                              <expandable>1</expandable>
                              <value>10</value>
                            </property>
                          </propertySheet>
                        </property>
                        <property>
                          <propertyName>option4</propertyName>
                          <propertySheet>
                            <property>
                              <propertyName>text</propertyName>
                              <expandable>1</expandable>
                              <value>20 GB</value>
                            </property>
                            <property>
                              <propertyName>value</propertyName>
                              <expandable>1</expandable>
                              <value>20</value>
                            </property>
                          </propertySheet>
                        </property>
                        <property>
                          <propertyName>optionCount</propertyName>
                          <expandable>1</expandable>
                          <value>4</value>
                        </property>
                        <property>
                          <propertyName>type</propertyName>
                          <expandable>1</expandable>
                          <value>list</value>
                        </property>
                      </propertySheet>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>numberOfJobSteps</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>numberOfSteps</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
              </propertySheet>
            </property>
          </propertySheet>
        </property>
        <property>
          <propertyName>descriptionForPlugin</propertyName>
          <description />
          <expandable>1</expandable>
          <value>Performance diagnostics for EC server and agents.</value>
        </property>
        <property>
          <propertyName>exposeToPlugin</propertyName>
          <description>So the procedure is shown in the pickerList</description>
          <expandable>1</expandable>
          <value>1</value>
        </property>
      </propertySheet>
      <formalParameter>
        <formalParameterName>debugMode</formalParameterName>
        <defaultValue>0</defaultValue>
        <description>debug Mode</description>
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>checkbox</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>numberOfGB</formalParameterName>
        <defaultValue>1</defaultValue>
        <description>Indicate the numbers of GB of data you can write in your workspace to test disk performance</description>
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>select</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>numberOfJobSteps</formalParameterName>
        <defaultValue>5000</defaultValue>
        <description>The number of job steps to evaluate for the localUsage</description>
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>entry</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>numberOfSteps</formalParameterName>
        <defaultValue>500</defaultValue>
        <description>Number of Steps to create for the Database Performance</description>
        <expansionDeferred>0</expansionDeferred>
        <required>1</required>
        <type>entry</type>
      </formalParameter>
      <step>
        <stepName>Server RAM Amount</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>$[/myProject/performances/scripts/perf.pm]

#
# Param
#
$DEBUG=$[debugMode];

my $RAM=0;     # Amount of RAM in GB
if ($OSNAME =~ /MSWin/) {
  $RAM=`wmic OS get TotalVisibleMemorySize /Value`;
  chomp $RAM;
  $RAM =~ s/TotalVisibleMemorySize=(\d+)/$1/m;
  $RAM = int($RAM);
  printf("RAM amount: %d\n", $RAM) if ($DEBUG);
  $RAM /= 1048576;  
} elsif ($OSNAME eq "linux") {
  $RAM=`cat /proc/meminfo | grep MemTotal | awk '{print \$2}'`;
  chomp $RAM;
  printf("RAM amount: %d\n", $RAM) if ($DEBUG);
   $RAM /= 1048576;
}  else {
  printf ("OS: %s not supported for Commander Server\n", $OSNAME); 
  exit(2);
}

#
# 
#
if ($RAM == 0) {
  printf ("Error getting the RAM amount on %s\n", $OSNAME);
  exit(2);
}

my $str=sprintf("%3.1f GB\n", $RAM);
printf("RAM amount: $str\n");
checkValue("RAM", $RAM, $str);

</command>
        <condition />
        <description>Check the amount of memory for the EC server
Default values:
Bad: &lt; 8 GB
Good: Between 8 and 12 GB
Best: More than 12 GB</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName>local</resourceName>
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>Free RAM</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>$[/myProject/performances/scripts/perf.pm]

#
# Param
#
$DEBUG=$[debugMode];

my $freeRAM=0;     # Amount of RAM in GB
if ($OSNAME =~ /MSWin/) {
  $freeRAM=`systeminfo | find "Available Physical Memory"`;
  chomp $freeRAM;
  printf("free RAM amount: %s\n", $freeRAM) if ($DEBUG);
  # Available Physical Memory: 4,948 MB   or 4,948 in Europe
  $freeRAM =~ s/Available Physical Memory:\s+([\d,.]+) MB/$1/m;
  $freeRAM =~ s/,//;
  printf("RAM amount: %d\n", $freeRAM) if ($DEBUG);
} elsif ($OSNAME eq "linux") {
  $freeRAM=`/usr/bin/free -m | grep "cache:" | awk '{print \$3}'`;
  chomp $freeRAM;
  printf("free RAM amount: %d\n", $freeRAM) if ($DEBUG);
  $freeRAM /= 1024
}  else {
  printf ("OS: %s not supported for Commander Server\n", $OSNAME); 
  exit(2);
}

#
# 
#
if ($freeRAM == 0) {
  printf ("Error getting the RAM amount on %s\n", $OSNAME);
  exit(2);
}

my $str=sprintf("%3.1f MB\n", $freeRAM);
printf("RAM amount: $str\n");
InvokeCommander("SuppressLog", "setProperty", "summary", $str);


</command>
        <condition />
        <description>Check the amount of  free memory for the EC server
Information only</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName>local</resourceName>
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>Disk Space Available</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>$[/myProject/performances/scripts/perf.pm]

#
# Param
#
$DEBUG=$[debugMode];

my $freeDisk=0;     # Amount of available disk on the Data partition
my $diskPartition="$[/server/Electric Cloud/dataDirectory]";

if ($OSNAME =~ /MSWin/) {
  my $drive=substr($diskPartition,0,2);
  printf("Drive:'%s'\n", $drive);
  system('fsutil volume diskfree $drive 2>&amp;1') if ($DEBUG);
  $freeDisk=`fsutil volume diskfree $drive 2>&amp;1`; # | find "avail free"
  chomp $freeDisk;
  if ($freeDisk =~ /avail free/) {
    $freeDisk =~ m/avail free bytes\s+:\s*(\d+)/;
    printf("free Disk Space for %s: %s\n", $diskPartition, $freeDisk) if ($DEBUG);
    $freeDisk=humanSize($freeDisk); 
  } else {
    printf("Error:\n$freeDisk\n");
    InvokeCommander("SuppressLog", "setProperty", "summary", $freeDisk);
    exit(1);
  }
} elsif ($OSNAME eq "linux") {
  $freeDisk=`/bin/df -h $diskPartition | tail -1 | awk '{print \$4}'`;
  chomp $freeDisk;
  # Make the unit  as the other ones
  $freeDisk =~ s/G/ GB/;
  $freeDisk =~ s/M/ MB/;
  printf("free Disk Space for %s: %s\n", $diskPartition, $freeDisk) if ($DEBUG);
}  else {
  printf ("OS: %s not supported for Commander Server\n", $OSNAME); 
  exit(2);
}

printf("Disk space available: %s\n", $freeDisk);
InvokeCommander("SuppressLog", "setProperty", "summary", $freeDisk);


</command>
        <condition />
        <description>Check the amount of  available disk space for the EC server
Information only</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName>local</resourceName>
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>Java Heap</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>$[/myProject/performances/scripts/perf.pm]
$DEBUG=1;

my $wrapperFile="$[/server/Electric Cloud/dataDirectory]/conf/wrapper.conf";
my $javaInitMem=0;
my $javaMaxMem=0;

open FILE, "&lt; $wrapperFile" || die "Cannot open the file $wrapperFile\n";
while (&lt;FILE>) {
  next if /^#/;
  # 
  # Let's look at init memory value that is not commented
  if (/^wrapper.java.initmemory/) {
    if (/\.percent/) {
      # wrapper.java.initmemory.percent=20
      $_ =~ m/=\s*(\w+)/;   
      $javaInitMem= $1."%";
    } else {
      # wrapper.java.initmemory=2048
      $_ =~ m/=\s*(\w+)/;   
      $javaInitMem= $1."mb";
    }  
  } elsif (/^wrapper.java.maxmemory/) {
    if (/\.percent/) {
      # wrapper.java.maxmemory.percent=40
      $_ =~ m/=\s*(\w+)/;   
      $javaMaxMem= $1."%";
    } else {
      # wrapper.java.maxmemory=4096
      $_ =~ m/=\s*(\w+)/;   
      $javaMaxMem= $1."mb";
    }  
  }
}
close(FILE);

my $str=sprintf("Init Java memory: %s\nMax Java memory: %s\n", $javaInitMem, $javaMaxMem);
printf($str);

InvokeCommander("SuppressLog", "setProperty", "summary", $str);

exit(0);

</command>
        <condition />
        <description>Report Java size information

# Initial Java Heap Size (in %)
wrapper.java.initmemory.percent=20

# Initial Java Heap Size (in mb)
#wrapper.java.initmemory=2048

# Maximum Java Heap Size (in %)
wrapper.java.maxmemory.percent=40

# Maximum Java Heap Size (in mb)
#wrapper.java.maxmemory=4096
</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName>local</resourceName>
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>Number of Cores</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>$[/myProject/performances/scripts/perf.pm]

my $nbCores;     # Number of cores
if ($OSNAME =~ /MSWin/) {
  $nbCores=$ENV{NUMBER_OF_PROCESSORS};
} elsif ($OSNAME eq "linux") {
  $nbCores=`nproc`;
  chomp $nbCores;
}  else {
  printf ("OS: %s not supported for COmmander server\n", $OSNAME); 
  exit(2);
}

my $str=sprintf("%2d cores\n", $nbCores);
printf("Number of cores: $str\n");
checkValue("CORE", $nbCores, $str);

</command>
        <condition />
        <description>Check the number of cores for the EC server
Default values:
Bad: &lt; 4
Good: Between 4 and 6
Best: More than 6</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName>local</resourceName>
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>Server CPU Speed</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>$[/myProject/performances/scripts/perf.pm]

my $CPUspeed;     # Amount of RAM in GB
if ($OSNAME =~ /MSWin/) {
  my @result=`wmic cpu get MaxClockSpeed`; # result on 2nd line
  $CPUspeed = int($result[1])/1000;
} elsif ($OSNAME eq "linux") {
  $CPUspeed=`cat /proc/cpuinfo | grep "cpu MHz" | head -1 |awk '{print \$4}'`;
  chomp $CPUspeed;
  #printf("CPU speed: %s\n", $CPUspeed);
   $CPUspeed /= 1000;
}  else {
  printf ("OS: %s not supported for Commander server\n", $OSNAME); 
  exit(2);
}

my $str=sprintf("%2.1f GHz\n", $CPUspeed);
printf("CPU speed: $str\n");
checkValue("CPU", $CPUspeed, $str);

</command>
        <condition />
        <description>Check the CPU speed for the EC server
Default values:
Bad: &lt; 1.5 GHz
Good: Between 1.5 and 2 GHz
Best: More than 2 GHz</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName>local</resourceName>
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>License Usage</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>$[/myProject/scripts/perlHeaderJson]

my $res=$ec->getLicenseUsage()->{responses}->[0]->{licenseUsage};
print Dumper($res);
my $str="";

#
# Concurrent Resources
#
if ($res->{concurrentResources}->{maxHosts} ne 'unlimited') {
  $str .= sprintf("%d of %d hosts\n", $res->{concurrentResources}->{inUseHosts}, $res->{concurrentResources}->{maxHosts}); 
}
if ($res->{concurrentResources}->{maxProxiedHosts} ne 'unlimited') {
  $str .= sprintf("%d of %d proxies\n", $res->{concurrentResources}->{inUseProxiedHosts}, $res->{concurrentResources}->{maxProxiedHosts}); 
}

print $res->{concurrentSteps}->{maxConcurrentSteps};
#
# Concurrent Steps
#
if ($res->{concurrentSteps}->{maxConcurrentSteps} ne 'unlimited') {
  $str .= sprintf("%d of %d steps\n", $res->{concurrentSteps}->{runningSteps}, $res->{concurrentSteps}->{maxConcurrentSteps}); 
}

#
# Concurrent users
#
if ($res->{concurrentUsers}->{maxLicenses} != 999999) {
  $str .= sprintf("%d of %d users\n", $res->{concurrentUsers}->{inUseLicenses}, $res->{concurrentUsers}->{maxLicenses}); 
}
$ec->setProperty("summary", $str);

</command>
        <condition />
        <description>Display information about license usage.</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>deploymentSize</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <condition />
        <description />
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <parallel>0</parallel>
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <subprocedure>subPM-deploymentSize</subprocedure>
        <subproject>$[/myProject/projectName]</subproject>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>localUsage</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <condition />
        <description />
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <parallel>0</parallel>
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <subprocedure>subPM-localUsage</subprocedure>
        <subproject>$[/myProject/projectName]</subproject>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workspaceName />
        <actualParameters>
          <property>
            <propertyName>debugMode</propertyName>
            <expandable>1</expandable>
            <value>0</value>
          </property>
          <property>
            <propertyName>number</propertyName>
            <expandable>1</expandable>
            <value>5000</value>
          </property>
        </actualParameters>
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>Performance</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>$[/myProject/performances/scripts/perf.pm]

my %hostsHash; # List of agents already tested
#Let's loop on Resources
my ($success, $xPath) = InvokeCommander("SuppressLog", "getResources");
my $nodeset = $xPath->find('//resource');

foreach my $node ($nodeset->get_nodelist) {
  my $resName=$node->findvalue('resourceName');
  my $resDisabled=$node->findvalue('resourceDisabled');
  my $agentAlive=$node->findvalue('agentState/alive');
  my $hostName=$node->findvalue('hostName');
  printf("%s\n\t Disabled: %s\n\t alive: %s\n", $resName, $resDisabled, $agentAlive) if ($DEBUG);
  #
  # Create a sub-step only if agent is alive and not disabled
  # to avoid to have to wait (and fail) for unavailable resources
  if ( ($resDisabled eq "0") &amp;&amp; ($agentAlive eq "1") &amp;&amp; !exists($hostsHash{$hostName})) {
    my $hostName=$node->findvalue('hostName');
	$ec->createJobStep({'jobStepName' => $resName,
                        'subprocedure' => "subPM-performance",
                        'parallel' => 1,
                        'actualParameter'=>[{actualParameterName => 'hostname', value => $hostName},
                        					{actualParameterName => 'resource', value => $$resName}]
                        }); 
    $hostsHash{$hostName}=1;  # Mark host as tested
  } 
}


</command>
        <condition />
        <description>Run a performance time on each resource
Test is from http://xahlee.info/UnixResource_dir/sultra_skami.html</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>Database Type</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>$[/myProject/performances/scripts/perf.pm]
$DEBUG=1;

my $DBPropFile="$[/server/Electric Cloud/dataDirectory]/conf/database.properties";
my $DBType;
open FILE, "&lt; $DBPropFile" || die "Cannot open the file $DBPropFile\n";
while (&lt;FILE>) {
  if (/DB_TYPE/) {
    # Extract DB type
    # COMMANDER_DB_TYPE=mysql
    $_ =~ m/=(\w+)/;   
    $DBType = $1;
    last;
  }
}
close(FILE);

printf("Database: %s\n", $DBType);
if ($DBType eq "builtin") {
  printf("BAD\n");
  InvokeCommander("SuppressLog", "setProperty", "outcome", "warning");
} elsif ($DBType eq "mysql") {
  printf("GOOD\n");
} elsif (($DBType eq "sqlserver") || ($DBType eq "oracle")) {
  printf("BEST\n");
} else {
  printf ("Unknown\n");
  InvokeCommander("SuppressLog", "setProperty", "summary", "UNKNOWN");
  exit(1);
}  
InvokeCommander("SuppressLog", "setProperty", "summary", $DBType);

exit(0);

</command>
        <condition />
        <description>Check the Database type for the EC server
Default values:
Bad: H2
Good: mysql
Best: mssql or oracle</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName>local</resourceName>
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>Database Performance</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>$[/myProject/performances/scripts/perf.pm]

#
# Parameters
#
my $nbSteps=$[numberOfSteps];

my $startTime = time();
for (my $i=1; $i &lt;= $nbSteps; $i++) {
  $ec->createJobStep({'jobStepName' => "DBperf-$i",
                      'command'     => "echo Test $i Done"
                        }); 
}
my $totalTime=time()-$startTime;

printf("To run %d steps, it took %d sec\n", $nbSteps, $totalTime);
my $DBperf=$totalTime/$nbSteps;
my $str=sprintf("%.3f step/sec\n", $DBperf);
$ec->setProperty('/myJob/DBPerf', $DBperf);

printf("Database performance: $str\n");
checkValue("DBPERF", $DBperf, $str);


</command>
        <condition />
        <description>Create a bunch of steps to check performance of the DB</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>Write Disk Performance</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>use IO::Handle;
$[/myProject/performances/scripts/perf.pm]

#
# Parameters
my $nbGBs=$[numberOfGB];
my $filename = "output.txt";

open my $numbers_outfile, ">", $filename
    or die "could not open $filename: $!";

$numbers_outfile->autoflush(1);

my $startTime = time();
#each time through the loop should be 1 gig
for (1 .. $nbGBs) {
    #each time though the loop should be 1 meg
    for (1 .. 1024) {
        #print 1 meg of Zs
        print {$numbers_outfile} "Z" x (1024*1024)
    }
}
my $totalTime=time()-$startTime;
close $numbers_outfile;

# Let's keep the file around for the read performance
#unlink ($filename);

printf("To write %d GB, it took %d sec\n", $nbGBs, $totalTime);

my$WRITEspeed=$nbGBs * 1024 / $totalTime;
$ec->setProperty("/myJob/writeDiskPerf", $WRITEspeed);
my $str=sprintf("%5.1f MB/s\n", $WRITEspeed);
printf("Disk Write speed: $str\n");
checkValue("DISKWRITE", $WRITEspeed, $str);

</command>
        <condition />
        <description>Check theDisk Performance for the EC server
Default values:
Bad: H2
Good: mysql
Best: mssql or oracle</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName>local</resourceName>
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>Read Disk Performance </stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>use IO::Handle;
$[/myProject/performances/scripts/perf.pm]

#
# Parameters
my $nbGBs=$[numberOfGB];

# the file was created by the previous step
my $filename = "output.txt";

open FILE, "&lt; $filename"
    or die "could not open $filename: $!";
binmode FILE;

my $startTime = time();
my ($data, $n);
# Let's read the file by 1K
while (($n = read(FILE, $data, 1024)) != 0) {}
close FILE;

my $totalTime=time()-$startTime;
close FILE;
unlink ($filename);

printf("To read %d GB, it took %d sec\n", $nbGBs, $totalTime); 
my $READspeed=$nbGBs * 1024 / $totalTime;
$ec->setProperty("/myJob/readDiskPerf", $READspeed);
my $str=sprintf("%5.1f MB/s\n", $READspeed);
printf("Disk Read speed: $str\n");
checkValue("DISKREAD", $READspeed, $str);

</command>
        <condition />
        <description>Check theDisk Performance for the EC server
</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName>local</resourceName>
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>PingTime</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>$[/myProject/performances/scripts/perf.pm]

my %hostsHash; # List of agents already tested
#Let's loop on Resources
my ($success, $xPath) = InvokeCommander("SuppressLog", "getResources");
my $nodeset = $xPath->find('//resource');

foreach my $node ($nodeset->get_nodelist) {
  my $resName=$node->findvalue('resourceName');
  my $resDisabled=$node->findvalue('resourceDisabled');
  my $agentAlive=$node->findvalue('agentState/alive');
  my $hostName=$node->findvalue('hostName');
  printf("%s\n\t Disabled: %s\n\t alive: %s\n", $resName, $resDisabled, $agentAlive) if ($DEBUG);
  #
  # Create a sub-step only if agent is alive and not disabled
  # to avoid to have to wait (and fail) for unavailable resources
  if ( ($resDisabled eq "0") &amp;&amp; ($agentAlive eq "1") &amp;&amp; !exists($hostsHash{$hostName})) {
    my $hostName=$node->findvalue('hostName');
	$ec->createJobStep({'jobStepName' => $resName,
                        'subprocedure' => "subPM-ping",
                        'actualParameter'=>[{actualParameterName => 'hostname', value => $hostName},
                        					{actualParameterName => 'resource', value => $resName}]
                        }); 
    $hostsHash{$hostName}=1;  # Mark host as tested
  }
}


</command>
        <condition />
        <description>Check the ping times from  the EC server to the agents
</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>Clean Disk Performance Temporary File</stepName>
        <alwaysRun>1</alwaysRun>
        <broadcast>0</broadcast>
        <command>my $filename = "output.txt";

if (-f $filename) {
  unlink($filename);
  printf("Deleting %s\n", $filename);
}
</command>
        <condition />
        <description />
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName>local</resourceName>
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
    </procedure>
    <procedure>
      <procedureName>projectAsCode</procedureName>
      <description>Create a plugin from a simple project

Changelog:
--------------

2014-07-17  lrochette   Added CHANGELOG creation
2014-07-09  lrochette   Include projectAsCode option
2014-06-18  lrochette   Added a hook to allow actions to be taken when the plugin changes state
2014-05-08  lrochette   Added feature to save plugin as an artifact version
2014-04-30  lrochette   Added step to fix self reference to project
2014-04-29  lrochette   Fixed ec_visbility issue
2014-04-03  lrochette   Fixed problem with ec_setup and procedure names with dot (".")
2014-03-12  lrochette   fixed Email address URL issue
2014-03-11  lrochette   Fixed jar error not reported
                                      Fixed Windows path issue for
                                      Use zip when jar is not available to package plugin
2014-01-31  lrochette   Fixed descriptionForPlugin bug
2014-01-26  lrochette   Fixed ec_visbility  (pickListOnly)
2014-02-04  lrochette   Fixed problem with ec_setup and procedure names with dot (".")
2014-04-02  lrochette   Fixed problem with ec_setup and procedure names with dot (".")
2014-04-29  lrochette   Fixed ec_visbility
2014-04-30  lrochette   Added a step to fix self reference to the project</description>
      <jobNameTemplate>$[/myProject/scripts/jobTemplate]</jobNameTemplate>
      <resourceName />
      <timeLimit />
      <timeLimitUnits>minutes</timeLimitUnits>
      <workspaceName />
      <propertySheet>
        <property>
          <propertyName>ec_customEditorData</propertyName>
          <propertySheet>
            <property>
              <propertyName>parameters</propertyName>
              <propertySheet>
                <property>
                  <propertyName>Author</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>Category</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>Comment</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>Description</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>Email</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>Plugin</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>Project</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>SDKResource</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>SDKpath</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>Version</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>createArtifact</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>true</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>0</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>false</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>directory</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>fixSelfReferences</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>true</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>0</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>false</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>installPlugin</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>true</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>1</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>false</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>pluginName</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>projectAsCode</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>true</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>0</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>false</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>promotePlugin</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>true</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>1</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>false</value>
                    </property>
                  </propertySheet>
                </property>
              </propertySheet>
            </property>
          </propertySheet>
        </property>
        <property>
          <propertyName>descriptionForPlugin</propertyName>
          <description>Description used in the pickerList when transformed into a plugin</description>
          <expandable>1</expandable>
          <value>Transform a project into a plugin</value>
        </property>
        <property>
          <propertyName>ec_parameterForm</propertyName>
          <description />
          <expandable>1</expandable>
          <value>&lt;editor>
    &lt;formElement> 
        &lt;label>Project Name&lt;/label> 
        &lt;property>Project&lt;/property> 
        &lt;documentation>Choose a project to transform into a plugin.&lt;/documentation> 
        &lt;type>project&lt;/type>
        &lt;required>1&lt;/required>
    &lt;/formElement> 

    &lt;formElement> 
        &lt;label>Plugin name&lt;/label> 
        &lt;property>Plugin&lt;/property> 
        &lt;documentation>The name of the plugin to create. If left empty, it will default to the project name.&lt;/documentation> 
        &lt;type>entry&lt;/type>
    &lt;/formElement> 

    &lt;formElement> 
        &lt;label>Category&lt;/label> 
        &lt;property>Category&lt;/property> 
        &lt;documentation>Category of the plugin. It helps filter the search for the plugin and its procedures in the picker list.&lt;/documentation> 
        &lt;type>entry&lt;/type>
    &lt;/formElement> 

    &lt;formElement> 
        &lt;label>Version&lt;/label> 
        &lt;property>Version&lt;/property> 
        &lt;documentation>The version of the plugin to create.&lt;/documentation> 
        &lt;type>entry&lt;/type>
        &lt;value>1.0.0&lt;/value>
        &lt;required>1&lt;/required>
    &lt;/formElement> 

    &lt;formElement> 
        &lt;label>Description&lt;/label> 
        &lt;property>Description&lt;/property> 
        &lt;documentation>Description of the plugin. If left empty, it will default to the description of the project.&lt;/documentation> 
        &lt;type>entry&lt;/type>
    &lt;/formElement> 

    &lt;formElement> 
        &lt;label>Author&lt;/label> 
        &lt;property>Author&lt;/property> 
        &lt;documentation>Author of the plugin.&lt;/documentation> 
        &lt;type>entry&lt;/type>
    &lt;/formElement> 

    &lt;formElement> 
        &lt;label>Author's email&lt;/label> 
        &lt;property>Email&lt;/property> 
        &lt;documentation>Email of the plugin author.&lt;/documentation> 
        &lt;type>entry&lt;/type>
    &lt;/formElement> 

    &lt;formElement> 
        &lt;label>Comment&lt;/label> 
        &lt;property>Comment&lt;/property> 
        &lt;documentation>Comment to add to the CHANGELOG.&lt;/documentation> 
        &lt;type>entry&lt;/type>
    &lt;/formElement> 
  
    &lt;formElement> 
        &lt;label>Directory&lt;/label> 
        &lt;property>directory&lt;/property> 
        &lt;documentation>Directory where the project is &lt;/documentation> 
        &lt;type>entry&lt;/type>
    &lt;/formElement> 

    &lt;formElement> 
        &lt;label>SDK Resource&lt;/label> 
        &lt;property>SDKResource&lt;/property> 
        &lt;documentation>A resource where the SDK is installed&lt;/documentation> 
        &lt;type>entry&lt;/type>
    &lt;/formElement> 

    &lt;formElement> 
        &lt;label>SDK Location&lt;/label> 
        &lt;property>SDKpath&lt;/property> 
        &lt;documentation>Location of the Commander SDK.&lt;/documentation> 
        &lt;type>entry&lt;/type>
    &lt;/formElement> 

    &lt;formElement> 
        &lt;label>Fix self references&lt;/label>    
        &lt;property>fixSelfReferences&lt;/property> 
        &lt;documentation>Replace self reference to your project by an empty string.&lt;/documentation> 
        &lt;type>checkbox&lt;/type>    
        &lt;checkedValue>true&lt;/checkedValue> 
        &lt;uncheckedValue>false&lt;/uncheckedValue> 
        &lt;initiallyChecked>0&lt;/initiallyChecked> 
        &lt;value>false&lt;/value>    
    &lt;/formElement>

    &lt;formElement> 
        &lt;label>Project As Code&lt;/label>    
        &lt;property>projectAsCode&lt;/property> 
        &lt;documentation>Modify the ec_setup.pl to extract the project from the created plugin upon promotion.&lt;/documentation> 
        &lt;type>checkbox&lt;/type>    
        &lt;checkedValue>true&lt;/checkedValue> 
        &lt;uncheckedValue>false&lt;/uncheckedValue> 
        &lt;initiallyChecked>0&lt;/initiallyChecked> 
        &lt;value>false&lt;/value>    
    &lt;/formElement>

    &lt;formElement> 
        &lt;label>Create Artifact&lt;/label>    
        &lt;property>createArtifact&lt;/property> 
        &lt;documentation>Save the new created Plugin as an artifact version.&lt;/documentation> 
        &lt;type>checkbox&lt;/type>    
        &lt;checkedValue>true&lt;/checkedValue> 
        &lt;uncheckedValue>false&lt;/uncheckedValue> 
        &lt;initiallyChecked>0&lt;/initiallyChecked> 
        &lt;value>false&lt;/value>    
    &lt;/formElement>

    &lt;formElement> 
        &lt;label>Install Plugin&lt;/label>    
        &lt;property>installPlugin&lt;/property> 
        &lt;documentation>Check to install the plugin automatically after successful creation.&lt;/documentation> 
        &lt;type>checkbox&lt;/type>    
        &lt;checkedValue>true&lt;/checkedValue> 
        &lt;uncheckedValue>false&lt;/uncheckedValue> 
        &lt;initiallyChecked>1&lt;/initiallyChecked> 
        &lt;value>true&lt;/value>    
    &lt;/formElement>

    &lt;formElement> 
        &lt;label>Promote Plugin&lt;/label>    
        &lt;property>promotePlugin&lt;/property> 
        &lt;documentation>Check to promote the plugin automatically after successful installation.&lt;/documentation> 
        &lt;type>checkbox&lt;/type>    
        &lt;checkedValue>true&lt;/checkedValue> 
        &lt;uncheckedValue>false&lt;/uncheckedValue> 
        &lt;initiallyChecked>1&lt;/initiallyChecked> 
        &lt;value>true&lt;/value>    
    &lt;/formElement>

&lt;/editor></value>
        </property>
        <property>
          <propertyName>exposeToPlugin</propertyName>
          <description />
          <expandable>1</expandable>
          <value>1</value>
        </property>
      </propertySheet>
      <formalParameter>
        <formalParameterName>Author</formalParameterName>
        <defaultValue />
        <description>One must take credit where credit is owed</description>
        <expansionDeferred>0</expansionDeferred>
        <required>1</required>
        <type>entry</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>Category</formalParameterName>
        <defaultValue />
        <description>The category used for the plugin list</description>
        <expansionDeferred>0</expansionDeferred>
        <required>1</required>
        <type>entry</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>Comment</formalParameterName>
        <defaultValue />
        <description>Comment to add to description and changeLog</description>
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>entry</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>createArtifact</formalParameterName>
        <defaultValue>false</defaultValue>
        <description>Check to save the plugin in the Artifact Repository</description>
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>checkbox</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>Description</formalParameterName>
        <defaultValue />
        <description>The description of your plugin</description>
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>textarea</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>directory</formalParameterName>
        <defaultValue>/scratch/EC_test</defaultValue>
        <description />
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>entry</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>Email</formalParameterName>
        <defaultValue />
        <description>The email address of the author for support purpose</description>
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>entry</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>fixSelfReferences</formalParameterName>
        <defaultValue>false</defaultValue>
        <description />
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>checkbox</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>installPlugin</formalParameterName>
        <defaultValue>true</defaultValue>
        <description>install the plugin or not at the end of the process</description>
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>checkbox</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>Plugin</formalParameterName>
        <defaultValue />
        <description>The name of the plugin you want to create. If it's empty it will use the source project name.</description>
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>entry</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>Project</formalParameterName>
        <defaultValue />
        <description>Pick the source project for which you want to create a plugin</description>
        <expansionDeferred>0</expansionDeferred>
        <required>1</required>
        <type>project</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>projectAsCode</formalParameterName>
        <defaultValue>false</defaultValue>
        <description>Toggle to add a bit of code in ec_setup to extract the project upon plugin promotion</description>
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>checkbox</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>promotePlugin</formalParameterName>
        <defaultValue>false</defaultValue>
        <description />
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>checkbox</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>SDKpath</formalParameterName>
        <defaultValue />
        <description>The path to your SDK installation</description>
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>entry</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>SDKResource</formalParameterName>
        <defaultValue>local</defaultValue>
        <description>Name of the resource where the SDK is located</description>
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>entry</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>Version</formalParameterName>
        <defaultValue>1.0.0</defaultValue>
        <description>Version of the plugin</description>
        <expansionDeferred>0</expansionDeferred>
        <required>1</required>
        <type>entry</type>
      </formalParameter>
      <step>
        <stepName>Initialization</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>$[/myProject/scripts/perlHeaderJSON]

###################################################################
#
# Parameters
#
###################################################################
my $pluginName="$[Plugin]";
my $project="$[Project]";
my $version="$[Version]";
my $description="$[Description]";
my $comment="$[Comment]";


if ($pluginName eq "") {
  $pluginName=$project;
}
my $pluginBuildNumber=$[/increment /projects/$[Project]/pluginBuildNumber];
my $completeVersion="$version.$pluginBuildNumber";

$ec->setProperty("summary", "Processing plugin $project-$completeVersion");
$ec->setProperty("/myJob/Version", $completeVersion);

# If plugin name is empty default to the projectName
$ec->setProperty("/myJob/pluginName", ($pluginName ne "") ? $pluginName : $project );

# If description is empty, use the project description
if ($description eq "") {
  $description=getP("/projects/$project/description");
}

if ($comment ne "") {
  $description .= "\n$[/timestamp YYYY-MM-DD] $[/myJob/launchedByUser] $[comment]";
}
$ec->setProperty("/myJob/pluginDescription", $description);





</command>
        <condition />
        <description>Set up some job properties</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>setProjectProperty-ec_visbility</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>$[/myProject/scripts/perlHeaderJSON]

my $pName="$[Plugin]";
my $pCategory="$[Category]";
my $project="$[Project]";


if (! getP("/projects/$project/ec_visibility")) {
  $ec->setProperty("/projects/$[Project]/ec_visibility", "pickListOnly");
} else {
   $ec->setProperty("/myCall/ecVisibility",  getP("/projects/$project/ec_visibility") );
}

$[/myProject/scripts/perlLibJSON]
</command>
        <condition />
        <description>set the right properties to be able to see the project in the picketList

$ec->setProperty("/projects/$[Project]/ec_visibility", "pickListOnly");

</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>fixSelfReferences</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>#############################################################################
#
# Copyright 2014 Electric-Cloud Inc.
#
#############################################################################

$[/myProject/scripts/perlHeaderJSON]

#############################################################################
#
# Parameters
#
#############################################################################
my $prj="$[Project]";

my $DEBUG=1;

#
# Schedules Loop
# 
my $res=$ec->getSchedules($prj);

foreach my $node ($res->findnodes("//schedule")) {
    my $sched=$node->{'scheduleName'};
	printf("Processing Schedule: %s\n", $sched);

	if ($node->{'project'} eq "$prj") {
    	printf("        *** Changing schedule project back to empty\n");
    	$ec->setProperty('subproject', "", {projectName=>$prj,  scheduleName=>$sched});
  	}
}
printf("\n\n\n");

#
# Workflow/State Definition Loop
# 
$res=$ec->getWorkflowDefinitions($prj);

foreach my $node ($res->findnodes("//workflowDefinition")) {
	my $wkf=$node->{'workflowDefinitionName'};
	printf("Processing Workflow: %s\n", $wkf);

	my $json=$ec->getStateDefinitions($prj, $wkf);
    
	foreach my $state ($json->findnodes("//stateDefinition")) {
    	my $stateName=$state->{'stateDefinitionName'};
  		printf("    Process State %s\n", $stateName);
        if ($state->{'subproject'} eq "$prj") {
    		printf("        *** Changing state subproject back to empty\n");
    		$ec->setProperty('subproject', "", {projectName=>$prj, workflowDefinitionName=>$wkf, stateDefinitionName=>$stateName});
  		}
	}
}
printf("\n\n\n");

#
# Procedure/Step Loop
# 
$res=$ec->getProcedures($prj);

foreach my $node ($res->findnodes("//procedure")) {
	my $proc=$node->{'procedureName'};
	printf("Processing Procedure: %s\n", $proc);

	my $json=$ec->getSteps($prj, $proc);
    
	foreach my $step ($json->findnodes("//step")) {
    	my $stepName=$step->{'stepName'};
  		printf("    Process Step %s\n", $stepName);
        if ($step->{'subproject'} eq "$prj") {
    		printf("        *** Changing step subproject back to empty\n");
    		$ec->setProperty('subproject', "", {projectName=>$prj, procedureName=>$proc, stepName=>$stepName});
  		}
	}
}
</command>
        <condition>$[fixSelfReferences]</condition>
        <description>Replace self references in states, schedules and steps to the current project by an empty String</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>exportProjectToServer</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>#############################################################################
#
# Copyright 2014 Electric-Cloud Inc.
#
#############################################################################

$[/myProject/scripts/perlHeader]
use XML::LibXML;
use File::Path;

#############################################################################
#
# Parameters
#
#############################################################################
my $prj="$[Project]";		# name of the project to transform

#############################################################################
#
# Global Variables
#
#############################################################################
my $DEBUG=1;		# Debug mode
my $manifest = ""; 	# manifest.pl file content

# Use the logs directory for the temporary export file (we know it's writable by the
# server since it writes its logs there).
my $exportFile = $ec->getProperty("/server/Electric Cloud/dataDirectory")
        		->findvalue("//value")->value() . "/logs/project.xml";


#Create the export file
# use ElectricCommander;
$ec->export($exportFile,{
	 path => "/projects/$prj",
	 excludeJobs => 'true',
	 relocatable => 'true',
	 withNotifiers => 'true'
});


</command>
        <condition />
        <description>The export happens on the server</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName>local</resourceName>
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>copyProjectToResource</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <condition />
        <description />
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <parallel>0</parallel>
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <subprocedure>Remote Copy - Native</subprocedure>
        <subproject>/plugins/EC-FileOps/project</subproject>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workspaceName />
        <actualParameters>
          <property>
            <propertyName>destinationFile</propertyName>
            <expandable>1</expandable>
            <value>$[directory]/project.xml</value>
          </property>
          <property>
            <propertyName>destinationResourceName</propertyName>
            <expandable>1</expandable>
            <value>$[SDKResource]</value>
          </property>
          <property>
            <propertyName>destinationWorkspaceName</propertyName>
            <expandable>1</expandable>
            <value>default</value>
          </property>
          <property>
            <propertyName>sourceFile</propertyName>
            <expandable>1</expandable>
            <value>$[/server/Electric Cloud/dataDirectory]/logs/project.xml</value>
          </property>
          <property>
            <propertyName>sourceResourceName</propertyName>
            <expandable>1</expandable>
            <value>local</value>
          </property>
          <property>
            <propertyName>sourceWorkspaceName</propertyName>
            <expandable>1</expandable>
            <value>default</value>
          </property>
        </actualParameters>
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>deleteExportedProject</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <condition />
        <description />
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <parallel>0</parallel>
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName>local</resourceName>
        <subprocedure>DeleteFile</subprocedure>
        <subproject>/plugins/EC-FileOps/project</subproject>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workspaceName />
        <actualParameters>
          <property>
            <propertyName>Path</propertyName>
            <expandable>1</expandable>
            <value>$[/server/Electric Cloud/dataDirectory]/logs/project.xml</value>
          </property>
        </actualParameters>
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>explodeProject</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>#############################################################################
#
# Copyright 2014 Electric-Cloud Inc.
#
#############################################################################
use strict;
use warnings;
use XML::LibXML;
use File::Path;

$| = 1;

sub fileFriendly($) {
# Replace file-name reserved characters with % equivalent

# Windows reserved characters:  "   &lt;   >   \   ^   |   :   /   *   ?
# Linux reserved characters: &amp; 
# Commander allows all of these, but double quote will cause parsing of manifest.pl to fail

#
#   "   &lt;   >   \   ^   |   :   /   *   ?
# %22 %3C %3E %5C %5E %7C %3A %2F %2A %3F

	my $inputString = shift;
	$inputString =~ s/\"/%22/g;
	$inputString =~ s/\&lt;/%3C/g;
	$inputString =~ s/\>/%3E/g;
	$inputString =~ s/\\/%5C/g;
	$inputString =~ s/\^/%5E/g;
	$inputString =~ s/\|/%7C/g;
	$inputString =~ s/\:/%3A/g;
	$inputString =~ s/\//%2F/g;
	$inputString =~ s/\*/%2A/g;
	$inputString =~ s/\?/%3F/g;
	return $inputString;
}

# Remove old procedures directory if it exists
rmtree("project/procedures");
mkdir "project";
mkdir "project/procedures";

my $manifest = ""; # manifest.pl file content

# Load export file
my $filename = "project.xml";
my $parser = XML::LibXML->new();
my $projectXml = $parser->parse_file($filename);

# Make sure project/propertySheet exists
my $projectNode=$projectXml->findnodes('/exportedData/project');
if (!$projectXml->findnodes('/exportedData/project/propertySheet')) {
	my $propertySheet = $projectXml->ownerDocument->createElement('propertySheet');
	$projectNode->[0]->appendChild($propertySheet);
}

# Add plugin properties
my $projectPropertySheet=$projectXml->findnodes('/exportedData/project/propertySheet');
# Add ec_setup -> PLACEHOLDER property
my $ec_setup = $projectXml->ownerDocument->createElement('property');
$ec_setup->appendTextChild('propertyName',"ec_setup");
$ec_setup->appendTextChild('value',"PLACEHOLDER");
$projectPropertySheet->[0]->appendChild($ec_setup);
# Add project_version -> 1.10.1.66 property
my $project_version = $projectXml->ownerDocument->createElement('property');
$project_version->appendTextChild('propertyName',"project_version");
$project_version->appendTextChild('value','1.10.1.66');
$projectPropertySheet->[0]->appendChild($project_version);

# Replace some plugin values
#exportPath: /projects/exportPath -> /projects/EC-Admin
my $exportPathNode=($projectXml->findnodes('/exportedData/exportPath'))[0];
$exportPathNode->removeChildNodes;  # Remove the current value
$exportPathNode->appendText('/projects/EC-Admin'); # Insert new value
#projectName -> EC-Admin
my $projectNameNode=($projectXml->findnodes('/exportedData/project/projectName'))[0];
$projectNameNode->removeChildNodes;  # Remove the current value
$projectNameNode->appendText('EC-Admin'); # Insert new value

$manifest .= qq(\@files = \(
	['//project/propertySheet/property[propertyName="ec_setup"]/value', 'ec_setup.pl'],\n);

foreach my $procedure ($projectXml->findnodes('/exportedData/project/procedure')) {
	my $procedureName = $procedure->find("procedureName")->string_value;
	# my $procedureFile = $procedureName;
	# $procedureFile =~ s/\:/_colon_/g;  # Deal with step name characters not allowed in file names
	my $procedureFile = fileFriendly($procedureName);
	mkdir "project/procedures/$procedureFile";
	mkdir "project/procedures/$procedureFile/steps";
	#print "Procedure: $procedureName\n";
	foreach my $step ($procedure->findnodes('step')) {
		my $stepName = $step->find("stepName")->string_value;
		my $shell = $step->find("shell")->string_value;
		my $command = $step->find("command")->string_value;
		#print "	Step: $stepName\n";
		# Replace command -> PLACEHOLDER (not for subproject steps)
		my $stepNode=($step->findnodes('command'))[0];
		if ($stepNode) {
			$stepNode->removeChildNodes;  # Remove the current value
			$stepNode->appendText('PLACEHOLDER'); # Insert new value
		}
		#
		my $ext=".sh"; # No way to detect whether sh or cmd
		$ext = ".pl" if ($shell eq 'ec-perl' || $shell eq 'perl');
		# my $stepFile = $stepName;
		# $stepFile =~ s/\:/_colon_/g;  # Deal with step name characters not allowed in file names
		my $stepFile = fileFriendly($stepName);
		#print "	Modified Step: $stepName\n";
		my $commandFile = "project/procedures/$procedureFile/steps/$stepFile${ext}";
		open (COMMAND, ">$commandFile") or die "$commandFile:  $!\n";
		print COMMAND $command, "\n";
		close COMMAND;
		$manifest .= qq(	['//project/procedure[procedureName="$procedureName"]/step[stepName="$stepName"]/command', 'procedures/$procedureFile/steps/$stepFile${ext}'],\n);
	} # step
} # procedure

$manifest .= qq(\););
open (MANIFEST, ">project/manifest.pl") or die "$!\n";
print MANIFEST $manifest, "\n";
close MANIFEST;

open (TEMPLATE, ">project/project.xml.in") or die "$!\n";
print TEMPLATE $projectXml->toString(1);
close TEMPLATE;

# delete the exported XML file
unlink("project.xml")


</command>
        <condition />
        <description> Converts a Commander project into ProjectAsCode-ready set of files:
 - Steps:  project/&lt;procedureName>-&lt;stepName>&lt;.extension>
 - project/manifest.pl
 - project/project.xml.in</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory>$[directory]</workingDirectory>
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>createFileStructure</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>#
chdir("$[directory]");

# Create the META-INF and pages directories
mkdir("META-INF");
mkdir ("pages");
mkdir ("cgi-bin");
mkdir ("htdocs");

</command>
        <condition />
        <description>Create the file structure required for a plugin

/
	/ META-INF
		/ plugin.xml
		/ project.xml
	/ pages
		/ help.xml
</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName>$[SDKResource]</resourceName>
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>create_ec_setup.pl</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>$[/myProject/scripts/perlHeader]

#############################################################################
#
# Parameters
#
#############################################################################
my $pCategory="$[Category]";
my $project="$[Project]";
my $projectAsCode="$[projectAsCode]";

my $pName="$[/myJob/pluginName]";

my $ECsetup="";

#
# Add the projectAsCode bit if selected
#
if ($projectAsCode eq "true") {

  $ECsetup .= &lt;&lt; 'ENDOFPAC';
if ($promoteAction eq 'promote') {
    my $pluginName = 'EC-Admin-1.10.1.66';
    my $pluginKey = 'EC-Admin';

    # The purpose of a "ProjectAsCode" plugin is to develop a PROJECT so it can be checked
    # into source control and properly revisioned.  End users of these projects shouldn't
    # be aware of plugins usage on the back-end.  So we create a project by the same name
    # as the plugin key (without a version number) and update that project in-place when a
    # different version is promoted.  To achieve this, we use export and import instead of
    # delete and clone so we can preserve jobs/workflows which would otherwise be lost.

    # Use the logs directory for the temporary export file (we know it's writable by the
    # server since it writes its logs there).
    my $exportFile = $commander->getProperty("/server/Electric Cloud/dataDirectory")
        ->findvalue("//value")->value() . "/logs/$pluginName.xml";
    $commander->export($exportFile, {path => "/projects/$pluginName"});
    $commander->import($exportFile, {path => "/projects/$pluginKey", force => 1});
    unlink($exportFile);

    # Delete the ec_setup property from the user-facing project since it's irrelevant.
    $commander->deleteProperty("/projects/$pluginKey/ec_setup");
}
ENDOFPAC

}	# end of projectAsCode block

#
# Pickup code for Promote/demote
#
if (getP("/projects/$project/promoteAction")) {
  $ECsetup .= "# promote/demote action\n";
  $ECsetup .= getP("/projects/$project/promoteAction");
  $ECsetup .= "\n\n";
}

$ECsetup .= "# Data that drives the create step picker registration for this plugin.\n";

# Loop on each procedure
my $proc;              # Loop variable
my $xpath;
my $pickerList="";

my @procList=$ec->getProcedures($project)->findnodes("//procedure");
foreach $xpath(@procList) {
   my $procName=$xpath->findvalue("//procedureName");
   
   #
   # Skip this procedure if property "exposeToPlugin" is not set to 1
   #
   next if (getP("/projects/$project/procedures/$procName/exposeToPlugin") != 1);
   
   #
   #
   # If property "descrirptionForPlugin" exists, use it
   # if not, use the procedure description itself
   #
   my $description=getP("/projects/$project/procedures/$procName/descriptionForPlugin");
   if (!$description) {
     $description=$xpath->findvalue("//description");
   }
   my $procCleanName=$procName;
   $procCleanName =~ s/[\s\-\.]/\_/g; # replace spaces, . and - by _

# Create a block of perl Code for each procedure ala
#my %startBuild = (
#    label => "$Jenkins- Start a build",
#    procedure => "startBuild",
#    description => "Start a build.",
#    category => "Other"
#);

#escape double quote in the description
  $description =~ s/"/\\"/g;
  
   $ECsetup .= "my %" . "$procCleanName = ( 
  label       => \"$pName - $procName\", 
  procedure   => \"$procName\", 
  description => \"$description\", 
  category    => \"$pCategory\" 
);

" ;

  $pickerList .= "\\%". $procCleanName . ", "; 
} # end foreach loop


# Create the picker List ala
#@::createStepPickerSteps = (\%startBuild, \%getStatus, \%getLog, \%getDuration);

#remote the trailing ", " from the picker List
chop($pickerList); chop($pickerList);
$ECsetup .= "\@::createStepPickerSteps = (" . $pickerList . ");\n";

print "Code generated\n";
print $ECsetup;

my $ec_setupFile = "project/ec_setup.pl";
open (SETUP, ">$ec_setupFile") or die "$ec_setupFile:  $!\n";
print SETUP $ECsetup, "\n";
close SETUP;

$[/myProject/scripts/perlLib]

</command>
        <condition />
        <description>set the right properties to be able to see the project in the picketList.
Procedure is added only if property pluginExpose is set</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory>$[directory]</workingDirectory>
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>create_build.xml</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>#############################################################################
#
# Copyright 2014 Electric-Cloud Inc.
#
#############################################################################

#############################################################################
#
# Parameters
#
#############################################################################
my $project="$[Project]";
my $SDKDir="$[SDKpath]";

my $version="$[/myJob/Version]";
my $pluginName="$[/myJob/pluginName]";



my $file="$[directory]/build.xml";
unless (open FILE, '>'.$file) {
        printf("File: %s\n", $file);
	die "\nUnable to create $[directory]/build.xml\n";
}
printf(FILE 
'&lt;project name="%s" default="package" basedir=".">
  &lt;description>
    Build the %s plugin
  &lt;/description>

  &lt;!-- Plugin-specific properties -->
  &lt;property name="pluginKey" value="%s" />
  &lt;property name="pluginVersion" value="%s" />

  &lt;path id="extras">
    &lt;!-- Add extra jars that need to be in the classpath for building the 
         plugin here. For example:

         &lt;pathelement location="lib/smartgwt.jar"/>

         will grab the smartgwt jar from the lib directory of the plugin.

         Note that you must also add the jar to the "Referenced Libraries" 
         section of your plugin project for Eclipse to recognize the classes in
         the jar.

         Typically, you must also add an &lt;inherits> element to the .gwt.xml 
         file for a component that uses classes from the third-party package.
    -->
  &lt;/path>
  &lt;property name="gwt.path.extras" value="extras" />

  &lt;import file="$[SDKpath]/build/buildTargets.xml" />
&lt;/project>',

$pluginName, $pluginName, $pluginName, $version);

close(FILE)
</command>
        <condition />
        <description>create the build.xml</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName>$[SDKResource]</resourceName>
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>create_CHANGELOG</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>#############################################################################
#
# Copyright 2014 Electric-Cloud Inc.
#
#############################################################################
use strict;

#############################################################################
#
# Parameters
#
#############################################################################
my $project="$[Project]";
my $comment="$[Comment]";

my $version="$[/myJob/Version]";
my $pluginName="$[/myJob/pluginName]";

my $userFullName="$[/users/$[/myJob/launchedByUser]/fullUserName]";
my $userEmail='$[/users/$[/myJob/launchedByUser]/email]';

my $file="$[directory]/CHANGELOG";
my @changeLogContent=();

# If the CHANGELOG file exist, read it
if (-f $file) {

	unless (open FILE, '&lt;'.$file) {
        printf("File: %s\n", $file);
		die "\nUnable to read $file\n";
	}
    @changeLogContent=&lt;FILE>;
    printf("Content of CHANGELOG:\n");
    print @changeLogContent;
}
unshift (@changeLogContent,"$[/timestamp YYYY-MM-DD] $userFullName &lt;$userEmail>\n  * $comment\n\n");

unless (open FILE, '>'.$file) {
        printf("File: %s\n", $file);
		die "\nUnable to write $file\n";
}

print(FILE @changeLogContent);
close(FILE);
</command>
        <condition>$[/javascript "$[Comment]" != "" ]</condition>
        <description>create the CHANGELOG file</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName>$[SDKResource]</resourceName>
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>create_plugin.xml</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>$[/myProject/scripts/perlHeaderJSON]

my $project="$[Project]";
my $author="$[Author]";
my $email='$[Email]';
my $category="$[Category]";

my $pluginName="$[/myJob/pluginName]";
my $version="$[/myJob/Version]";
my $description="$[/myJob/pluginDescription]";

# replace \n by HTML &lt;br/>
$description =~ s#\n#&lt;br/>#;

if ($author eq "") {
   $author="Electric Cloud";
}

if ($email eq "") {
   $email="plugins\@electric-cloud.com";
}

if ($description eq "") {
  $description=getP("/projects/$project/description");
}

my $file="$[directory]/META-INF/plugin.xml";
unless (open FILE, '>'.$file) {
        printf("File: %s\n", $file);
	die "\nUnable to create $[directory]/META-INF/plugin.xml\n";
}

printf(FILE '&lt;?xml version="1.0" encoding="UTF-8"?>');
printf(FILE "\n&lt;plugin>\n");
printf(FILE "  &lt;key>%s&lt;/key>\n", $pluginName);
printf(FILE "  &lt;version>%s&lt;/version>\n", $version);
printf(FILE "  &lt;label>%s&lt;/label>\n", $pluginName);
printf(FILE "  &lt;description>&lt;html>%s&lt;/html>&lt;/description>\n", $description);

#
# Create the help entry only if it exists
my $help=getP("/projects/$project/help");
if ($help ne "") {
  printf(FILE "  &lt;help>help.xml&lt;/help>\n");
}
printf(FILE "  &lt;author>%s&lt;/author>\n", $author);
printf(FILE "  &lt;authorUrl>mailto:%s&lt;/authorUrl>\n", $email);
printf(FILE "\n");

printf(FILE "  &lt;commander-version min=\"4.1\"/>\n");
printf(FILE "\n");
    
printf(FILE "    &lt;!-- Specify a category for this plugin; this is used in filtered lists in the Plugin Manager.
         Typically, it is set to System or Step.
     -->
");
printf(FILE "  &lt;category>%s&lt;/category>\n", $category);
printf(FILE " 	  &lt;depends>EC-Core&lt;/depends>\n&lt;/plugin>\n");

close FILE;


$[/myProject/scripts/perlLibJSON]
</command>
        <condition />
        <description>create the META-INF/plugin.xml</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName>$[SDKResource]</resourceName>
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>restore-ec_visibility</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>$[/myProject/scripts/perlHeaderJSON]

my $project="$[Project]";

$ec->deleteProperty("/projects/$project/ec_visibility");
if ( $[/javascript (typeof(myCall.ecVisibility) != "undefined") ?"1":"0" ] ) {
   printf("Restoring ec_visibility\n");
   $ec->setProperty("/projects/$project/ec_visibility", getP("/myCall/ecVisibility") );
}
$[/myProject/scripts/perlLibJSON]
</command>
        <condition />
        <description />
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>createHelp.xml</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>$[/myProject/scripts/perlHeaderJSON]
$[/myProject/scripts/perlLibJSON]

my $file="pages/help.xml";
my $help=getP("/projects/$[Project]/help");
my $HELP;

if ($help ne "") {
  chdir("$[directory]");
  open($HELP, "> $file") || die("Cannot open help.xml");

  print $HELP "$help";
  close($HELP);
}
</command>
        <condition />
        <description>if the property "help" exist for the project, use it to create the pages/help.xml</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName>$[SDKResource]</resourceName>
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>buildPlugin</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>$[/myProject/scripts/perlHeader]
use File::Which qw(which);
use File::Copy qw(move);

my $pluginName="$[/myJob/pluginName]";
my $Version="$[/myJob/Version]";

if (my $ant_path=which('ant')) {
  my @args=("ant build");
  system(@args) == 0 or die("system @args failed: $?");
} else {
  printf("ant not found in the path\n");
  $ec->setProperty("summary", "No ant executable in the PATH");
  exit(1);
}

$ec->setProperty("/myJob/report-urls/$pluginName-$Version.jar", "file:/$[/myWorkspace/agentUnixPath]/$[/myJob/directoryName]/$pluginName-$Version.jar");

</command>
        <condition />
        <description>build plugin using ant</description>
        <errorHandling>abortJob</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName>$[SDKResource]</resourceName>
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory>$[directory]</workingDirectory>
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>savePluginAsArtifactVersion</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>#############################################################################
#
#  uploadPlugins -- upload all plugins in the Artifact Repository
#  Copyright 2014 Electric-Cloud Inc.
#
#############################################################################

$[/myProject/scripts/perlHeader]

#
# Parameters
#
my $plugin="$[/myJob/pluginName]";
my $Version="$[/myJob/Version]";

#
# Is this plugin already imported in an Artifact Version
#
my ($ok)=InvokeCommander("SuppressLog IgnoreError", 'getArtifactVersion', "plugins:$plugin:$Version");
if ($ok) {
	printf("\tArtifact Version already exists\n");
    exit 1;    # Artifact already exist
}

#
# Does the Artifact already exist?
#
($ok)=InvokeCommander("SuppressLog IgnoreError", 'getArtifact', "plugins:$plugin");
if (! $ok) {
	InvokeCommander("SuppressLog", 'createArtifact',
		{
        	groupId=>"plugins", artifactKey=>$plugin
		}
);
}
InvokeCommander("SuppressLog", 'publishArtifactVersion',
		{
        	groupId=>"plugins", artifactKey=>$plugin,  version=>$Version,
        	fromDirectory=>".",
            includePatterns=>"*.jar"
		}
);

$[/myProject/scripts/perlLib]
</command>
        <condition>$[createArtifact]</condition>
        <description>Let's save the plugin in the Artifact Repository</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName>$[SDKResource]</resourceName>
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory>$[directory]/out</workingDirectory>
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>installPlugin</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>$[/myProject/scripts/perlHeader]

my $plugin="$[/myJob/pluginName]";
my $version="$[/myJob/Version]";



printf("Installing plugin '$plugin-$version'\n");
$ec->installPlugin("./$plugin.jar");
$ec->setProperty("summary", "$plugin-$version installed");
</command>
        <condition>$[/javascript "$[installPlugin]" == "true" ]
</condition>
        <description />
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName>$[SDKResource]</resourceName>
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory>$[directory]/out</workingDirectory>
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>promotePlugin</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>$[/myProject/scripts/perlHeader]

my $plugin="$[/myJob/pluginName]";
my $version="$[/myJob/Version]";

printf("Promoting plugin '$plugin-$version'\n");
$ec->promotePlugin("$plugin-$version");
$ec->setProperty("summary", "$plugin-$version promoted");
</command>
        <condition>$[/javascript "$[promotePlugin]" == "true" ]</condition>
        <description />
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
    </procedure>
    <procedure>
      <procedureName>releaseSemaphore</procedureName>
      <description>Procedure to release the token 

Changelog:
--------------
 10-04-2013   lrochette   Add job counter to help abort a job.</description>
      <jobNameTemplate>$[/myProject/scripts/jobTemplate]</jobNameTemplate>
      <resourceName />
      <timeLimit />
      <timeLimitUnits>minutes</timeLimitUnits>
      <workspaceName />
      <propertySheet>
        <property>
          <propertyName>ec_customEditorData</propertyName>
          <propertySheet>
            <property>
              <propertyName>parameters</propertyName>
              <propertySheet>
                <property>
                  <propertyName>maxSemaphoreValue</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>semaphoreProperty</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>serializationResource</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
              </propertySheet>
            </property>
          </propertySheet>
        </property>
        <property>
          <propertyName>descriptionForPlugin</propertyName>
          <description />
          <expandable>1</expandable>
          <value>Procedure to release the token.</value>
        </property>
        <property>
          <propertyName>exposeToPlugin</propertyName>
          <description>So the procedure is shown in the pickerList</description>
          <expandable>1</expandable>
          <value>1</value>
        </property>
      </propertySheet>
      <formalParameter>
        <formalParameterName>semaphoreProperty</formalParameterName>
        <defaultValue />
        <description>The path to the property used as a semaphore</description>
        <expansionDeferred>0</expansionDeferred>
        <required>1</required>
        <type>entry</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>serializationResource</formalParameterName>
        <defaultValue />
        <description>This should point to a resouce with a step limit of 1</description>
        <expansionDeferred>0</expansionDeferred>
        <required>1</required>
        <type>entry</type>
      </formalParameter>
      <step>
        <stepName>decrementSemaphore</stepName>
        <alwaysRun>1</alwaysRun>
        <broadcast>0</broadcast>
        <command>$[/myProject/scripts/perlHeader]

my $xPath = $ec->incrementProperty("$[semaphoreProperty]", -1);
my $semaphore = $xPath->findvalue('//value')->string_value;
$ec->setProperty("summary", "semaphore = $semaphore");

# Decrement local counter as well
my $xPath = $ec->incrementProperty("/myJob/localSemaphoreCounter", -1);

</command>
        <condition />
        <description />
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
    </procedure>
    <procedure>
      <procedureName>removeParameterFromCall</procedureName>
      <description>This procedure parse all the projects, procedures and steps to remove a parameter from the call. To be used after it has been removed from a procedure.</description>
      <jobNameTemplate />
      <resourceName />
      <timeLimit />
      <timeLimitUnits>minutes</timeLimitUnits>
      <workspaceName />
      <propertySheet>
        <property>
          <propertyName>ec_customEditorData</propertyName>
          <propertySheet>
            <property>
              <propertyName>parameters</propertyName>
              <propertySheet>
                <property>
                  <propertyName>debug</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>true</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>1</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>false</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>delete</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>true</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>0</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>false</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>param</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>parameter</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>parameter_Name</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>procedure</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>procedure_Name</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>project</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>project_Name</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
              </propertySheet>
            </property>
          </propertySheet>
        </property>
        <property>
          <propertyName>ec_parameterForm</propertyName>
          <description />
          <expandable>1</expandable>
          <value>&lt;editor> 
    &lt;formElement> 
        &lt;label>Project&lt;/label>    
        &lt;property>project_Name&lt;/property>    
        &lt;documentation>The name of the project&lt;/documentation> 
        &lt;type>project&lt;/type> 
        &lt;required>1&lt;/required>
    &lt;/formElement> 

    &lt;formElement> 
        &lt;label>Procedure&lt;/label>    
        &lt;property>procedure_Name&lt;/property>    
        &lt;documentation>The name of the procedure for which you have deleted a parameter&lt;/documentation> 
        &lt;type>entry&lt;/type> 
        &lt;required>1&lt;/required>
    &lt;/formElement> 

    &lt;formElement> 
        &lt;label>Pramater&lt;/label> 
        &lt;property>parameter_Name&lt;/property> 
        &lt;documentation>The name of the parameter you have deleted from the procedure above.&lt;/documentation> 
        &lt;type>entry&lt;/type> 
        &lt;required>1&lt;/required>
    &lt;/formElement>  

    &lt;formElement> 
        &lt;label>Delete&lt;/label>    
        &lt;property>delete&lt;/property> 
        &lt;documentation>If this option is not set, only report is done. No parameter is deleted from any sub-procedure call&lt;/documentation> 
        &lt;type>select&lt;/type>    
        &lt;option> 
            &lt;name>Report&lt;/name> 
            &lt;value>false&lt;/value> 
        &lt;/option> 
        &lt;option> 
            &lt;name>Delete&lt;/name> 
            &lt;value>true&lt;/value> 
        &lt;/option> 
        &lt;value>false&lt;/value>    
    &lt;/formElement> 

    &lt;formElement> 
        &lt;label>Verbose&lt;/label>	
        &lt;property>debug&lt;/property> 
        &lt;documentation>Check to show more details in the log.&lt;/documentation> 
        &lt;type>checkbox&lt;/type>	
        &lt;checkedValue>true&lt;/checkedValue> 
        &lt;uncheckedValue>false&lt;/uncheckedValue> 
        &lt;initiallyChecked>1&lt;/initiallyChecked> 
        &lt;value>true&lt;/value>	
    &lt;/formElement> 

&lt;/editor></value>
        </property>
      </propertySheet>
      <formalParameter>
        <formalParameterName>debug</formalParameterName>
        <defaultValue>true</defaultValue>
        <description />
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>checkbox</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>delete</formalParameterName>
        <defaultValue>false</defaultValue>
        <description />
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>checkbox</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>parameter_Name</formalParameterName>
        <defaultValue />
        <description>The name of the parameter to remove</description>
        <expansionDeferred>0</expansionDeferred>
        <required>1</required>
        <type>entry</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>procedure_Name</formalParameterName>
        <defaultValue />
        <description>The name of the procedure whose parameter is removed</description>
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>entry</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>project_Name</formalParameterName>
        <defaultValue />
        <description />
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>project</type>
      </formalParameter>
      <step>
        <stepName>searchAndRemove</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>$[/plugins[EC-Admin]/project/scripts/perlHeaderJSON]

#
# Parameters
#
my $proj="$[project_Name]";
my $proc="$[procedure_Name]";
my $param="$[parameter_Name]";
my $DEBUG=("$[debug]" eq "true")?1:0;
my $delete=("$[delete]" eq "true")?1:0;

#
# GlobalVariables
#
my $nbProj=0;			# Number of projects we checked
my $nbProc=0;			# Number of procedures we checked
my $nbStep=0;			# Number of steps we checked
my $nbParam=0;			# Number of parameters that are/can be removed
my $nbSched=0;			# Number of schedules we checked

#
# Loop over Projects
#
my ($success, $res) = InvokeCommander("SuppressLog", "getProjects");

foreach my $node ($res->findnodes("//project")) {
  my $projName=$node->{projectName};
  my $pluginName=$node->{pluginName};

	# skip plugins  
	next if ($pluginName ne "");
	printf("Processing %s\n", $projName) if ($DEBUG);
    $nbProj++;

  #
  # Loop over procedures
  #
	my ($success, $res2) = InvokeCommander("SuppressLog", "getProcedures", $projName);
	foreach my $node ($res2->findnodes("//procedure")) {
		my $procName=$node->{procedureName};
		printf("    procedure: %s\n", $procName) if ($DEBUG);
		$nbProc++;
    #
    # Loop over steps
    #
    my ($success, $res3) = InvokeCommander("SuppressLog", "getSteps", $projName, $procName);
    foreach my $node ($res3->findnodes("//step")) {
      my $stepName=$node->{stepName};
      printf("        %s\n", $stepName) if ($DEBUG);
      $nbStep++;
      if ( ($node->{subprocedure} eq "$proc") &amp;&amp;
            (($node->{subproject} eq $proj) ||  (($node->{subproject} eq "") &amp;&amp; ($projName eq $proj)))
           ) {
        #
        # Process param
        #
        processParam($projName, $procName, $stepName, $param, {'projectName' => $projName, 'procedureName' => $procName, 'stepName' => $stepName});

      }
    }  # step loop
  }  # procedure loop

  next;
  
  #
  # Loop over schedules
  #
  my ($success, $res2) = InvokeCommander("SuppressLog", "getSchedules", $projName);
  foreach my $node ($res2->findnodes("//schedule")) {
    my $schedName=$node->{scheduleName};
    printf("    schedule: %s\n", $schedName) if ($DEBUG);
    $nbSched++;

      if ( ($node->{procedure} eq "$proc") &amp;&amp;
            (($node->{project} eq $proj) ||  (($node->{project} eq "") &amp;&amp; ($projName eq $proj)))
           ) {
        #
        # Process param
        #
        my ($ok, $res4)=InvokeCommander("SuppressLog IgnoreError", 'getActualParameter', $param, {'projectName' => $projName, 'scheduleName' => $schedName} );
        if ($ok) {
          $nbParam++;
          printf(" Project: %s\Schedule: %s:\nStep: %s\n", $projName, $schedName);
        }
      }

  }  # schedule loop

}  # project loop

printf("\n\nSummary\n");
printf("Projects  : %d\n", $nbProj);
printf("Procedures: %d\n", $nbProc);
printf("Steps     : %d\n", $nbStep);
printf("Schedules : %d\n", $nbSched);
printf("Params    : %d\n", $nbParam);

$ec->setProperty("summary", sprintf("Projects  : %d\nProcedures: %d\nSteps     : %d\nParams    : %d\n", 
					$nbProj, $nbProc, $nbStep, $nbParam));
                    

sub processParam {
  my ($projName, $procName, $stepName, $paramName)=@_;
  
  my ($ok, $res)=InvokeCommander("SuppressLog IgnoreError", 'getActualParameter', $paramName, {'projectName' => $projName, 'procedureName' => $procName, 'stepName' => $stepName} );
  if ($ok) {
    $nbParam++;
    # printf(" Project: %s\nProcedure: %s:\nStep: %s\n", $projName, $procName, $stepName);

    if ($delete) {
      ($ok, $res)=InvokeCommander("SuppressLog", 'deleteActualParameter', $projName, $procName, $stepName, $paramName );
      if ($ok) {
        printf("      **** Deleted ***\n");
      }
    }
  }
}

$[/plugins[EC-Admin]/project/scripts/perlLibJSON]

</command>
        <condition>0 &amp;&amp; Not Ready</condition>
        <description>Process all non plugins projects, all procedures and steps, all schedules</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
    </procedure>
    <procedure>
      <procedureName>saveAllObjects</procedureName>
      <description>export objects individually in a tree like structure for further CMS checkin: 
  Projects
  Procedures
  Resources
  ResourcePools
  Workspaces
  Users
  Groups
</description>
      <jobNameTemplate>$[/myProject/scripts/jobTemplate]</jobNameTemplate>
      <resourceName />
      <timeLimit />
      <timeLimitUnits>minutes</timeLimitUnits>
      <workspaceName />
      <propertySheet>
        <property>
          <propertyName>ec_customEditorData</propertyName>
          <propertySheet>
            <property>
              <propertyName>parameters</propertyName>
              <propertySheet>
                <property>
                  <propertyName>exportGroups</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>true</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>1</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>false</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>exportResourcePools</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>true</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>1</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>false</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>exportResources</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>true</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>1</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>false</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>exportUsers</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>true</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>1</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>false</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>exportWorkspaces</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>true</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>1</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>false</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>extractResourcePools</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>true</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>1</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>false</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>extractResources</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>true</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>1</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>false</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>pathname</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
              </propertySheet>
            </property>
          </propertySheet>
        </property>
        <property>
          <propertyName>descriptionForPlugin</propertyName>
          <description />
          <expandable>1</expandable>
          <value>This procedure brings a finer granularity to a full server export. For example to retrieve an object after a wrong action or a bad code change. By default it exports projects and each procedure individually. In addition by enabling the matching checkboxes, you can also export resources, resource pools, workspaces, users and groups.</value>
        </property>
        <property>
          <propertyName>ec_parameterForm</propertyName>
          <description>New rendering of the parameters</description>
          <expandable>1</expandable>
          <value>&lt;editor> 
    &lt;formElement> 
        &lt;label>Backup directory&lt;/label>    
        &lt;property>pathname&lt;/property>    
        &lt;documentation>Directory where to saved the XML files.&lt;/documentation> 
        &lt;type>entry&lt;/type>    
        &lt;value>/tmp/BACKUP&lt;/value> 
     &lt;required>1&lt;/required> 
    &lt;/formElement> 

    &lt;formElement> 
        &lt;label>Backup Resources&lt;/label>    
        &lt;property>exportResources&lt;/property> 
        &lt;documentation>Boolean to export Resources&lt;/documentation> 
        &lt;type>checkbox&lt;/type>    
        &lt;checkedValue>true&lt;/checkedValue> 
        &lt;uncheckedValue>false&lt;/uncheckedValue> 
        &lt;initiallyChecked>1&lt;/initiallyChecked> 
        &lt;value>true&lt;/value>    
    &lt;/formElement> 

    &lt;formElement> 
        &lt;label>Backup Resource Pools&lt;/label>    
        &lt;property>exportResourcePools&lt;/property> 
        &lt;documentation>Boolean to export Pools&lt;/documentation> 
        &lt;type>checkbox&lt;/type>    
        &lt;checkedValue>true&lt;/checkedValue> 
        &lt;uncheckedValue>false&lt;/uncheckedValue> 
        &lt;initiallyChecked>1&lt;/initiallyChecked> 
        &lt;value>true&lt;/value>    
    &lt;/formElement> 

    &lt;formElement> 
        &lt;label>Backup Workspaces&lt;/label>    
        &lt;property>exportWorkspaces&lt;/property> 
        &lt;documentation>Boolean to export Workspaces&lt;/documentation> 
        &lt;type>checkbox&lt;/type>    
        &lt;checkedValue>true&lt;/checkedValue> 
        &lt;uncheckedValue>false&lt;/uncheckedValue> 
        &lt;initiallyChecked>1&lt;/initiallyChecked> 
        &lt;value>true&lt;/value>    
    &lt;/formElement> 

    &lt;formElement> 
        &lt;label>Backup Users&lt;/label>    
        &lt;property>exportUsers&lt;/property> 
        &lt;documentation>Boolean to export Users&lt;/documentation> 
        &lt;type>checkbox&lt;/type>    
        &lt;checkedValue>true&lt;/checkedValue> 
        &lt;uncheckedValue>false&lt;/uncheckedValue> 
        &lt;initiallyChecked>1&lt;/initiallyChecked> 
        &lt;value>true&lt;/value>    
    &lt;/formElement> 

    &lt;formElement> 
        &lt;label>Backup Groups&lt;/label>    
        &lt;property>exportGroups&lt;/property> 
        &lt;documentation>Boolean to export Groups&lt;/documentation> 
        &lt;type>checkbox&lt;/type>    
        &lt;checkedValue>true&lt;/checkedValue> 
        &lt;uncheckedValue>false&lt;/uncheckedValue> 
        &lt;initiallyChecked>1&lt;/initiallyChecked> 
        &lt;value>true&lt;/value>    
    &lt;/formElement> 

&lt;/editor></value>
        </property>
        <property>
          <propertyName>exposeToPlugin</propertyName>
          <description />
          <expandable>1</expandable>
          <value>1</value>
        </property>
      </propertySheet>
      <emailNotifier>
        <notifierName>failureNotification</notifierName>
        <condition>$[/javascript if(getProperty("outcome") == 'error')
    true;
else
    false;]</condition>
        <configName>default</configName>
        <description>Send email to Admin if it fails</description>
        <destinations>$[/users/admin/email]</destinations>
        <eventType>onCompletion</eventType>
        <formattingTemplate>Subject: Job  '$[jobName]'  from procedure  '$[procedureName]'  $[/myEvent/type]  - Commander notification

$[/server/ec_notifierTemplates/Html_JobTempl/body]</formattingTemplate>
        <propertySheet>
        </propertySheet>
      </emailNotifier>
      <formalParameter>
        <formalParameterName>exportGroups</formalParameterName>
        <defaultValue>true</defaultValue>
        <description />
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>checkbox</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>exportResourcePools</formalParameterName>
        <defaultValue>true</defaultValue>
        <description />
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>checkbox</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>exportResources</formalParameterName>
        <defaultValue>true</defaultValue>
        <description />
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>checkbox</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>exportUsers</formalParameterName>
        <defaultValue>true</defaultValue>
        <description />
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>checkbox</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>exportWorkspaces</formalParameterName>
        <defaultValue>true</defaultValue>
        <description />
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>checkbox</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>pathname</formalParameterName>
        <defaultValue>/tmp/BACKUP</defaultValue>
        <description>Directory where to saved the XML files</description>
        <expansionDeferred>0</expansionDeferred>
        <required>1</required>
        <type>entry</type>
      </formalParameter>
      <step>
        <stepName>saveProjectsProceduresWorkflows</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>#############################################################################
#
#  Copyright 2013 Electric-Cloud Inc.
#
#############################################################################
use File::Path;

$[/myProject/scripts/perlHeaderJSON]

$DEBUG=1;

# Parameters
#
my $path="$[pathname]";

my $errorCount=0;
my $projCount=0;
my $procCount=0;
my $wkfCount=0;
my $newtimeout=600;

# Set the time out to newtimeout so the ec commands won't time out at 3 mins
$ec->setTimeout($newtimeout);

# Get list of Project
my ($success, $xPath) = InvokeCommander("SuppressLog", "getProjects");

# Create the Projects directory
mkpath("$path/Projects");
chmod(0777, "$path/Projects");

foreach my $node ($xPath->findnodes('//project')) {
  my $pName=$node->{'projectName'};
  my $pluginName=$node->{'pluginName',};

  # skip plugins  
  next if ($pluginName ne "");
  printf("Saving Project: %s\n", $pName);
  my $fileProjectName=safeFilename($pName);
  mkpath("$path/Projects/$fileProjectName");
  chmod(0777, "$path/Projects/$fileProjectName");
  
  my ($success, $res, $errMsg, $errCode) = 
      InvokeCommander("SuppressLog", "export", "$path/Projects/$fileProjectName/$fileProjectName".".xml",
  					{ 'path'=> "/projects/".$pName, 
                                          'relocatable' => 1,
                                          'withAcls'    => 1,
                                          'withNotifiers'=>1});
  if (! $success) {
    printf("  Error exporting %s", $pName);
    printf("  %s: %s\n", $errCode, $errMsg);
    $errorCount++;
  } else {
    $projCount++;
  }
  #
  # Save procedures
  #
  mkpath("$path/Projects/$fileProjectName/Procedures");
  chmod(0777, "$path/Projects/$fileProjectName/Procedures");
  
  my ($success, $xPath) = InvokeCommander("SuppressLog", "getProcedures", $pName);
  foreach my $proc ($xPath->findnodes('//procedure')) {
    my $procName=$proc->{'procedureName'};
    my $fileProcedureName=safeFilename($procName);
    printf("  Saving Procedure: %s\n", $procName);
 
 	my ($success, $res, $errMsg, $errCode) = 
      InvokeCommander("SuppressLog", "export", "$path/Projects/$fileProjectName/Procedures/$fileProcedureName".".xml",
  					{ 'path'=> "/projects/$pName/procedures/$procName", 
                                          'relocatable' => 1,
                                          'withAcls'    => 1,
                                          'withNotifiers'=>1});
    
    if (! $success) {
      printf("  Error exporting %s", $procName);
      printf("  %s: %s\n", $errCode, $errMsg);
      $errorCount++;
    }
    else {
      $procCount++;
    }
  }

  #
  # Save workflow definitions
  #
  mkpath("$path/Projects/$fileProjectName/Workflows");
  chmod(0777, "$path/Projects/$fileProjectName/Workflows");
  
  my ($success, $xPath) = InvokeCommander("SuppressLog", "getWorkflowDefinitions", $pName);
  foreach my $proc ($xPath->findnodes('//workflowDefinition')) {
    my $wkfName=$proc->{'workflowDefinitionName'};
    my $fileWkfName=safeFilename($wkfName);
    printf("  Saving Workflow Definition: %s\n", $wkfName);
    
    my ($success, $res, $errMsg, $errCode) = 
      InvokeCommander("SuppressLog", "export", "$path/Projects/$fileProjectName/Workflows/$fileWkfName".".xml",
  					{ 'path'=> "/projects/$pName/workflowDefinitions/$wkfName", 
                                          'relocatable' => 1,
                                          'withAcls'    => 1,
                                          'withNotifiers'=>1});
    
    if (! $success) {
      printf("  Error exporting %s", $wkfName);
      printf("  %s: %s\n", $errCode, $errMsg);
      $errorCount++;
    }
    else {
      $wkfCount++;
    }
  }

}
$ec->setProperty("preSummary", "$projCount projects exported\n  $procCount procedures exported\n  $wkfCount workflows exported");
exit($errorCount);

#
# Make the name of an object safe to be a file or directory name
#
sub safeFilename {
  my $safe=@_[0];
  $safe =~ s#[\*\.\"/\[\]\\:;,=\|]#_#g;
  return $safe;
}


$[/myProject/scripts/perlLibJSON]

</command>
        <condition />
        <description>A step to export each project and procedure individually

Changelog:
2014-02-27 Kate McCormack
  Adding setTimeout equal to 600 so the ec commands won't time out
</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>saveResources</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>#############################################################################
#
#  Copyright 2013 Electric-Cloud Inc.
#
#############################################################################
use File::Path;

$[/myProject/scripts/perlHeaderJSON]

$DEBUG=1;

# Parameters
#
my $path="$[pathname]";

my $errorCount=0;
my $resCount=0;

# Get list of Project
my ($success, $xPath) = InvokeCommander("SuppressLog", "getResources");

# Create the Resources directory
mkpath("$path/Resources");
chmod(0777, "$path/Resources");

foreach my $node ($xPath->findnodes('//resource')) {
  my $resName=$node->{'resourceName'};

  printf("Saving Resource: %s\n", $resName);
  my $fileResourceName=safeFilename($resName); 
  
  my ($success, $res, $errMsg, $errCode) = 
      InvokeCommander("SuppressLog", "export", "$path/Resources/$fileResourceName".".xml",
  					{ 'path'=> "/resources/".$resName, 
                                          'relocatable' => 1,
                                          'withAcls'    => 1});
  if (! $success) {
    printf("  Error exporting %s", $resName);
    printf("  %s: %s\n", $errCode, $errMsg);
    $errorCount++;
  } else {
    $resCount++;
  }
}
$ec->setProperty("preSummary", "$resCount resources exported");
exit($errorCount);

#
# Make the name of an object safe to be a file or directory name
#
sub safeFilename {
  my $safe=@_[0];
  $safe =~ s#[\*\.\"/\[\]\\:;,=\|]#_#g;
  return $safe;
}


$[/myProject/scripts/perlLibJSON]

</command>
        <condition>$[exportResources]</condition>
        <description />
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>saveResourcePools</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>#############################################################################
#
#  Copyright 2013 Electric-Cloud Inc.
#
#############################################################################
use File::Path;

$[/myProject/scripts/perlHeaderJSON]

$DEBUG=1;

# Parameters
#
my $path="$[pathname]";

my $errorCount=0;
my $poolCount=0;

# Get list of Project
my ($success, $xPath) = InvokeCommander("SuppressLog", "getResourcePools");

# Create the Resources directory
mkpath("$path/Pools");
chmod(0777, "$path/Pools");

foreach my $node ($xPath->findnodes('//resourcePool')) {
  my $poolName=$node->{'resourcePoolName'};

  printf("Saving Resource Pool: %s\n", $poolName);
  my $filePoolName=safeFilename($poolName);
  
  my ($success, $res, $errMsg, $errCode) = 
      InvokeCommander("SuppressLog", "export", "$path/Pools/$filePoolName".".xml",
  					{ 'path'=> "/resourcePools/".$poolName, 
                                          'relocatable' => 1,
                                          'withAcls'    => 1});
  if (! $success) {
    printf("  Error exporting %s", $poolName);
    printf("  %s: %s\n", $errCode, $errMsg);
    $errorCount++;
  } else {
	$poolCount++;
  }  
}

$ec->setProperty("preSummary", "$poolCount pools exported");
exit($errorCount);

#
# Make the name of an object safe to be a file or directory name
#
sub safeFilename {
  my $safe=@_[0];
  $safe =~ s#[\*\.\"/\[\]\\:;,=\|]#_#g;
  return $safe;
}


$[/myProject/scripts/perlLibJSON]

</command>
        <condition>$[exportResourcePools]</condition>
        <description />
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>saveWorkspaces</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>#############################################################################
#
#  Copyright 2013 Electric-Cloud Inc.
#
#############################################################################
use File::Path;

$[/myProject/scripts/perlHeaderJSON]

# Parameters
#
my $path="$[pathname]";

my $errorCount=0;
my $wksCount=0;

# Get list of Project
my ($success, $xPath) = InvokeCommander("SuppressLog", "getWorkspaces");

# Create the Workspaces directory
mkpath("$path/Workspaces");
chmod(0777, "$path/Workspaces");

foreach my $node ($xPath->findnodes('//workspace')) {
  my $resName=$node->{'workspaceName'};

  printf("Saving Workspace: %s\n", $resName);
  my $fileWorkspaceName=safeFilename($resName); 
  
  my ($success, $res, $errMsg, $errCode) = 
      InvokeCommander("SuppressLog", "export", "$path/Workspaces/$fileWorkspaceName".".xml",
  					{ 'path'=> "/workspaces/".$resName, 
                                          'relocatable' => 1,
                                          'withAcls'    => 1});
  if (! $success) {
    printf("  Error exporting %s", $resName);
    printf("  %s: %s\n", $errCode, $errMsg);
    $errorCount++;
  } else {
    $wksCount++;
  }
}
$ec->setProperty("preSummary", "$wksCount workspaces exported");
exit($errorCount);

#
# Make the name of an object safe to be a file or directory name
#
sub safeFilename {
  my $safe=@_[0];
  $safe =~ s#[\*\.\"/\[\]\\:;,=\|]#_#g;
  return $safe;
}


$[/myProject/scripts/perlLibJSON]

</command>
        <condition>$[exportWorkspaces]</condition>
        <description />
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>saveUsers</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>#############################################################################
#
#  Copyright 2013 Electric-Cloud Inc.
#
#############################################################################
use File::Path;

$[/myProject/scripts/perlHeaderJSON]

$DEBUG=1;

# Parameters
#
my $path="$[pathname]";

my $errorCount=0;
my $userCount=0;

# Get list of Project
my ($success, $xPath) = InvokeCommander("SuppressLog", "getUsers", {maximum=>5000});

# Create the Resources directory
mkpath("$path/Users");
chmod(0777, "$path/Users");

foreach my $node ($xPath->findnodes('//user')) {
  my $userName=$node->{'userName'};

  printf("Saving User: %s\n", $userName);
  my $fileUserName=safeFilename($userName); 
  
  my ($success, $res, $errMsg, $errCode) = 
      InvokeCommander("SuppressLog", "export", "$path/Users/$fileUserName".".xml",
  					{ 'path'=> "/users/".$userName, 
                                          'relocatable' => 1,
                                          'withAcls'    => 1});
  if (! $success) {
    printf("  Error exporting %s", $userName);
    printf("  %s: %s\n", $errCode, $errMsg);
    $errorCount++;
  } else {
    $userCount++;
  }
}
$ec->setProperty("preSummary", "$userCount users exported");
exit($errorCount);

#
# Make the name of an object safe to be a file or directory name
#
sub safeFilename {
  my $safe=@_[0];
  $safe =~ s#[\*\.\"/\[\]\\:;,=\|]#_#g;
  return $safe;
}


$[/myProject/scripts/perlLibJSON]

</command>
        <condition>$[exportUsers]</condition>
        <description />
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>saveGroups</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>#############################################################################
#
#  Copyright 2013 Electric-Cloud Inc.
#
#############################################################################
use File::Path;

$[/myProject/scripts/perlHeaderJSON]

$DEBUG=1;

# Parameters
#
my $path="$[pathname]";

my $errorCount=0;
my $groupCount=0;

# Get list of Project
my ($success, $xPath) = InvokeCommander("SuppressLog", "getGroups", {maximum=>5000});

# Create the Resources directory
mkpath("$path/groups");
chmod(0777, "$path/groups");

foreach my $node ($xPath->findnodes('//group')) {
  my $groupName=$node->{'groupName'};

  printf("Saving group: %s\n", $groupName);
  my $fileGroupName=safeFilename($groupName); 
  
  my ($success, $res, $errMsg, $errCode) = 
      InvokeCommander("SuppressLog", "export", "$path/groups/$fileGroupName".".xml",
  					{ 'path'=> "/groups/".$groupName, 
                                          'relocatable' => 1,
                                          'withAcls'    => 1});
  if (! $success) {
    printf("  Error exporting %s", $groupName);
    printf("  %s: %s\n", $errCode, $errMsg);
    $errorCount++;
  } else {
    $groupCount++;
  }
}
$ec->setProperty("preSummary", "$groupCount groups exported");
exit($errorCount);

#
# Make the name of an object safe to be a file or directory name
#
sub safeFilename {
  my $safe=@_[0];
  $safe =~ s#[\*\.\"/\[\]\\:;,=\|]#_#g;
  return $safe;
}


$[/myProject/scripts/perlLibJSON]

</command>
        <condition>$[exportGroups]</condition>
        <description />
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
    </procedure>
    <procedure>
      <procedureName>saveProjects</procedureName>
      <description>a framework to export projects.</description>
      <jobNameTemplate>$[/myProject/scripts/jobTemplate]</jobNameTemplate>
      <resourceName />
      <timeLimit />
      <timeLimitUnits>minutes</timeLimitUnits>
      <workspaceName />
      <propertySheet>
        <property>
          <propertyName>ec_customEditorData</propertyName>
          <propertySheet>
            <property>
              <propertyName>parameters</propertyName>
              <propertySheet>
                <property>
                  <propertyName>includeACLs</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>true</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>0</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>false</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>includeNotifiers</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>true</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>0</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>false</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>pathname</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>relocatable</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>true</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>1</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>false</value>
                    </property>
                  </propertySheet>
                </property>
              </propertySheet>
            </property>
          </propertySheet>
        </property>
        <property>
          <propertyName>ec_parameterForm</propertyName>
          <description>To overwrite default parameter panel display</description>
          <expandable>1</expandable>
          <value>&lt;editor> 
    &lt;formElement> 
        &lt;label>Backup directory&lt;/label>	
        &lt;property>pathname&lt;/property>	
        &lt;documentation>Directory where to saved the XML files.&lt;/documentation> 
        &lt;type>entry&lt;/type>	
        &lt;value>/tmp&lt;/value> 
	    &lt;required>1&lt;/required> 
    &lt;/formElement> 
    &lt;formElement> 
        &lt;label>Relocatable&lt;/label>	
        &lt;property>relocatable&lt;/property> 
        &lt;documentation>If set to "true", the export will not include object IDs, ACLs, system property sheets, create/modify times, owners, 
email notifiers or lastModifiedBy information, and the export file result will be much smaller than a normal export.&lt;/documentation> 
        &lt;type>checkbox&lt;/type>	
        &lt;checkedValue>true&lt;/checkedValue> 
        &lt;uncheckedValue>false&lt;/uncheckedValue> 
        &lt;initiallyChecked>1&lt;/initiallyChecked> 
        &lt;value>true&lt;/value>	
    &lt;/formElement> 
    &lt;formElement> 
        &lt;label>ACLs&lt;/label>	
        &lt;property>includeACLs&lt;/property> 
        &lt;documentation>If set to "true", the export will include ACLs.&lt;/documentation> 
        &lt;type>checkbox&lt;/type>	
        &lt;checkedValue>true&lt;/checkedValue> 
        &lt;uncheckedValue>false&lt;/uncheckedValue> 
        &lt;initiallyChecked>0&lt;/initiallyChecked> 
        &lt;value>false&lt;/value>	
    &lt;/formElement> 
    &lt;formElement> 
        &lt;label>Notifiers&lt;/label>	
        &lt;property>includeNotifiers&lt;/property> 
        &lt;documentation>If set to "true", the export will include email notifiers.&lt;/documentation> 
        &lt;type>checkbox&lt;/type>	
        &lt;checkedValue>true&lt;/checkedValue> 
        &lt;uncheckedValue>false&lt;/uncheckedValue> 
        &lt;initiallyChecked>0&lt;/initiallyChecked> 
        &lt;value>false&lt;/value>	
    &lt;/formElement> 
&lt;/editor> </value>
        </property>
        <property>
          <propertyName>exposeToPlugin</propertyName>
          <description>So the procedure is shown in the pickerList</description>
          <expandable>1</expandable>
          <value>1</value>
        </property>
      </propertySheet>
      <emailNotifier>
        <notifierName>backupFailed</notifierName>
        <condition>$[/javascript if(getProperty("outcome") == 'error')
    true;
else
    false;]</condition>
        <configName>ecloud</configName>
        <description />
        <destinations>$[/users/admin/email]</destinations>
        <eventType>onCompletion</eventType>
        <formattingTemplate>Subject:Project Backup Failed
Job  '$[jobName]'  from procedure  '$[procedureName]'  $[/myEvent/type]  - Commander notification

$[/server/ec_notifierTemplates/Html_JobTempl/body]</formattingTemplate>
        <propertySheet>
        </propertySheet>
      </emailNotifier>
      <formalParameter>
        <formalParameterName>includeACLs</formalParameterName>
        <defaultValue>false</defaultValue>
        <description> if set to "true", the export will include ACLs.</description>
        <expansionDeferred>0</expansionDeferred>
        <required>1</required>
        <type>checkbox</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>includeNotifiers</formalParameterName>
        <defaultValue>false</defaultValue>
        <description> If  set to "true", the export will include email notifiers.</description>
        <expansionDeferred>0</expansionDeferred>
        <required>1</required>
        <type>checkbox</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>pathname</formalParameterName>
        <defaultValue>/tmp</defaultValue>
        <description>Directory where to saved the XML files</description>
        <expansionDeferred>0</expansionDeferred>
        <required>1</required>
        <type>entry</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>relocatable</formalParameterName>
        <defaultValue>true</defaultValue>
        <description>If set to "true", the export will not include object IDs, ACLs, system property sheets, create/modify times, owners, email notifiers or lastModifiedBy information, and the export file result will be much smaller than a normal export.</description>
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>checkbox</type>
      </formalParameter>
      <step>
        <stepName>save Projects</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>#############################################################################
#
#  Copyright 2013 Electric-Cloud Inc.
#
#############################################################################
use File::Path;

$[/myProject/scripts/perlHeader]
$[/myProject/scripts/perlLib]
#
# Parameters
#
my $path="$[pathname]";
my $includeACLs="$[includeACLs]";
my $includeNotifiers="$[includeNotifiers]";
my $relocatable="$[relocatable]";
my $newtimeout=600;

# Set the time out to newtimeout so the ec commands won't time out at 3 mins
$ec->setTimeout($newtimeout);

my $errorCount=0;
# Get list of Project
my ($success, $xPath) = InvokeCommander("SuppressLog", "getProjects");

# Create the directory
# chmod required for cases when the server agent user and the server user 
# are different and the mask prevent the created directory to be written
# by the latter.
mkpath($path);
chmod 0777, $path;

my $nodeset = $xPath->find('//project');
foreach my $node ($nodeset->get_nodelist) {
  my $pName=$xPath->findvalue('projectName', $node);
  my $pluginName=$xPath->findvalue('pluginName', $node);

  # skip plugins  
  next if ($pluginName ne "");
  printf("Saving Project: %s\n", $pName);
  my ($success, $xPath, $errMsg, $errCode) = InvokeCommander("SuppressLog", "export", $path."/$pName".".xml",
  					{ 'path'=> "/projects/".$pName, 
                                          'relocatable' => $relocatable,
                                          'withAcls'    => $includeACLs,
                                          'withNotifiers'=>$includeNotifiers});
  if (! $success) {
    printf("  Error exporting %s", $pName);
    printf("  %s: %s\n", $errCode, $errMsg);
    $errorCount++;
  }
}
exit($errorCount);

</command>
        <condition />
        <description>A procedure to export each project individually into a XML file for backup

Changelog:
2014-02-27 Kate McCormack
  Adding setTimeout equal to 600 so the ec commands won't time out
2013-12-17 Laurent Rochette
  Add chmod after directory creation for cases when server service and 
      server agent service user are different.
2013-07-28 Laurent Rochette
  Add parameters to include or not ACLs and email notifiers</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
    </procedure>
    <procedure>
      <procedureName>subPM-deploymentSize</procedureName>
      <description>a couple of steps to size your ElectricCommander instllation

Number per
 Implementation	     Small	Medium	Large
---------------------------------------------------------
Agents	                      &lt;50	   >50	>1000
Projects	                      &lt;10	   &lt;100	>100
Jobs Per Day	              &lt;200	   >200	>1000
Managed Resources      &lt;100   &lt;1000	>1000
</description>
      <jobNameTemplate>$[/myProject/scripts/jobTemplate]</jobNameTemplate>
      <resourceName />
      <timeLimit />
      <timeLimitUnits>minutes</timeLimitUnits>
      <workspaceName />
      <propertySheet>
      </propertySheet>
      <step>
        <stepName>agents</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>$[/myProject/scripts/perlHeaderJSON]

################################################################################
#
# GLobal variables
#
################################################################################
my $SMALL=50;
my $LARGE=1000;
my $nbAgents;
my $size;
my %hAg;

my ($ok, $json)=InvokeCommander("SuppressLog", 'getResources');

#
# Loop over resources to extract unique hostnames
#
foreach my $node ($json->findnodes('//resource')){
	printf("Processing %s\n", $node->{hostName});
    $hAg{lc($node->{hostName})}=1;
}

$nbAgents=scalar(keys(%hAg));
if ($nbAgents &lt; $SMALL) {
	$size="SMALL";
} elsif ($nbAgents > $LARGE) {
	$size="LARGE";
} else {
	$size="MEDIUM";
}
$ec->setProperty("summary", "$size: $nbAgents agents");
$ec->setProperty("/myJob/PM-numberOfAgents", $nbAgents);

$[/myProject/scripts/perlLibJSON]

</command>
        <condition />
        <description>Number per 
Implementation	Small	Medium	Large
-------------------------------------------------------
Agents	                &lt;50	          >50	 >1000
</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>managedResources</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>$[/myProject/scripts/perlHeaderJSON]

################################################################################
#
# GLobal variables
#
################################################################################
my $SMALL=100;
my $LARGE=1000;

my ($ok, $json)=InvokeCommander("SuppressLog", 'getResources');
my $nbResources=scalar ($json->findnodes('//resource'));

my $size;
if ($nbResources &lt; $SMALL) {
	$size="SMALL";
} elsif ($nbResources > $LARGE) {
	$size="LARGE";
} else {
	$size="MEDIUM";
}
$ec->setProperty("summary", "$size: $nbResources resources");
$ec->setProperty("/myJob/PM-numberOfResources", $nbResources);

$[/myProject/scripts/perlLibJSON]

</command>
        <condition />
        <description>Number per 
Implementation	Small	Medium	Large
-------------------------------------------------------
Agents	                &lt;100	&lt;1000	 >1000
</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>projects</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>$[/myProject/scripts/perlHeaderJSON]

################################################################################
#
# GLobal variables
#
################################################################################
my $SMALL=10;
my $LARGE=100;
my $size;
my $nb=0;

my ($ok, $json)=InvokeCommander("SuppressLog", 'getProjects');
foreach my $node ($json->findnodes('//project')) {
    # Skip plugins
    next if ($node->{pluginName});
	my $name=$node->{projectName};
    printf("Processing %s\n", $name);
	$nb++;
}


if ($nb &lt; $SMALL) {
	$size="SMALL";
} elsif ($nb > $LARGE) {
	$size="LARGE";
} else {
	$size="MEDIUM";
}
$ec->setProperty("summary", "$size: $nb projects");
$ec->setProperty("/myJob/PM-numberOfProjects", $nb);

$[/myProject/scripts/perlLibJSON]

</command>
        <condition />
        <description>Number per 
Implementation	Small	Medium	Large
-------------------------------------------------------
Agents	                &lt;10   	&lt;100	 >100
</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>jobsPerDay</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>$[/myProject/scripts/perlHeaderJSON]

use DateTime;

################################################################################
#
# GLobal variables
#
################################################################################
my $SMALL=100;
my $LARGE=1000;
my $size;
my $nbDays=7;		# check over the last 7 days only
my $count=0;		# total number of jobs
my $nb=1.0;
my $MAXJOBS=7000;
my $now="$[/timestamp yyyy-MM-dd]" . "T00:00:00.000Z";
my $weekAgo=calculateDate($nbDays);

printf("Now: $now\n");
printf("1 week: $weekAgo\n");

# create filterList
my @filterList;
# only finished jobs
push (@filterList, {"propertyName" => "status",
                    "operator" => "equals",
                    "operand1" => "completed"});
# newer than
push (@filterList, {"propertyName" => "start",
                    "operator" => "greaterOrEqual",
                    "operand1" => $weekAgo});
# older than today midnight
push (@filterList, {"propertyName" => "start",
                    "operator" => "lessThan",
                    "operand1" => $now});

my ($ok, $json)=InvokeCommander("SuppressLog", 'findObjects', 'job',
									{maxIds => $MAXJOBS, 
                                     numObjects => $MAXJOBS,
                                     filter => \@filterList}
								);
$count=scalar($json->findnodes('//job'));
$nb=$count/$nbDays;

printf("Count: %d\n", $count);
printf("Average: %3.1f\n", $nb);
if ($nb &lt; $SMALL) {
	$size="SMALL";
} elsif ($nb > $LARGE) {
	$size="LARGE";
} else {
	$size="MEDIUM";
}
$ec->setProperty("summary", sprintf("$size: %.1f jobs per day", $nb));
$ec->setProperty("/myJob/PM-numberOfJobsPerDay", sprintf("%.1f", $nb));

exit(0);


#############################################################################
#
#  Return the day/time at midnight X days back
#
#############################################################################
sub calculateDate {
    my $nbDays=shift;
    my $string=DateTime->now()->subtract(days => $nbDays)->iso8601();
    $string =~ s/(\d{4}-\d{1,2}-\d{1,2})T.*/$1/;
    $string .= "T00:00:00.000Z";
    return $string;
}


$[/myProject/scripts/perlLibJSON]

</command>
        <condition />
        <description>Number per 
Implementation	Small	Medium	Large
-------------------------------------------------------
jobs  	                &lt;100	&lt;1000	 >1000
</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
    </procedure>
    <procedure>
      <procedureName>subPM-localUsage</procedureName>
      <description />
      <jobNameTemplate>$[/myProject/scripts/jobTemplate]</jobNameTemplate>
      <resourceName />
      <timeLimit />
      <timeLimitUnits>minutes</timeLimitUnits>
      <workspaceName />
      <propertySheet>
        <property>
          <propertyName>ec_customEditorData</propertyName>
          <propertySheet>
            <property>
              <propertyName>parameters</propertyName>
              <propertySheet>
                <property>
                  <propertyName>debugMode</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>1</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>0</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>0</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>number</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
              </propertySheet>
            </property>
          </propertySheet>
        </property>
      </propertySheet>
      <formalParameter>
        <formalParameterName>debugMode</formalParameterName>
        <defaultValue>0</defaultValue>
        <description>debug mode</description>
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>checkbox</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>number</formalParameterName>
        <defaultValue>1000</defaultValue>
        <description>Number of jobSteps to evaluate</description>
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>entry</type>
      </formalParameter>
      <step>
        <stepName>localUsage</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>#############################################################################
#
#  findSteps -- Script to find steps and figure out where they run
#  Copyright 2014 Electric-Cloud Inc.
#
#############################################################################

$[/myProject/scripts/perlHeaderJSON]

#############################################################################
#
#  Assign Commander parameters to variables
#
#############################################################################
my $totalJobs= $[number];
$DEBUG=$[debugMode];

#############################################################################
#
#  Global Variables
#
#############################################################################
my $totalTime=0;
my $localTime=0;
my $totalSteps=0;
my $localSteps=0;

my $serverName=lc("$[/server/hostName]");
my $serverIP="$[/server/hostIP]";

# create filterList
my @filterList;
# only finished jobSteps
push (@filterList, {"propertyName" => "status",
                    "operator" => "equals",
                    "operand1" => "completed"});

#
# get newest first
my ($ok, $res)= InvokeCommander("SuppressLog", "findObjects", "jobStep",
                                 {numObjects => $totalJobs,
                                  filter => \@filterList,
                                  sort => [ {propertyName => "finish",
                                                    order => "descending"} ]
                                 }
                                );
foreach my $step ($res->findnodes('//jobStep')) {
    	my $rtime=$step->{runTime};
        my $host=lc($step->{hostName});
        next if ($host eq "");
        $totalSteps++;
        $totalTime+=$rtime;
        if (($host eq "localhost") || ($host eq $serverName) || ($host eq $serverIP)){
          #printf("  Step %s (%d)\n", $step->{stepName}, $rtime)  if ($DEBUG);
          $localTime += $rtime;
          $localSteps ++;
        } else {
          printf("NOT LOCAL: $host  -> %s\n", $step->{stepName}) if ($DEBUG);
        }
}

printf("Job time spent on local: %d ms\n", $localTime);
printf("Total job time: %d ms\n", $totalTime);
my $percTime=$localTime*100/$totalTime;
printf("%.1f%% of job time spent on local\n\n", $percTime);

printf("Number of steps on local: %d\n", $localSteps);
printf("Total number of steps: %d\n", $totalSteps);
my $percSteps=$localSteps*100/$totalSteps;
printf("%.1f%% of steps spent on local\n", $percSteps);

$ec->setProperty("summary", sprintf("%03.1f%% time\n%03.1f%% steps", $percTime, $percSteps));
#
# Perl Commander library
$[/myProject/scripts/perlLibJSON]

</command>
        <condition />
        <description>A step to find out the percentage of steps and time spend running on local. Best practices call for jobs to run on remote agents
</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
    </procedure>
    <procedure>
      <procedureName>subPM-performance</procedureName>
      <description>This is a procedure to test resource performance</description>
      <jobNameTemplate />
      <resourceName />
      <timeLimit />
      <timeLimitUnits>minutes</timeLimitUnits>
      <workspaceName />
      <propertySheet>
        <property>
          <propertyName>ec_customEditorData</propertyName>
          <propertySheet>
            <property>
              <propertyName>parameters</propertyName>
              <propertySheet>
                <property>
                  <propertyName>hostName</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>resource</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
              </propertySheet>
            </property>
          </propertySheet>
        </property>
      </propertySheet>
      <formalParameter>
        <formalParameterName>hostname</formalParameterName>
        <defaultValue />
        <description>Name of the machine to test</description>
        <expansionDeferred>0</expansionDeferred>
        <required>1</required>
        <type>entry</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>resource</formalParameterName>
        <defaultValue />
        <description>Name of the resource</description>
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>entry</type>
      </formalParameter>
      <step>
        <stepName>performance</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>$[/myProject/performances/scripts/perf.pm]

#
# Parameters
#
my $hostname="$[hostname]";
my $resource="$[resource]";


my $start = time();
for (my $i=0; $i &lt; 4469134; $i++) {dec2bin(3);}
my $totalTime = time()-$start;

my $str=sprintf("%s: %d s\n", $hostname, $totalTime);
checkValue("PERF", $totalTime, $str);
exit(0);


# 2004
# Xah
# xah@xahlee.org
# http://xahlee.org/

# convert to/from binary
sub dec2bin {
  my $str = unpack ("B32", pack("N", shift ));
  $str =~ s@^0+(?=\d)@@; # otherwise you'll get leading zeros
  return $str;
}


</command>
        <condition />
        <description />
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName>$[resource]</resourceName>
        <shell>ec-perl</shell>
        <timeLimit>10</timeLimit>
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName>$[/javascript ("$[/resources/$[resource]/workspaceName]" == "")?"default": "$[/resources/$[resource]/workspaceName]"; ]</workspaceName>
        <propertySheet>
        </propertySheet>
      </step>
    </procedure>
    <procedure>
      <procedureName>subPM-ping</procedureName>
      <description>This is a procedure to test ping answer time</description>
      <jobNameTemplate />
      <resourceName />
      <timeLimit />
      <timeLimitUnits>minutes</timeLimitUnits>
      <workspaceName />
      <propertySheet>
        <property>
          <propertyName>ec_customEditorData</propertyName>
          <propertySheet>
            <property>
              <propertyName>parameters</propertyName>
              <propertySheet>
                <property>
                  <propertyName>hostName</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>resource</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
              </propertySheet>
            </property>
          </propertySheet>
        </property>
      </propertySheet>
      <formalParameter>
        <formalParameterName>hostname</formalParameterName>
        <defaultValue />
        <description>Name of the machine to test</description>
        <expansionDeferred>0</expansionDeferred>
        <required>1</required>
        <type>entry</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>resource</formalParameterName>
        <defaultValue />
        <description>Name of the resource</description>
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>entry</type>
      </formalParameter>
      <step>
        <stepName>ping</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>$[/myProject/performances/scripts/perf.pm]

#
# Parameters
#
my $hostname="$[hostname]";
my $resource="$[resource]";

#
# Global Variables
# 
my $pingCount=5;
my $avgPing=0;
my $result;
my $str;

if ($OSNAME eq "linux") {
  $result=`ping -c $pingCount -q $hostname | tail -1`;

  if ($result =~ /rtt/) {
    # rtt min/avg/max/mdev = 0.167/0.190/0.238/0.027 ms
    $result =~ m#[\d\.]+/([\d\.]+)/[\d\.]+/[\d\.]+#;
    $avgPing=$1;
  } elsif ($result =~ /unknown host/) {
    InvokeCommander("SuppressLog", "setProperty", "outcome", "warning");
    InvokeCommander("SuppressLog", "setProperty", "summary", "$hostname unknown");
    exit(2);
  } else {
    # unreachable host
    InvokeCommander("SuppressLog", "setProperty", "outcome", "warning");
    InvokeCommander("SuppressLog", "setProperty", "summary", "$hostname unreachable");
    exit(1);
  }
  $str=sprintf("%s: %4.3f ms\n", $hostname, $avgPing);
} else {   # Windows
  $result=`C:/Windows/system32/ping -n $pingCount $hostname`;
  
  if ($result =~ /Minimum/) {
    #  Minimum = 178ms, Maximum = 530ms, Average = 357ms
    $result =~ m/Average = (\d+)ms/;
    $avgPing=$1;
  } elsif ($result =~ /could not find host/) {
    InvokeCommander("SuppressLog", "setProperty", "outcome", "warning");
    InvokeCommander("SuppressLog", "setProperty", "summary", "$hostname unknown");
    exit(2);
  } else {
    # unreachable host
    InvokeCommander("SuppressLog", "setProperty", "outcome", "warning");
    InvokeCommander("SuppressLog", "setProperty", "summary", "$hostname unreachable");
    exit(1);
  }
  $str=sprintf("%s: %d ms\n", $hostname, $avgPing);
}

checkValue("PING", $avgPing, $str);

</command>
        <condition />
        <description />
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
    </procedure>
    <procedure>
      <procedureName>synchronizePlugins</procedureName>
      <description>A procedure to synchronize plugins between the server and a resource. Plugins are uploaded first as artifacts and downloaded on the resource if it does not already exist.</description>
      <jobNameTemplate />
      <resourceName />
      <timeLimit />
      <timeLimitUnits>minutes</timeLimitUnits>
      <workspaceName />
      <propertySheet>
        <property>
          <propertyName>ec_customEditorData</propertyName>
          <propertySheet>
            <property>
              <propertyName>parameters</propertyName>
              <propertySheet>
                <property>
                  <propertyName>agent</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
              </propertySheet>
            </property>
          </propertySheet>
        </property>
        <property>
          <propertyName>descriptionForPlugin</propertyName>
          <description />
          <expandable>1</expandable>
          <value>A procedure to synchronize plugins between the server and a resource. Plugins are uploaded first as artifacts and downloaded on the resource if it does not already exist.</value>
        </property>
        <property>
          <propertyName>exposeToPlugin</propertyName>
          <description />
          <expandable>1</expandable>
          <value>1</value>
        </property>
      </propertySheet>
      <formalParameter>
        <formalParameterName>agent</formalParameterName>
        <defaultValue />
        <description>Name of the resrouce where to synchronize the plugins</description>
        <expansionDeferred>0</expansionDeferred>
        <required>1</required>
        <type>entry</type>
      </formalParameter>
      <step>
        <stepName>uploadPlugins</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>#############################################################################
#
#  uploadPlugins -- upload all plugins in the Artifact Repository
#  Copyright 2014 Electric-Cloud Inc.
#
#############################################################################

$[/myProject/scripts/perlHeader]

#############################################################################
#
#  Global Variables
#
#############################################################################
my $nbPlugins=0;

my ($ok, $res)=InvokeCommander("SuppressLog", "getPlugins");
foreach my $node ($res->findnodes('//plugin') ){
	my $fullName=$node->findvalue('pluginName');
    my ($name, $version) = $fullName =~ m/([\w \-]+)-([\d\.]+)/;
    #my $version=$node->{pluginVersion};
    printf("Processing $name : $version\n");
    
	#
    # Is this plugin already imported in an Artifact Version
    #
	($ok)=InvokeCommander("SuppressLog IgnoreError", 'getArtifactVersion', "plugins:$name:$version");
    if ($ok) {
    	printf("\tAV already exist\n");
        next;    # Artifact already exist
    }
	#
    # Does the Artifact already exist?
    #
    ($ok)=InvokeCommander("SuppressLog IgnoreError", 'getArtifact', "plugins:$name");
    if (! $ok) {
    	InvokeCommander("SuppressLog", 'createArtifact',
    		{
            	groupId=>"plugins", artifactKey=>$name
    		}
    );
    }
    InvokeCommander("SuppressLog", 'publishArtifactVersion',
    		{
            	groupId=>"plugins", artifactKey=>$name,  version=>$version,
            	fromDirectory=>"$[/server/Electric Cloud/dataDirectory]/plugins/$name-$version"
    		}
    );
    $nbPlugins++;
}
$ec->setProperty("summary", "$nbPlugins plugins uploaded");

$[/myProject/scripts/perlLib]
</command>
        <condition />
        <description>upload all plugins in the artifact Repository</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
      <step>
        <stepName>downloadPlugins</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>#############################################################################
#
#  downloadPlugins -- Script to parse all plugins from the artifact
#      repository and retrieve the latest version in the plugin directory if
#      it's not already there
#  Copyright 2014 Electric-Cloud Inc.
#
#############################################################################
$[/myProject/scripts/perlHeader]

#############################################################################
#
#  Global Variables
#
#############################################################################
my $nbPlugins=0;

my ($ok, $res)=InvokeCommander("SuppressLog", "findObjects", 'artifact', 
	{ filter=> [
					{propertyName => 'groupId', operator=>"equals", operand1=>"plugins"}
               ]
    });
foreach my $node ($res->findnodes('//artifact')) {
	my $artName=$node->findvalue('artifactKey');
    printf("Processing $artName\n");
    
	#
    # What is the latest Version of this Artfact/plugin
    #
	my ($ok, $avRes)=InvokeCommander("SuppressLog", 'findArtifactVersions', 
    			{artifactName=>"plugins:$artName"}
            );
    my $version=$avRes->findvalue('//version');
    my $AVN=$avRes->findvalue('//artifactVersionName');
    printf("\tRetrieved $version\n");
    
    if (-d "$[/server/Electric Cloud/dataDirectory]/plugins/$artName-$version") {
    	printf("\tplugins already exists\n");
        next;    # Plugin already exists
    } else {
	#
    # Retrieve the plugin
    #
    	$ec->retrieveArtifactVersions(
    		{
            	artifactVersionName => $AVN,
            	toDirectory => "$[/server/Electric Cloud/dataDirectory]/plugins/$artName-$version",
                overwrite => 'true'
    		}
    	);
        printf("\tDownloaded\n");
        $nbPlugins++;
    }
}
$ec->setProperty("summary", "$nbPlugins plugins downloaded");

$[/myProject/scripts/perlLib]
</command>
        <condition />
        <description>Parse all plugins:.... artifact and retrieve the latest version in the plugin directory if it's not already there</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName>$[agent]</resourceName>
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
    </procedure>
    <procedure>
      <procedureName>workflowCleanup</procedureName>
      <description>Delete workflows older than a number of days.
Report the number of workflows.</description>
      <jobNameTemplate>$[/myProject/scripts/jobTemplate]</jobNameTemplate>
      <resourceName>local</resourceName>
      <timeLimit />
      <timeLimitUnits>minutes</timeLimitUnits>
      <workspaceName />
      <propertySheet>
        <property>
          <propertyName>ec_customEditorData</propertyName>
          <propertySheet>
            <property>
              <propertyName>parameters</propertyName>
              <propertySheet>
                <property>
                  <propertyName>delete Aborted Jobs</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>true</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>1</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>false</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>delete Error Jobs</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>true</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>1</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>false</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>delete Successful Jobs</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>true</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>0</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>false</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>deleteAbortedJobs</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>true</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>1</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>false</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>executeDeletion</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>options</propertyName>
                      <propertySheet>
                        <property>
                          <propertyName>option1</propertyName>
                          <propertySheet>
                            <property>
                              <propertyName>text</propertyName>
                              <expandable>1</expandable>
                              <value>Report</value>
                            </property>
                            <property>
                              <propertyName>value</propertyName>
                              <expandable>1</expandable>
                              <value>false</value>
                            </property>
                          </propertySheet>
                        </property>
                        <property>
                          <propertyName>option2</propertyName>
                          <propertySheet>
                            <property>
                              <propertyName>text</propertyName>
                              <expandable>1</expandable>
                              <value>Delete</value>
                            </property>
                            <property>
                              <propertyName>value</propertyName>
                              <expandable>1</expandable>
                              <value>true</value>
                            </property>
                          </propertySheet>
                        </property>
                        <property>
                          <propertyName>optionCount</propertyName>
                          <expandable>1</expandable>
                          <value>2</value>
                        </property>
                        <property>
                          <propertyName>type</propertyName>
                          <expandable>1</expandable>
                          <value>list</value>
                        </property>
                      </propertySheet>
                    </property>
                    <property>
                      <propertyName>checkedValue</propertyName>
                      <expandable>1</expandable>
                      <value>true</value>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                    <property>
                      <propertyName>initiallyChecked</propertyName>
                      <expandable>1</expandable>
                      <value>0</value>
                    </property>
                    <property>
                      <propertyName>uncheckedValue</propertyName>
                      <expandable>1</expandable>
                      <value>false</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>jobLevel</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>options</propertyName>
                      <propertySheet>
                        <property>
                          <propertyName>option1</propertyName>
                          <propertySheet>
                            <property>
                              <propertyName>text</propertyName>
                              <expandable>1</expandable>
                              <value>Aborted</value>
                            </property>
                            <property>
                              <propertyName>value</propertyName>
                              <expandable>1</expandable>
                              <value>Aborted</value>
                            </property>
                          </propertySheet>
                        </property>
                        <property>
                          <propertyName>option2</propertyName>
                          <propertySheet>
                            <property>
                              <propertyName>text</propertyName>
                              <expandable>1</expandable>
                              <value>Error &amp; Aborted</value>
                            </property>
                            <property>
                              <propertyName>value</propertyName>
                              <expandable>1</expandable>
                              <value>Error</value>
                            </property>
                          </propertySheet>
                        </property>
                        <property>
                          <propertyName>option3</propertyName>
                          <propertySheet>
                            <property>
                              <propertyName>text</propertyName>
                              <expandable>1</expandable>
                              <value>All</value>
                            </property>
                            <property>
                              <propertyName>value</propertyName>
                              <expandable>1</expandable>
                              <value>All</value>
                            </property>
                          </propertySheet>
                        </property>
                        <property>
                          <propertyName>optionCount</propertyName>
                          <expandable>1</expandable>
                          <value>3</value>
                        </property>
                        <property>
                          <propertyName>type</propertyName>
                          <expandable>1</expandable>
                          <value>list</value>
                        </property>
                      </propertySheet>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>jobPatternMatching</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>jobProperty</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>olderThan</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>options</propertyName>
                      <propertySheet>
                        <property>
                          <propertyName>option1</propertyName>
                          <propertySheet>
                            <property>
                              <propertyName>text</propertyName>
                              <expandable>1</expandable>
                              <value>1 month</value>
                            </property>
                            <property>
                              <propertyName>value</propertyName>
                              <expandable>1</expandable>
                              <value>30</value>
                            </property>
                          </propertySheet>
                        </property>
                        <property>
                          <propertyName>option2</propertyName>
                          <propertySheet>
                            <property>
                              <propertyName>text</propertyName>
                              <expandable>1</expandable>
                              <value>2 months</value>
                            </property>
                            <property>
                              <propertyName>value</propertyName>
                              <expandable>1</expandable>
                              <value>60</value>
                            </property>
                          </propertySheet>
                        </property>
                        <property>
                          <propertyName>option3</propertyName>
                          <propertySheet>
                            <property>
                              <propertyName>text</propertyName>
                              <expandable>1</expandable>
                              <value>3 months</value>
                            </property>
                            <property>
                              <propertyName>value</propertyName>
                              <expandable>1</expandable>
                              <value>91</value>
                            </property>
                          </propertySheet>
                        </property>
                        <property>
                          <propertyName>option4</propertyName>
                          <propertySheet>
                            <property>
                              <propertyName>text</propertyName>
                              <expandable>1</expandable>
                              <value>6 months</value>
                            </property>
                            <property>
                              <propertyName>value</propertyName>
                              <expandable>1</expandable>
                              <value>182</value>
                            </property>
                          </propertySheet>
                        </property>
                        <property>
                          <propertyName>option5</propertyName>
                          <propertySheet>
                            <property>
                              <propertyName>text</propertyName>
                              <expandable>1</expandable>
                              <value>1 year</value>
                            </property>
                            <property>
                              <propertyName>value</propertyName>
                              <expandable>1</expandable>
                              <value>365</value>
                            </property>
                          </propertySheet>
                        </property>
                        <property>
                          <propertyName>optionCount</propertyName>
                          <expandable>1</expandable>
                          <value>5</value>
                        </property>
                        <property>
                          <propertyName>type</propertyName>
                          <expandable>1</expandable>
                          <value>list</value>
                        </property>
                      </propertySheet>
                    </property>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>wkfPatternMatching</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
                <property>
                  <propertyName>wkfProperty</propertyName>
                  <propertySheet>
                    <property>
                      <propertyName>formType</propertyName>
                      <expandable>1</expandable>
                      <value>standard</value>
                    </property>
                  </propertySheet>
                </property>
              </propertySheet>
            </property>
          </propertySheet>
        </property>
        <property>
          <propertyName>ec_parameterForm</propertyName>
          <description>Redefine UI</description>
          <expandable>1</expandable>
          <value>&lt;editor> 
    &lt;formElement> 
        &lt;label>Delete workflows older than&lt;/label>    
        &lt;property>olderThan&lt;/property>    
        &lt;documentation>Indicate the numbers of days after which workflows should be deleted&lt;/documentation> 
        &lt;type>select&lt;/type> 
        &lt;option> 
            &lt;name>1 month&lt;/name> 
            &lt;value>30&lt;/value> 
        &lt;/option> 
        &lt;option> 
            &lt;name>2 months&lt;/name> 
            &lt;value>60&lt;/value> 
        &lt;/option> 
        &lt;option> 
            &lt;name>3 months&lt;/name> 
            &lt;value>91&lt;/value> 
        &lt;/option> 
        &lt;option> 
            &lt;name>6 months&lt;/name> 
            &lt;value>182&lt;/value> 
        &lt;/option> 
        &lt;option> 
            &lt;name>1 year&lt;/name> 
            &lt;value>365&lt;/value> 
        &lt;/option> 
        &lt;value>91&lt;/value>  
        &lt;required>1&lt;/required>
    &lt;/formElement> 

    &lt;formElement> 
        &lt;label>Workflow property&lt;/label> 
        &lt;property>wkfProperty&lt;/property> 
        &lt;documentation>Name of a property attached to your workflows. If this property is set, your workflow won't be deleted.
        &lt;/documentation> 
        &lt;type>entry&lt;/type> 
        &lt;value>doNotDelete&lt;/value> 
        &lt;required>1&lt;/required>
    &lt;/formElement> 

    &lt;formElement> 
        &lt;label>Pattern matching&lt;/label> 
        &lt;property>wkfPatternMatching&lt;/property> 
        &lt;documentation>a SQL pattern matching to automatically preserve some workflows. The pattern must solve for a LIKE statement.&lt;/documentation> 
        &lt;type>entry&lt;/type>
    &lt;/formElement> 

    &lt;formElement> 
        &lt;label>Delete&lt;/label>    
        &lt;property>executeDeletion&lt;/property> 
        &lt;documentation>If this option is not set, only report is done. No real data are deleted&lt;/documentation> 
        &lt;type>select&lt;/type>    
        &lt;option> 
            &lt;name>Report&lt;/name> 
            &lt;value>false&lt;/value> 
        &lt;/option> 
        &lt;option> 
            &lt;name>Delete&lt;/name> 
            &lt;value>true&lt;/value> 
        &lt;/option> 
        &lt;value>false&lt;/value>    
    &lt;/formElement> 

&lt;/editor></value>
        </property>
        <property>
          <propertyName>exposeToPlugin</propertyName>
          <description>So the procedure is shown in the pickerList</description>
          <expandable>1</expandable>
          <value>1</value>
        </property>
      </propertySheet>
      <formalParameter>
        <formalParameterName>executeDeletion</formalParameterName>
        <defaultValue>false</defaultValue>
        <description>If this option is not set, only report is done. No real data are deleted</description>
        <expansionDeferred>0</expansionDeferred>
        <required>1</required>
        <type>select</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>olderThan</formalParameterName>
        <defaultValue>91</defaultValue>
        <description>Indicate the numbers of days after which jobs should be deleted</description>
        <expansionDeferred>0</expansionDeferred>
        <required>1</required>
        <type>select</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>wkfPatternMatching</formalParameterName>
        <defaultValue />
        <description>a SQL pattern matching to automatically preserve some workflows. The pattern must solve for a LIKE statement.</description>
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>entry</type>
      </formalParameter>
      <formalParameter>
        <formalParameterName>wkfProperty</formalParameterName>
        <defaultValue>doNotDelete</defaultValue>
        <description>Name of a property attached to your workflows. If this property is set, your workflow won't be deleted no matter how old it is.
</description>
        <expansionDeferred>0</expansionDeferred>
        <required>0</required>
        <type>entry</type>
      </formalParameter>
      <step>
        <stepName>deleteWorkflows</stepName>
        <alwaysRun>0</alwaysRun>
        <broadcast>0</broadcast>
        <command>#############################################################################
#
#  deleteWorkflows -- Script to delete workflowss
#  Copyright 2013 Electric-Cloud Inc.
#
#############################################################################

#
# Perl Commander Header
$[/myProject/scripts/perlHeader]
use DateTime;

#
# Perl Commander library
$[/myProject/scripts/perlLib]

#############################################################################
#
#  Assign Commander parameters to variables
#
#############################################################################
my $wkfProperty     = "$[wkfProperty]";
my $timeLimit       =  $[olderThan];
my $executeDeletion = "$[executeDeletion]";
my $wkfPattern      = "$[wkfPatternMatching]"; 

#############################################################################
#
#  Global Variables
#
#############################################################################
my $version="1.0";
my $totalNbWkfs=0;          # Number of workflows to delete potentially
my $totalNbStates=0;        # Number of states to evaluate DB size
my $totalNbTrans=0;         # Number of transitions to evaluate DB size
my $DBStateSize=10240;      # State is about 10K in DB
my $DBTransSize=5120;       # Transition is about 5K in DB

#############################################################################
#
#  Main
#
#############################################################################

printf("%s workflows older than $timeLimit days (%s).\n", 
    $executeDeletion eq "true"?"Deleting":"Reporting", 
    calculateDate($timeLimit));
printf("  Skipping over \"%s\" workflows.\n\n", $wkfPattern) if ($wkfPattern ne "");

# create filterList
my @filterList;
# only completed workflows
push (@filterList, {"propertyName" => "completed",
                    "operator" => "equals",
                    "operand1" => "1"});
# older than
if ($timeLimit >0) {
  push (@filterList, {"propertyName" => "finish",
                    "operator" => "lessThan",
                    "operand1" => calculateDate($timeLimit)});
}
                    # do not have specific job property
push (@filterList, {"propertyName" => $wkfProperty,
                    "operator" => "isNull"});
# workflow pattern does not match
if ($wkfPattern ne "") {
  push (@filterList, {"propertyName" => "workflowName",
                      "operator" => "notLike",
                      "operand1" => $wkfPattern});
}              

my ($success, $xPath) = InvokeCommander("SuppressLog", "findObjects", "workflow",
                                        {maxIds => 5000,
                                         filter => \@filterList ,
                                         sort => [ {propertyName => "finish",
                                                    order => "ascending"} ]
                                        }
									   );
print "Search Status:\t$success\n";

# Loop over all returned workflows
my $nodeset = $xPath->find('//workflow');
foreach my $node ($nodeset->get_nodelist) {
        $totalNbWkfs++;

        my $wkfName = $xPath->findvalue('workflowName', $node);
		my $projName= $xPath->findvalue('projectName', $node);

        print "Workflow: $wkfName\n";

        #
        # Find number of states for the workflow
		my $nbStates=0;
		my $nbTrans=0;
        my ($success, $stateXML) = InvokeCommander("SuppressLog", "getStates", $projName, $wkfName);
        foreach my $stateNode ($stateXML->find('//state')->get_nodelist) {
		  $nbStates ++;
		  my $stateName=$stateXML->findvalue('stateName', $stateNode);
		  printf("  State name: $stateName\n") if ($DEBUG);
		  #
		  # Find numbers of transitions per state
		  my ($success, $transXML) = InvokeCommander("SuppressLog", "getTransitions", $projName, $wkfName, $stateName);
		  $nbTrans += scalar($transXML->findnodes('//transition')->get_nodelist);
		}
        printf("  Workflow states:\t%d\n", $nbStates);
        printf("  Workflow transitions:\t%d\n", $nbTrans);
		$totalNbStates += $nbStates;
		$totalNbTrans  += $nbTrans;
		
        # Delete the workflow

        if ($executeDeletion eq "true") {
            InvokeCommander("SuppressLog", "deleteWorkflow", $projName, $wkfName) ;
            print "  Deleting Workflow\n\n";
        } 
}

printf("\nSUMMARY:\n");
printf("Total number of workflows:   %d\n", $totalNbWkfs);
printf("Total number of states:      %d\n", $totalNbStates);
printf("Total number of transitions: %d\n", $totalNbTrans);
printf("Total Database size:         %s\n", 
       humanSize($totalNbStates * $DBStateSize + $totalNbTrans * $DBTransSize));

$ec->setProperty("/myJob/numberOfWorkflows", $totalNbWkfs);
$ec->setProperty("/myJob/numbernumberOfStates", $totalNbStates);

$ec->setProperty("summary", $totalNbWkfs . " workflows deleted" ) if ($executeDeletion eq "true");

exit(0);


#############################################################################
#
#  Calculate the Date based on now and the number of days required by
#  the user before deleting jobs
#
#############################################################################
sub calculateDate {
    my $nbDays=shift;
    return DateTime->now()->subtract(days => $nbDays)->iso8601() . ".000Z";
}

</command>
        <condition />
        <description>Script to delete workflows</description>
        <errorHandling>failProcedure</errorHandling>
        <exclusiveMode>none</exclusiveMode>
        <logFileName />
        <parallel>0</parallel>
        <postProcessor />
        <precondition />
        <releaseMode>none</releaseMode>
        <resourceName />
        <shell>ec-perl</shell>
        <timeLimit />
        <timeLimitUnits>minutes</timeLimitUnits>
        <workingDirectory />
        <workspaceName />
        <propertySheet>
        </propertySheet>
      </step>
    </procedure>
    <schedule>
      <scheduleName>CleanJobs</scheduleName>
      <beginDate />
      <description>A Schedule to automatically delete jobs older than 30 days</description>
      <endDate />
      <interval>0</interval>
      <intervalUnits>seconds</intervalUnits>
      <misfirePolicy>runOnce</misfirePolicy>
      <monthDays />
      <priority>normal</priority>
      <procedureName>jobsCleanup</procedureName>
      <scheduleDisabled>1</scheduleDisabled>
      <startTime>2:00</startTime>
      <stopTime />
      <timeZone>America/Los_Angeles</timeZone>
      <weekDays>Tuesday Friday </weekDays>
      <actualParameters>
        <property>
          <propertyName>computeUsage</propertyName>
          <expandable>1</expandable>
          <value>false</value>
        </property>
        <property>
          <propertyName>executeDeletion</propertyName>
          <expandable>1</expandable>
          <value>true</value>
        </property>
        <property>
          <propertyName>jobLevel</propertyName>
          <expandable>1</expandable>
          <value>All</value>
        </property>
        <property>
          <propertyName>jobProperty</propertyName>
          <expandable>1</expandable>
          <value>doNotDeleteThisJob</value>
        </property>
        <property>
          <propertyName>olderThan</propertyName>
          <expandable>1</expandable>
          <value>30</value>
        </property>
      </actualParameters>
      <propertySheet>
        <property>
          <propertyName>ec_customEditorData</propertyName>
          <propertySheet>
            <property>
              <propertyName>formType</propertyName>
              <expandable>1</expandable>
              <value>standard</value>
            </property>
          </propertySheet>
        </property>
      </propertySheet>
    </schedule>
    <schedule>
      <scheduleName>performanceSchedule</scheduleName>
      <beginDate />
      <description />
      <endDate />
      <interval>0</interval>
      <intervalUnits>seconds</intervalUnits>
      <misfirePolicy>runOnce</misfirePolicy>
      <monthDays />
      <priority>normal</priority>
      <procedureName>performanceMetrics</procedureName>
      <scheduleDisabled>1</scheduleDisabled>
      <startTime>0:05</startTime>
      <stopTime />
      <timeZone>America/Los_Angeles</timeZone>
      <weekDays />
      <actualParameters>
        <property>
          <propertyName>debugMode</propertyName>
          <expandable>1</expandable>
          <value>0</value>
        </property>
        <property>
          <propertyName>numberOfGB</propertyName>
          <expandable>1</expandable>
          <value>10</value>
        </property>
        <property>
          <propertyName>numberOfSteps</propertyName>
          <expandable>1</expandable>
          <value>500</value>
        </property>
      </actualParameters>
      <propertySheet>
        <property>
          <propertyName>ec_customEditorData</propertyName>
          <propertySheet>
            <property>
              <propertyName>formType</propertyName>
              <expandable>1</expandable>
              <value>standard</value>
            </property>
          </propertySheet>
        </property>
      </propertySheet>
    </schedule>
    <schedule>
      <scheduleName>RunReport_Performance_Schedule</scheduleName>
      <beginDate />
      <description />
      <endDate />
      <interval>0</interval>
      <intervalUnits>seconds</intervalUnits>
      <misfirePolicy>ignore</misfirePolicy>
      <monthDays />
      <priority>normal</priority>
      <procedureName>/plugins/EC-Reports/project/procedures/RunReport_MultiSeries</procedureName>
      <scheduleDisabled>1</scheduleDisabled>
      <startTime>02:00</startTime>
      <stopTime />
      <timeZone>America/Los_Angeles</timeZone>
      <weekDays />
      <actualParameters>
        <property>
          <propertyName>Chart Time Grouping</propertyName>
          <expandable>1</expandable>
          <value>day</value>
        </property>
        <property>
          <propertyName>Chart X-Axis Label</propertyName>
          <expandable>1</expandable>
          <value>Date</value>
        </property>
        <property>
          <propertyName>Chart Y-Axis Label</propertyName>
          <expandable>1</expandable>
          <value>Seconds</value>
        </property>
        <property>
          <propertyName>Generate Thumbnail</propertyName>
          <expandable>1</expandable>
          <value>1</value>
        </property>
        <property>
          <propertyName>Object Type</propertyName>
          <expandable>1</expandable>
          <value>job</value>
        </property>
        <property>
          <propertyName>Report Title</propertyName>
          <expandable>1</expandable>
          <value>Performance Report</value>
        </property>
        <property>
          <propertyName>Resource</propertyName>
          <expandable>1</expandable>
          <value>local</value>
        </property>
        <property>
          <propertyName>Saved Filter</propertyName>
          <expandable>1</expandable>
          <value>/plugins/EC-Admin/project/ec_savedSearches/last500PerformanceMetricsJobs</value>
        </property>
        <property>
          <propertyName>Series 1 Chart Type</propertyName>
          <expandable>1</expandable>
          <value>Line</value>
        </property>
        <property>
          <propertyName>Series 1 Display Name</propertyName>
          <expandable>1</expandable>
          <value>Read Perf.</value>
        </property>
        <property>
          <propertyName>Series 1 Property</propertyName>
          <expandable>1</expandable>
          <value>readDiskPerf</value>
        </property>
        <property>
          <propertyName>Series 1 Property Function</propertyName>
          <expandable>1</expandable>
          <value>Min</value>
        </property>
        <property>
          <propertyName>Series 1 Stacked</propertyName>
          <expandable>1</expandable>
          <value>0</value>
        </property>
        <property>
          <propertyName>Series 2 Chart Type</propertyName>
          <expandable>1</expandable>
          <value>Line</value>
        </property>
        <property>
          <propertyName>Series 2 Display Name</propertyName>
          <expandable>1</expandable>
          <value>Write Perf.</value>
        </property>
        <property>
          <propertyName>Series 2 Property</propertyName>
          <expandable>1</expandable>
          <value>writeDiskPerf</value>
        </property>
        <property>
          <propertyName>Series 2 Property Function</propertyName>
          <expandable>1</expandable>
          <value>Min</value>
        </property>
        <property>
          <propertyName>Series 2 Stacked</propertyName>
          <expandable>1</expandable>
          <value>0</value>
        </property>
        <property>
          <propertyName>Series 3 Chart Type</propertyName>
          <expandable>1</expandable>
          <value>Line</value>
        </property>
        <property>
          <propertyName>Series 3 Display Name</propertyName>
          <expandable>1</expandable>
          <value>Database Perf.</value>
        </property>
        <property>
          <propertyName>Series 3 Property</propertyName>
          <expandable>1</expandable>
          <value>DBPerf</value>
        </property>
        <property>
          <propertyName>Series 3 Property Function</propertyName>
          <expandable>1</expandable>
          <value>Ave</value>
        </property>
        <property>
          <propertyName>Series 3 Stacked</propertyName>
          <expandable>1</expandable>
          <value>0</value>
        </property>
        <property>
          <propertyName>Series 4 Chart Type</propertyName>
          <expandable>1</expandable>
          <value>Line</value>
        </property>
        <property>
          <propertyName>Series 4 Property Function</propertyName>
          <expandable>1</expandable>
          <value>Ave</value>
        </property>
        <property>
          <propertyName>Series 4 Stacked</propertyName>
          <expandable>1</expandable>
          <value>0</value>
        </property>
        <property>
          <propertyName>Series 5 Chart Type</propertyName>
          <expandable>1</expandable>
          <value>Line</value>
        </property>
        <property>
          <propertyName>Series 5 Property Function</propertyName>
          <expandable>1</expandable>
          <value>Ave</value>
        </property>
        <property>
          <propertyName>Series 5 Stacked</propertyName>
          <expandable>1</expandable>
          <value>0</value>
        </property>
        <property>
          <propertyName>Table Time Column Display Name</propertyName>
          <expandable>1</expandable>
          <value>Time</value>
        </property>
        <property>
          <propertyName>Table Time Grouping</propertyName>
          <expandable>1</expandable>
          <value>auto</value>
        </property>
        <property>
          <propertyName>Time Period</propertyName>
          <expandable>1</expandable>
          <value>window,30</value>
        </property>
      </actualParameters>
      <propertySheet>
      </propertySheet>
    </schedule>
    <schedule>
      <scheduleName>weeklySaveProjects</scheduleName>
      <beginDate />
      <description />
      <endDate />
      <interval>0</interval>
      <intervalUnits>seconds</intervalUnits>
      <misfirePolicy>runOnce</misfirePolicy>
      <monthDays />
      <priority>normal</priority>
      <procedureName>saveProjects</procedureName>
      <scheduleDisabled>1</scheduleDisabled>
      <startTime>4:30</startTime>
      <stopTime />
      <timeZone>America/Los_Angeles</timeZone>
      <weekDays>Tuesday Thursday Saturday </weekDays>
      <actualParameters>
        <property>
          <propertyName>includeACLs</propertyName>
          <expandable>1</expandable>
          <value>true</value>
        </property>
        <property>
          <propertyName>includeNotifiers</propertyName>
          <expandable>1</expandable>
          <value>true</value>
        </property>
        <property>
          <propertyName>pathname</propertyName>
          <expandable>1</expandable>
          <value>/scratch/BACKUP</value>
        </property>
        <property>
          <propertyName>relocatable</propertyName>
          <expandable>1</expandable>
          <value>true</value>
        </property>
      </actualParameters>
      <propertySheet>
        <property>
          <propertyName>ec_customEditorData</propertyName>
          <propertySheet>
            <property>
              <propertyName>formType</propertyName>
              <expandable>1</expandable>
              <value>standard</value>
            </property>
          </propertySheet>
        </property>
      </propertySheet>
    </schedule>
  </project>
</exportedData>